[{"tags": "IT技术,Linux", "url_object_id": "1118eeda71990c18b1a0e9492a82d95e", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2014/04/e260ae4f5d153b25be87819b25ff0577.jpg"], "praise_nums": "1", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://opensource.com/article/17/8/linux-anniversary\">Jim Hall</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-8836-1.html\">Linux中国/softpaopao</a>   </div><blockquote><p>通过安装 SLS 1.05 展示了 Linux 内核在这 26 年间走过了多远。</p></blockquote>\n<p>我第一次安装 Linux 是在 1993 年。那时我跑的是 MS-DOS，但我真的很喜欢学校机房电脑的 Unix 系统，就在那里度过了我大学本科时光。 当我听说了 Linux，一个 Unix 的免费版本，可以在我家的 386 电脑上运行的时候，我立刻就想要试试。我的第一个 Linux 发行版是 <a href=\"https://en.wikipedia.org/wiki/Softlanding_Linux_System\">Softlanding Linux System</a> (SLS) 1.03，带有 11 级补丁的 0.99 alpha 版本的 Linux 内核。它要求高达 2 MB 的内存，如果你想要编译项目需要 4 MB，运行 X windows 则需要 8 MB。</p>\n<p>我认为 Linux 相较于 MS-DOS 世界是一个巨大的进步。 尽管 Linux 缺乏运行在 MS-DOS 上的广泛的应用及游戏，但我发现 Linux 带给我的是巨大的灵活性。不像 MS-DOS ，现在我可以进行真正的多任务，同时运行不止一个程序。并且 Linux 提供了丰富的工具，包括一个 C 语言编译器，让我可以构建自己的项目。</p>\n<p>一年后，我升级到了 SLS 1.05，它支持全新的 Linux 内核 1.0。 更重要的，Linux 引入了内核模块。通过内核模块，你不再需要为支持新硬件而编译整个内核；取而代之，只需要从包含 Linux 内核之内的 63 个模块里加载一个就行。在 SLS 1.05 的发行自述文件中包含这些关于模块的注释：</p>\n<blockquote><p>内核的模块化旨在正视减少并最终消除重新编译内核的要求，无论是变更、修改设备驱动或者为了动态访问不常用的驱动。也许更为重要的是，个别工作小组的工作不再影响到内核的正确开发。事实上，这让以二进制发布官方内核现在成为了可能。</p></blockquote>\n<p>在 8 月 25 日，Linux 内核将迎来它的第 26 周年（LCTT 译注：已经过去了 =.= ）。为了庆祝，我重新安装了 SLS 1.05 来提醒自己 Linux 1.0 内核是什么样子，去认识 Linux 自二十世纪 90 年代以来走了多远。和我一起踏上 Linux 的怀旧之旅吧！</p>\n<h3 id=\"toc_1\">安装</h3>\n<p>SLS 是第一个真正的 “发行版”，因为它包含一个安装程序。 尽管安装过程并不像现代发行版一样顺畅。 不能从 CD-ROM 启动安装，我需要从安装软盘启动我的系统，然后从 <strong>login</strong> 提示中运行安装程序。</p>\n<p><img title=\"Installing SLS 1.05 from the login prompt\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/5c45499b688747f0526bf130c0154587.png\" alt=\"Installing SLS 1.05 from the login prompt\"></p>\n<p>在 SLS 1.05 中引入的一个漂亮的功能是支持彩色的文本模式安装器。当我选择彩色模式时，安装器切换到一个带有黑色文字的亮蓝色背景，不再是我们祖祖辈辈们使用的原始的普通黑白文本。</p>\n<p><img title=\"Color-enabled text-mode installer in SLS 1.05\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/a6012be8a0eee0df8f3e26191734cd8a.png\" alt=\"Color-enabled text-mode installer in SLS 1.05\"></p>\n<p>SLS 安装器是个简单的东西，文本从屏幕底部滚动而上，显示其做的工作。通过对一些简单的提示的响应，我能够创建一个 Linux 分区，挂载上 ext2 文件系统，并安装 Linux 。 安装包含了 X windows 和开发工具的 SLS 1.05，需要大约 85 MB 的磁盘空间。依照今天的标准这听起来可能不是很多，但在 Linux 1.0 出来的时候，120 MB 的硬件设备才是主流设备。</p>\n<p><img title=\"Creating a partition for Linux, putting an ext2 filesystem on it, and installing Linux\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/ec187c4e241e9271150072dbe7d4cdfe.png\" alt=\"Creating a partition for Linux, putting an ext2 filesystem on it, and installing Linux\"></p>\n<p><img title=\"First boot\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/387f178eb53fc2ac018d8054a21e7071.png\" alt=\"First boot\"></p>\n<h3 id=\"toc_2\">系统级别</h3>\n<p>当我第一次启动到 Linux 时，让我想起来了一些关于这个早期版本 Linux 系统的事情。首先，Linux 没有占据很多的空间。在启动系统之后运行一些程序来检查的时候，Linux 占用了不到 4 MB 的内存。在一个拥有 16MB 内存的系统中，这就意味着节省了很多内存用来运行程序。</p>\n<p><img title=\"Checking out the filesystem and available disk space\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/f4a217e99547a2749af4bb5c658d56df.png\" alt=\"Checking out the filesystem and available disk space\"></p>\n<p>熟悉的 <code>/proc</code> 元文件系统在 Linux 1.0 就存在了，尽管对比我们今天在现代系统上看到的，它并不能提供许多信息。在 Linux 1.0， <code>/proc</code> 包含一些接口来探测类似 <code>meminfo</code> 和 <code>stat</code> 之类的基本系统状态。</p>\n<p><img title=\"The familiar /proc meta filesystem\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/8419659167d2ca26f0182224283a317d.png\" alt=\"The familiar /proc meta filesystem\"></p>\n<p>在这个系统上的 <code>/etc</code> 文件目录非常简单。值得一提的是，SLS 1.05 借用了来自 <a href=\"https://en.wikipedia.org/wiki/Berkeley_Software_Distribution\">BSD Unix</a> 的 <strong>rc</strong> 脚本来控制系统启动。 初始化是通过 <strong>rc</strong> 脚本进行的，由 <code>rc.local</code> 文件来定义本地系统的调整。后来，许多 Linux 发行版采用了来自 <a href=\"https://en.wikipedia.org/wiki/UNIX_System_V\">Unix System V</a> 的很相似的 <strong>init</strong> 脚本，后来又是 <a href=\"https://en.wikipedia.org/wiki/Systemd\">systemd</a> 初始化系统。</p>\n<p><img title=\"The /etc directory\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/237938a3c980e846b2d65d67899e6ddb.png\" alt=\"The /etc directory\"></p>\n<h3 id=\"toc_3\">你能做些什么</h3>\n<p>随着我的系统的启动运行，接下来就可以使用了了。那么，在这样的早期 Linux 系统上你能做些什么？</p>\n<p>让我们从基本的文件管理开始。 每次在你登录的时候，SLS 会让你使用 Softlanding 菜单界面（MESH），这是一个文件管理程序，现代的用户们可能觉得它和 <a href=\"https://midnight-commander.org/\">Midnight Commander</a> 很相似。 而二十世纪 90 年代的用户们可能会拿 MESH 与更为接近的 <a href=\"https://en.wikipedia.org/wiki/Norton_Commander\">Norton Commander</a> 相比，这个可以说是在 MS-DOS 上最流行的第三方文件管理程序。</p>\n<p><img title=\"The Softlanding menu shell (MESH)\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/b7f623257b1323375b9a13f652b57a2d.png\" alt=\"The Softlanding menu shell (MESH)\"></p>\n<p>除了 MESH 之外，在 SLS 1.05 中还少量包含了一些全屏应用程序。你可以找到熟悉的用户工具，包括 Elm 邮件阅读器、GNU Emacs 可编程编辑器，以及古老的 Vim 编辑器。</p>\n<p><img title=\"Elm mail reader\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/91dd27186da1961d4ca3e93928ff0956.png\" alt=\"Elm mail reader\"></p>\n<p><img title=\"GNU Emacs programmable editor\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/f752eaf2abf8ea574b328c61f914cc33.png\" alt=\"GNU Emacs programmable editor\"></p>\n<p>SLS 1.05 甚至包含了一个可以让你在终端玩的俄罗斯方块版本。</p>\n<p><img title=\"Tetris for terminals\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/7f441201064939f5d49061a65a0fcdf0.png\" alt=\"Tetris for terminals\"></p>\n<p>在二十世纪 90 年代，多数住宅的网络接入是通过拨号连接的，所以 SLS 1.05 包含了 Minicom 调制解调器拨号程序。Minicom 提供一个与调制解调器的直接连接，并需要用户通过贺氏调制解调器的 <strong>AT</strong> 命令来完成一些像是拨号或挂电话这样的基础功能。Minicom 同样支持宏和其他简单功能来使连接你的本地调制解调器池更容易。</p>\n<p><img title=\"Minicom modem-dialer application\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/13b052925335f4bf15a61e2a2f73352b.png\" alt=\"Minicom modem-dialer application\"></p>\n<p>但如果你想要写一篇文档时怎么办？ SLS 1.05 的存在要比 LibreOffice 或者 OpenOffice 早很长时间。在二十世纪 90 年代，Linux 还没有这些应用。相反，如果你想要使用一个文字处理器，可能需要引导你的系统进入 MS-DOS，然后运行你喜欢的文字处理器程序，如 WordPerfect 或者共享软件 GalaxyWrite。</p>\n<p>但是所有的 Unix 系统都包含一套简单的文本格式化程序，叫做 nroff 和 troff。在 Linux 系统中，他们被合并成 GNU groff 包，而 SLS 1.05 包含了 groff 的一个版本。我在 SLS 1.05 上的一项测试就是用 nroff 生成一个简单的文本文档。</p>\n<p><img title=\"A simple nroff text document\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/ec200b92a91cd1e94945295a30d3eb8c.png\" alt=\"A simple nroff text document\"></p>\n<p><img title=\"nroff text document output\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/f217fcd68ed4087077ecc9c0214f0fe4.png\" alt=\"nroff text document output\"></p>\n<h3 id=\"toc_4\">运行 X windows</h3>\n<p>获取安装 X windows 并不特别容易，如 SLS 安装文件承诺的那样：</p>\n<blockquote><p>在你的 PC 上获取安装 X windows 可能会有一些发人深省的体验，主要是因为 PC 的显示卡类型太多。Linux X11 仅支持 VGA 类型的显示卡，但在许多类型的 VGA 中仅有个别的某些类型是完全支持的。SLS 存在两种 X windows 服务器。全彩的 XFree86，支持一些或所有 ET3000、ET400、PVGA1、GVGA、Trident、S3、8514、Accelerated cards、ATI plus 等。</p>\n<p>另一个服务器 XF86_Mono，能够工作在几乎所有的 VGA 卡上，但只提供单色模式。因此，相比于彩色服务器，它会占用更少的内存并拥有更快的速度。当然就是看起来不怎么漂亮。</p>\n<p>X windows 的配置信息都堆放在目录 “/usr/X386/lib/X11/”。需要注意的是，“Xconfig” 文件为监视器和显示卡定义了时序。默认情况下，X windows 设置使用彩色服务器，如果彩色服务器出现问题，你可以切换到单色服务器 x386mono，因为它已经支持各种标准的 VGA。本质上，这只是将 /usr/X386/bin/X 链接到它。</p>\n<p>只需要编辑 Xconfig 来设置鼠标驱动类型和时序，然后键入 “startx” 即可。</p></blockquote>\n<p>这些听起来令人困惑，但它就是这样。手工配置 X windows 真的可以是一个发人深省的体验。幸好，SLS 1.05 包含了 syssetup 程序来帮你确定系统组件的种类，包括了 X windows 的显示设置。在一些提示过后，经过一些实验和调整，最终我成功启动了 X windows！</p>\n<p><img title=\"The syssetup program\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/bcaea8d4616c94e53487a762f0b7eaf0.png\" alt=\"The syssetup program\"></p>\n<p>但这是来自于 1994 年的 X windows，它仍然并没有桌面的概念。我可以从 FVWM （一个虚拟窗口管理器）或 TWM （选项卡式的窗口管理器）中选择。TWM 直观地设置提供一个功能简单的图形环境。</p>\n<p><img title=\"TWM\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/97c8eadaf2ce93c38995b0a92e839fc5.png\" alt=\"TWM\"></p>\n<h3 id=\"toc_5\">关机</h3>\n<p>我已经在我的 Linux 寻根之旅沉浸许久，是时候最终回到我的现代桌面上了。最初我跑 Linux 的是一台仅有 8MB 内存和 一个 120MB 硬盘驱动器的 32 位 386 电脑，而我现在的系统已经足够强大了。拥有双核 64 位 Intel Core i5 处理器，4 GB 内存和一个 128 GB 的固态硬盘，我可以在我的运行着 Linux 内核 4.11.11 的系统上做更多事情。那么，在我的 SLS 1.05 的实验结束之后，是时候离开了。</p>\n<p><img title=\"Shutting down\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/b6254ead7170bd2dbacf864457006fdc.png\" alt=\"Shutting down\"></p>\n<p>再见，Linux 1.0。很高兴看到你的茁壮成长。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112494\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112494votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112494\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "create_date": "2017-09-15", "title": "Linux 26 周年，来一场怀旧之旅", "fav_nums": 0, "url": "http://blog.jobbole.com/112494/", "comment_nums": 0, "front_image_path": "full/6085acc0af4696f5d49164561c6bc4f9b590fc26.jpg"},{"tags": "开发", "url_object_id": "6a460eaa67aa7e8ca87d0cb25e5f526a", "front_image_url": ["http://wx2.sinaimg.cn/mw690/6941baebly1fjj46lxsofj20sg0lc3zw.jpg"], "praise_nums": "2", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/snowhere\">孙腾浩</a> 翻译。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"https://www.vincit.fi/en/blog/software-development-450-words-per-minute/\">Tuukka Ojala</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p><img src=\"http://wx2.sinaimg.cn/mw690/6941baebly1fjj46lxsofj20sg0lc3zw.jpg\"></p>\n<p>我认为你第一次看到我的工作间肯定这样想 —— “总感觉少些什么”。没有显示器和鼠标，却有个人敲打着键盘，不知注视着哪里。</p>\n<p>这就是我，我同事可以证明我没问题。我是位于坦佩雷（芬兰西南部一座城市）的 Vincit 写字楼中的一名软件开发者。我双目失明。这篇文章中我将讲述有关我工作中的事情。</p>\n<h2>你真的什么都看不到吗？</h2>\n<p>准确来说，我觉察到阳光和其他明亮的光线，不过也仅限这些。其实，这对我的工作也并没有什么帮助。</p>\n<h2>你工作内容是什么？</h2>\n<p>和大部分人一样：忙时写代码，闲时和同事吹逼。我做全栈项目，主攻后端。兼职访问顾问 – 或称监管，随你如何称呼。</p>\n<h2>你如何使用电脑？</h2>\n<p>我用的电脑是一台运行 Windows 10 的普通笔记本。是其中的软件让一切变得神奇。我使用一款叫做屏幕阅读器的程序来访问电脑。屏幕阅读器监听屏幕上的变化并通过盲文（需要单独的盲文设备）或合成的声音来展示给用户。这并不是你如今听到的各种智能助理的合成声音。我使用一种机械声音，每分钟能说 450 个单词。相比较而言，英语正常语速每分钟 120-150 个单词。我有一个怪癖：我既说英语也说芬兰语，我用芬兰语合成器读英语，因为老旧的屏幕阅读器在语言之间切换不够智能，所以我习惯这样做。下面是个例子是阅读这个段落，我能听懂。</p>\n<p><a href=\"https://www.vincit.fi/wp-content/uploads/2017/08/mpsample.mp3?_=1\">https://www.vincit.fi/wp-content/uploads/2017/08/mpsample.mp3?_=1</a></p>\n<p>下面是英语合成器发出的声音：</p>\n<p><a href=\"https://www.vincit.fi/wp-content/uploads/2017/08/essample.mp3?_=2\">https://www.vincit.fi/wp-content/uploads/2017/08/essample.mp3?_=2</a></p>\n<p>鼠标对于我来说并不是非常有用，所以我仅仅通过键盘工作。在座的各位应该十分熟悉我用到的命令：方向键和 tab 键控制窗口内的移动，alt+tab 切换窗口等等。屏幕阅读器也有很多自己的快捷键，比如阅读活动窗口的不同区域或开关一些功能特性。</p>\n<p>有趣的是阅读网页和其他格式化文档。你看，屏幕阅读器分块呈现信息。每一块可能是一行，也可能是一个单词、一个字母，亦或是文本的片段。举个例子，我在网页中按向下的方向键，我听到页面的下一行。我并不能像正常人一样用眼睛从屏幕上阅读内容。相反，我听到一块一块的内容，或跳过我不感兴趣的部分。</p>\n<p>语音或盲文并不能描绘出窗口的显示布局。信息以线性方式呈现给我。如果你把网页复制粘贴进记事本，你就能明白我看到的网页是什么样子的。就是剥离大部分格式的多行文本。然而屏幕阅读器可以获取网页上的 HTML 语法，所以我也能知道超链接、标题、表单等等。事实上，如果非复选框元素展示成复选框样式，我并不能知道这是复选框。我之后将写一篇文章详细讲述这些内容，记住我刚刚举的是个“反人类”例子。 （译者注：突然感到自责和羞愧，深深明白了一个道理：不要用各种有含意义的传统标签 hack 布局和样式，也不要因为 css 的强大而懒得使用各种有含义的传统标签。共勉）</p>\n<p>我花费大量时间工作在命令行上。事实上我通常用浏览器和编辑器，很少用其他图形应用程序。相比那些为鼠标用户打造的图形界面，我发现用命令行处理手边的工作更加高效。</p>\n<p>既然我如此热爱命令行，为什么我却要选择 Windows 这个并不以命令行出名的操作系统呢？答案很简单：Windows 是最方便的操作系统。<a href=\"https://www.nvaccess.org/\">NVDA</a>是我所选择的屏幕阅读器，它是开源的并且维护比其他阅读器更频繁。如果上天再我一次机会，我可能会选 Mac 系统，因为我认为它是易用性和功能性平衡的典范。不幸的是 Mac 系统上的屏幕阅读器 <a href=\"https://www.apple.com/accessibility/mac/vision/\">VoiceOver</a> 经历了漫长的发布周期从而被遗忘，并且它的导航模型和我独特的工作方式并不协调。当然这里也有一个 Gnome 桌面上的<a href=\"https://wiki.gnome.org/action/show/Projects/Orca?action=show&amp;redirect=Orca\">屏幕阅读器</a>，虽然用户很少，依然被很好地维护着，不过还有一些不完善的地方和我日常工作不协调。所以，我选择 Windows。由 GNU 诞生的 Git Bash 和其他命令行工具弥补了 Windows 内置命令行的缺陷。</p>\n<h2>你如何写代码？</h2>\n<p>我花费好长时间才明白为什么大家觉得这个问题是个很高深的问题。记得我上面说过一行一行地阅读文本吗？我也是通过这种方式读代码。通常我会跳过无用的行，或仅听半行来获取内容，但当我需要知道完整信息的时候，我不得不像读小说一样读完所有东西。我当然无法阅读整个代码库。这种情况下我会在脑中抽象一部分代码：这个组件输入 x 返回 y，并不用关心细节逻辑。</p>\n<p>这种阅读方式让我和正常同事的工作方式有些区别。举个例子，当代码审查时，我喜欢看原始 diff 输出，并列窗口显示 diff 对我并不适用，而且还容易让人分心。有修改的代码行上用符号 + 和 – 比用不同背景色标注也要好太多，并不是因为我不能获知颜色名字，而是因为在新增的一行中，读“加”这个字比读“带复杂阴影的高亮红色”用更短的时间。（嘿，我说你呢 Gerrit (一款代码审查工具)）</p>\n<p>你或许会认为缩进和其他代码格式和我无关，因为都是基本的视觉问题。并不是这样，正确的缩进对我的帮助和正常开发者一样。当我用盲文（比语音更加高效）读代码时，我像其他正常程序员一样清楚代码结构。当我进入一段有缩进或无缩进的代码时，我也会得到语音提醒。这些信息帮助我在脑中描绘代码结构。事实上我学的第一门语言就是 Python （PHP 不算），它强制使用代码缩进，这对我来说并不是问题。我有众多理由来强烈建议使用整洁统一的代码风格，其中之一就是不要让我的生活变得更加艰难了，好吗。</p>\n<h2>你喜欢哪款编辑器？</h2>\n<p>剧透一下：这个答案并不是以 V 或者 E 开头（我虽然通过命令行用 Vim 来写 git commit 信息和其他备注。我认为我在这场圣战中是中立的）（译者注：Vim 和 Emacs 梗）一年前我认为 Notepad++ 最棒，它是轻量级的做工精细的文本编辑器。然而一年前我还没有接触大规模 Java 项目，当我接触这种项目时，意味着我应该在 Notepad++ 和理智之间做个选择。最后我选择理智，抛弃 Notepad++ 转投 IntelliJ IDEA 的怀抱。从那之后 IntelliJ IDEA 便是我首选编辑器。我曾对各种 IDE 有深深怨念，它们大多数在纯键盘流操作下麻烦又低效。如果我视力没问题，我肯定早就跳到 IDE 阵营了。</p>\n<p>但你可能会问，为什么当初选 Notepad++。还有其他很多更先进的轻量级编辑器，比如 Sublime 或 Atom。原因很简单：屏幕阅读器无法访问它们。Vim 一类的文本编辑器也是如此，我使用的屏幕阅读器对命令行程序的支持有问题，在这些编辑器上无法处理多于 commit 信息的文本。很遗憾，可用性决定了我能够使用的工具。即使我不能高效工作，也不是什么大问题。</p>\n<h2>你编写过前端代码吗？</h2>\n<p>你应该认为前端开发和视觉有关，注定与盲人程序员无缘。基本上是这样。我从来不自己做概念原型，我做都是有界面，需要随后加入功能的项目。</p>\n<p>然而，我也做过 Angular 和 React 工作任务。怎么会这样？如今很多 APP 基于浏览器。举个例子，我曾花费两周时间为一个 Angular APP 增加国际化支持。我并不需要做任何视觉上的改动。</p>\n<p>我发现对于我这类开发者开说，像 Bootstrap 这类的库简直是上天的礼物。正因为栅格系统（Bootstrap的响应式布局解决方案），我可以自己构建一个粗糙的界面。尽管如此，我做的有关界面的改动在呈现给用户之前仍然要有一双眼睛检查。所以，总而言之，我可以在一定程度上做些前端开发，至少不是和表现层太相关。</p>\n<h2>有什么其他没有提到的东西？</h2>\n<p>其实这篇文章有很多东西没有表达出来。正如上文所承诺，我将全力以赴写一篇文章，有关制作易访问网页的艺术，因为一言未尽是我讨厌的事情之一。我不会半途而废的，敬请期待。</p>\n\r\n        \r\n            <blockquote class=\"rewards\">\n        <p><strong>打赏支持我翻译更多好文章，谢谢！</strong></p>\n        <a href=\"#rewardbox\" id=\"rewards-button\" class=\"fancybox\"><span class=\"btn-bluet-blue href-style\"><i class=\"fa fa-jpy\"></i> 打赏译者</span></a>\n    </blockquote>\n\n    <div id=\"rewardbox\">\n        <h4>打赏支持我翻译更多好文章，谢谢！</h4>\n                <p>任选一种支付方式</p>\n                <p>\n                        <img src=\"http://jbcdn2.b0.upaiyun.com/2017/01/5085cce1bd4e144b7d148079a34b20c1.jpg\">\n            \n                            <img src=\"http://jbcdn2.b0.upaiyun.com/2017/01/02b09a29fdb3ab5fe03d4bd1afe95664.jpg\">\n                    </p>\n    </div>\n\n    \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112473\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112473votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112473\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/snowhere\">孙腾浩</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/snowhere\">\r\n\t\t\t<img src=\"http://jbcdn2.b0.upaiyun.com/2017/06/47765e50cfb7c4e598e72d893ab4f62f.jpg\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            毕业于郑州大学软件工程专业，身为 Java 程序猿却同样热爱着 JavaScript 。为了兴趣而写代码，做自己喜欢做的事。Keep coding ... Stay Cool ...        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/snowhere\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/snowhere/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/snowhere/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 19</a> · <a title=\"我的网站\" target=\"_blank\" href=\"http://snowhere.me/\"><i class=\"fa fa-link\"></i></a> <a title=\"GitHub主页\" target=\"_blank\" href=\"https://github.com/Snowhere/\"><i class=\"fa fa-github\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "create_date": "2017-09-14", "title": "惊叹！这个盲人程序员是这样写代码的", "fav_nums": 0, "url": "http://blog.jobbole.com/112473/", "comment_nums": 0, "front_image_path": "full/f99add302e9e9474ef727d93109a13d123869a36.jpg"},{"tags": "开发,HttpClient,java", "url_object_id": "149aabb38c863d753923c7f320a4a6ff", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/09/b133aed073d8d50b86dc17cd62408b91.jpg"], "praise_nums": "1", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文作者： <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/2653yy\">fullstackyang</a> 。未经作者许可，禁止转载！<br>欢迎加入伯乐在线 <a href=\"http://blog.jobbole.com/99322\" target=\"_blank\">专栏作者</a>。</div><p>在使用HttpClient进行抓取一些网页的时候，经常会保留从服务器端发回的Cookie信息，以便发起其他需要这些Cookie的请求。大多数情况下，我们使用内置的cookie策略，便能够方便直接地获取这些cookie。</p>\n<p>下面的一小段代码，就是访问<a href=\"http://www.baidu.com\">http://www.baidu.com</a>，并获取对应的cookie：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59bcc5d2bf6e8263033636\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n@ Test\r\npublic void getCookie(){\r\n    CloseableHttpClient httpClient = HttpClients.createDefault();\r\n    HttpGet get=new HttpGet(\"http://www.baidu.com\");\r\n    HttpClientContext context = HttpClientContext.create();\r\n    try {\r\n        CloseableHttpResponse response = httpClient.execute(get, context);\r\n        try{\r\n            System.out.println(\"&gt;&gt;&gt;&gt;&gt;&gt;headers:\");\r\n            Arrays.stream(response.getAllHeaders()).forEach(System.out::println);\r\n            System.out.println(\"&gt;&gt;&gt;&gt;&gt;&gt;cookies:\");\r\n            context.getCookieStore().getCookies().forEach(System.out::println);\r\n        }\r\n        finally {\r\n            response.close();\r\n        }\r\n    } catch (IOException e) {\r\n        e.printStackTrace();\r\n    }finally {\r\n        try {\r\n            httpClient.close();\r\n        } catch (IOException e) {\r\n            e.printStackTrace();\r\n        }\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59bcc5d2bf6e8263033636-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcc5d2bf6e8263033636-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59bcc5d2bf6e8263033636-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcc5d2bf6e8263033636-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59bcc5d2bf6e8263033636-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcc5d2bf6e8263033636-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59bcc5d2bf6e8263033636-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcc5d2bf6e8263033636-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59bcc5d2bf6e8263033636-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcc5d2bf6e8263033636-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59bcc5d2bf6e8263033636-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcc5d2bf6e8263033636-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59bcc5d2bf6e8263033636-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcc5d2bf6e8263033636-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59bcc5d2bf6e8263033636-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcc5d2bf6e8263033636-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59bcc5d2bf6e8263033636-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcc5d2bf6e8263033636-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59bcc5d2bf6e8263033636-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcc5d2bf6e8263033636-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59bcc5d2bf6e8263033636-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcc5d2bf6e8263033636-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59bcc5d2bf6e8263033636-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcc5d2bf6e8263033636-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59bcc5d2bf6e8263033636-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcc5d2bf6e8263033636-26\">26</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59bcc5d2bf6e8263033636-1\"><span class=\"crayon-sy\">@</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Test</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcc5d2bf6e8263033636-2\"><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getCookie</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59bcc5d2bf6e8263033636-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">CloseableHttpClient </span><span class=\"crayon-v\">httpClient</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">HttpClients</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">createDefault</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcc5d2bf6e8263033636-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">HttpGet </span><span class=\"crayon-v\">get</span><span class=\"crayon-o\">=</span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">HttpGet</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"http://www.baidu.com\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59bcc5d2bf6e8263033636-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">HttpClientContext </span><span class=\"crayon-v\">context</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">HttpClientContext</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">create</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcc5d2bf6e8263033636-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">try</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59bcc5d2bf6e8263033636-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">CloseableHttpResponse </span><span class=\"crayon-v\">response</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">httpClient</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">execute</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">get</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">context</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcc5d2bf6e8263033636-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">try</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59bcc5d2bf6e8263033636-9\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">System</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">println</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"&gt;&gt;&gt;&gt;&gt;&gt;headers:\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcc5d2bf6e8263033636-10\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">Arrays</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">stream</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getAllHeaders</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-st\">forEach</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">System</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">out</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">println</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59bcc5d2bf6e8263033636-11\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">System</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">println</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"&gt;&gt;&gt;&gt;&gt;&gt;cookies:\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcc5d2bf6e8263033636-12\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">context</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getCookieStore</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getCookies</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-st\">forEach</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">System</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">out</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">println</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59bcc5d2bf6e8263033636-13\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcc5d2bf6e8263033636-14\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">finally</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59bcc5d2bf6e8263033636-15\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">close</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcc5d2bf6e8263033636-16\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59bcc5d2bf6e8263033636-17\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">catch</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">IOException</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">e</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcc5d2bf6e8263033636-18\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">e</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">printStackTrace</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59bcc5d2bf6e8263033636-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span><span class=\"crayon-st\">finally</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcc5d2bf6e8263033636-20\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">try</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59bcc5d2bf6e8263033636-21\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">httpClient</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">close</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcc5d2bf6e8263033636-22\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">catch</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">IOException</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">e</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59bcc5d2bf6e8263033636-23\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">e</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">printStackTrace</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcc5d2bf6e8263033636-24\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59bcc5d2bf6e8263033636-25\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcc5d2bf6e8263033636-26\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0043 seconds] -->\r\n<p>打印结果</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59bcc5d2bf6f9203762327\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&gt;&gt;&gt;&gt;&gt;&gt;headers:\r\nServer: bfe/1.0.8.18\r\nDate: Tue, 12 Sep 2017 06:19:06 GMT\r\nContent-Type: text/html\r\nLast-Modified: Mon, 23 Jan 2017 13:28:24 GMT\r\nTransfer-Encoding: chunked\r\nConnection: Keep-Alive\r\nCache-Control: private, no-cache, no-store, proxy-revalidate, no-transform\r\nPragma: no-cache\r\nSet-Cookie: BDORZ=27315; max-age=86400; domain=.baidu.com; path=/\r\n&gt;&gt;&gt;&gt;&gt;&gt;cookies:\r\n[version: 0][name: BDORZ][value: 27315][domain: baidu.com][path: /][expiry: null]</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59bcc5d2bf6f9203762327-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcc5d2bf6f9203762327-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59bcc5d2bf6f9203762327-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcc5d2bf6f9203762327-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59bcc5d2bf6f9203762327-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcc5d2bf6f9203762327-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59bcc5d2bf6f9203762327-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcc5d2bf6f9203762327-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59bcc5d2bf6f9203762327-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcc5d2bf6f9203762327-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59bcc5d2bf6f9203762327-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcc5d2bf6f9203762327-12\">12</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59bcc5d2bf6f9203762327-1\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-v\">headers</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcc5d2bf6f9203762327-2\"><span class=\"crayon-v\">Server</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bfe</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">1.0.8.18</span></div><div class=\"crayon-line\" id=\"crayon-59bcc5d2bf6f9203762327-3\"><span class=\"crayon-v\">Date</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Tue</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">12</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Sep</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2017</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">06</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">19</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">06</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">GMT</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcc5d2bf6f9203762327-4\"><span class=\"crayon-v\">Content</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">Type</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">text</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">html</span></div><div class=\"crayon-line\" id=\"crayon-59bcc5d2bf6f9203762327-5\"><span class=\"crayon-v\">Last</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">Modified</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Mon</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">23</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Jan</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2017</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">13</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">28</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">24</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">GMT</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcc5d2bf6f9203762327-6\"><span class=\"crayon-v\">Transfer</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">Encoding</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">chunked</span></div><div class=\"crayon-line\" id=\"crayon-59bcc5d2bf6f9203762327-7\"><span class=\"crayon-v\">Connection</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Keep</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">Alive</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcc5d2bf6f9203762327-8\"><span class=\"crayon-v\">Cache</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">Control</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">private</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">no</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">cache</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">no</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">store</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">proxy</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">revalidate</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">no</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">transform</span></div><div class=\"crayon-line\" id=\"crayon-59bcc5d2bf6f9203762327-9\"><span class=\"crayon-v\">Pragma</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">no</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">cache</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcc5d2bf6f9203762327-10\"><span class=\"crayon-v\">Set</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">Cookie</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">BDORZ</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">27315</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">max</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">age</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">86400</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">domain</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">baidu</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">com</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">path</span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">/</span></div><div class=\"crayon-line\" id=\"crayon-59bcc5d2bf6f9203762327-11\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-v\">cookies</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcc5d2bf6f9203762327-12\"><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">version</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">name</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">BDORZ</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">value</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">27315</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">domain</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">baidu</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">com</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">path</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">expiry</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0041 seconds] -->\r\n<p>但是也有一些网站返回的cookie并不一定完全符合规范，例如下面这个例子，从打印出的header中可以看到，这个cookie中的Expires属性是时间戳形式，并不符合标准的时间格式，因此，httpclient对于cookie的处理失效，最终无法获取到cookie，并且发出了一条警告信息：“Invalid ‘expires’ attribute: 1505204523”</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59bcc5d2bf701541057164\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n警告: Invalid cookie header: \"Set-Cookie: yd_cookie=90236a64-8650-494b332a285dbd886e5981965fc4a93f023d; Expires=1505204523; Path=/; HttpOnly\". Invalid 'expires' attribute: 1505204523\r\n&gt;&gt;&gt;&gt;&gt;&gt;headers:\r\nDate: Tue, 12 Sep 2017 06:22:03 GMT\r\nContent-Type: text/html\r\nConnection: keep-alive\r\nSet-Cookie: yd_cookie=90236a64-8650-494b332a285dbd886e5981965fc4a93f023d; Expires=1505204523; Path=/; HttpOnly\r\nCache-Control: no-cache, no-store\r\nServer: WAF/2.4-12.1\r\n&gt;&gt;&gt;&gt;&gt;&gt;cookies:</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59bcc5d2bf701541057164-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcc5d2bf701541057164-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59bcc5d2bf701541057164-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcc5d2bf701541057164-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59bcc5d2bf701541057164-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcc5d2bf701541057164-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59bcc5d2bf701541057164-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcc5d2bf701541057164-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59bcc5d2bf701541057164-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59bcc5d2bf701541057164-1\">警告<span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Invalid </span><span class=\"crayon-e\">cookie </span><span class=\"crayon-v\">header</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Set-Cookie: yd_cookie=90236a64-8650-494b332a285dbd886e5981965fc4a93f023d; Expires=1505204523; Path=/; HttpOnly\"</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Invalid</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'expires'</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">attribute</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1505204523</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcc5d2bf701541057164-2\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-v\">headers</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59bcc5d2bf701541057164-3\"><span class=\"crayon-v\">Date</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Tue</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">12</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Sep</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2017</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">06</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">22</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">03</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">GMT</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcc5d2bf701541057164-4\"><span class=\"crayon-v\">Content</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">Type</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">text</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">html</span></div><div class=\"crayon-line\" id=\"crayon-59bcc5d2bf701541057164-5\"><span class=\"crayon-v\">Connection</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">keep</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">alive</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcc5d2bf701541057164-6\"><span class=\"crayon-v\">Set</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">Cookie</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">yd_cookie</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">90236a64</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">8650</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">494b332a285dbd886e5981965fc4a93f023d</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Expires</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1505204523</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Path</span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">/</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">HttpOnly</span></div><div class=\"crayon-line\" id=\"crayon-59bcc5d2bf701541057164-7\"><span class=\"crayon-v\">Cache</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">Control</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">no</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">cache</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">no</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">store</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcc5d2bf701541057164-8\"><span class=\"crayon-v\">Server</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">WAF</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">2.4</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">12.1</span></div><div class=\"crayon-line\" id=\"crayon-59bcc5d2bf701541057164-9\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-v\">cookies</span><span class=\"crayon-o\">:</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0027 seconds] -->\r\n<p>虽然我们可以利用header的数据，重新构造一个cookie出来，也有很多人确实也是这么做的，但这种方法不够优雅，那么如何解决这个问题？网上相关的资料又很少，所以就只能先从官方文档入手。在官方文档3.4小节custom cookie policy中讲到允许自定义的cookie策略，自定义的方法是实现CookieSpec接口，并通过CookieSpecProvider来完成在httpclient中的初始化和注册策略实例的工作。好了，关键的线索在于CookieSpec接口，我们来看一下它的源码：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59bcc5d2bf708822324049\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\npublic interface CookieSpec {\r\n……\r\n    /**\r\n      * Parse the {@ code \"Set-Cookie\"} Header into an array of Cookies.\r\n      *\r\n      * &lt;p&gt; This method will not perform the validation of the resultant&lt;code&gt;\r\n      * {@link Cookie}s&lt;/p&gt;\r\n      *\r\n      * @ see #validate\r\n      *\r\n      * @param header the {@ code Set-Cookie} received from the server\r\n      * @param origin details of the cookie origin\r\n      * @ return an array of {@ code Cookie}s parsed from the header\r\n      * @throws MalformedCookieException if an exception occurs during parsing\r\n      */\r\n    List parse(Header header, CookieOrigin origin) throws MalformedCookieException;\r\n……\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59bcc5d2bf708822324049-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcc5d2bf708822324049-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59bcc5d2bf708822324049-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcc5d2bf708822324049-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59bcc5d2bf708822324049-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcc5d2bf708822324049-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59bcc5d2bf708822324049-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcc5d2bf708822324049-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59bcc5d2bf708822324049-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcc5d2bf708822324049-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59bcc5d2bf708822324049-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcc5d2bf708822324049-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59bcc5d2bf708822324049-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcc5d2bf708822324049-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59bcc5d2bf708822324049-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcc5d2bf708822324049-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59bcc5d2bf708822324049-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcc5d2bf708822324049-18\">18</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59bcc5d2bf708822324049-1\"><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">interface</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">CookieSpec</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcc5d2bf708822324049-2\">……</div><div class=\"crayon-line\" id=\"crayon-59bcc5d2bf708822324049-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcc5d2bf708822324049-4\"><span class=\"crayon-c\">      * Parse the {@ code \"Set-Cookie\"} Header into an array of Cookies.</span></div><div class=\"crayon-line\" id=\"crayon-59bcc5d2bf708822324049-5\"><span class=\"crayon-c\">      *</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcc5d2bf708822324049-6\"><span class=\"crayon-c\">      * &lt;p&gt; This method will not perform the validation of the resultant&lt;code&gt;</span></div><div class=\"crayon-line\" id=\"crayon-59bcc5d2bf708822324049-7\"><span class=\"crayon-c\">      * {@link Cookie}s&lt;/p&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcc5d2bf708822324049-8\"><span class=\"crayon-c\">      *</span></div><div class=\"crayon-line\" id=\"crayon-59bcc5d2bf708822324049-9\"><span class=\"crayon-c\">      * @ see #validate</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcc5d2bf708822324049-10\"><span class=\"crayon-c\">      *</span></div><div class=\"crayon-line\" id=\"crayon-59bcc5d2bf708822324049-11\"><span class=\"crayon-c\">      * @param header the {@ code Set-Cookie} received from the server</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcc5d2bf708822324049-12\"><span class=\"crayon-c\">      * @param origin details of the cookie origin</span></div><div class=\"crayon-line\" id=\"crayon-59bcc5d2bf708822324049-13\"><span class=\"crayon-c\">      * @ return an array of {@ code Cookie}s parsed from the header</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcc5d2bf708822324049-14\"><span class=\"crayon-c\">      * @throws MalformedCookieException if an exception occurs during parsing</span></div><div class=\"crayon-line\" id=\"crayon-59bcc5d2bf708822324049-15\"><span class=\"crayon-c\">      */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcc5d2bf708822324049-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">List </span><span class=\"crayon-e\">parse</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">Header </span><span class=\"crayon-v\">header</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">CookieOrigin </span><span class=\"crayon-v\">origin</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">throws </span><span class=\"crayon-v\">MalformedCookieException</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59bcc5d2bf708822324049-17\">……</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcc5d2bf708822324049-18\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0010 seconds] -->\r\n<p>在源码中我们发现了一个parse方法，看注释就知道正是这个方法，将Set-Cookie的header信息解析为Cookie对象，自然地再了解一下在httplcient中的默认实现DefaultCookieSpec，限于篇幅，源码就不贴了。在默认的实现中，DefaultCookieSpec主要的工作是判断header中Cookie规范的类型，然后再调用具体的某一个实现。像上述这种Cookie，最终是交由NetscapeDraftSpec的实例来做解析，而在NetscapeDraftSpec的源码中，定义了默认的expires时间格式为“EEE, dd-MMM-yy HH:mm:ss z”</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59bcc5d2bf70f503398607\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\npublic class NetscapeDraftSpec extends CookieSpecBase {\r\n\r\n    protected static final String EXPIRES_PATTERN = \"EEE, dd-MMM-yy HH:mm:ss z\";\r\n\r\n    /** Default constructor */\r\n    public NetscapeDraftSpec(final String[] datepatterns) {\r\n        super(new BasicPathHandler(),\r\n                new NetscapeDomainHandler(),\r\n                new BasicSecureHandler(),\r\n                new BasicCommentHandler(),\r\n                new BasicExpiresHandler(\r\n                        datepatterns != null ? datepatterns.clone() : new String[]{EXPIRES_PATTERN}));\r\n    }\r\n\r\n    NetscapeDraftSpec(final CommonCookieAttributeHandler... handlers) {\r\n        super(handlers);\r\n    }\r\n\r\n    public NetscapeDraftSpec() {\r\n        this((String[]) null);\r\n    }\r\n……\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59bcc5d2bf70f503398607-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcc5d2bf70f503398607-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59bcc5d2bf70f503398607-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcc5d2bf70f503398607-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59bcc5d2bf70f503398607-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcc5d2bf70f503398607-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59bcc5d2bf70f503398607-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcc5d2bf70f503398607-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59bcc5d2bf70f503398607-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcc5d2bf70f503398607-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59bcc5d2bf70f503398607-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcc5d2bf70f503398607-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59bcc5d2bf70f503398607-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcc5d2bf70f503398607-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59bcc5d2bf70f503398607-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcc5d2bf70f503398607-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59bcc5d2bf70f503398607-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcc5d2bf70f503398607-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59bcc5d2bf70f503398607-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcc5d2bf70f503398607-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59bcc5d2bf70f503398607-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcc5d2bf70f503398607-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59bcc5d2bf70f503398607-23\">23</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59bcc5d2bf70f503398607-1\"><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">NetscapeDraftSpec</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">extends</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">CookieSpecBase</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcc5d2bf70f503398607-2\"> </div><div class=\"crayon-line\" id=\"crayon-59bcc5d2bf70f503398607-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">protected</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">final</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">EXPIRES_PATTERN</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"EEE, dd-MMM-yy HH:mm:ss z\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcc5d2bf70f503398607-4\"> </div><div class=\"crayon-line\" id=\"crayon-59bcc5d2bf70f503398607-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/** Default constructor */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcc5d2bf70f503398607-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">NetscapeDraftSpec</span><span class=\"crayon-sy\">(</span><span class=\"crayon-m\">final</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">String</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">datepatterns</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59bcc5d2bf70f503398607-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">super</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">BasicPathHandler</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcc5d2bf70f503398607-8\"><span class=\"crayon-h\">                </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">NetscapeDomainHandler</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59bcc5d2bf70f503398607-9\"><span class=\"crayon-h\">                </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">BasicSecureHandler</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcc5d2bf70f503398607-10\"><span class=\"crayon-h\">                </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">BasicCommentHandler</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59bcc5d2bf70f503398607-11\"><span class=\"crayon-h\">                </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">BasicExpiresHandler</span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcc5d2bf70f503398607-12\"><span class=\"crayon-h\">                        </span><span class=\"crayon-v\">datepatterns</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">datepatterns</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">clone</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">String</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">{</span><span class=\"crayon-v\">EXPIRES_PATTERN</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59bcc5d2bf70f503398607-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcc5d2bf70f503398607-14\"> </div><div class=\"crayon-line\" id=\"crayon-59bcc5d2bf70f503398607-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">NetscapeDraftSpec</span><span class=\"crayon-sy\">(</span><span class=\"crayon-m\">final</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">CommonCookieAttributeHandler</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">handlers</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcc5d2bf70f503398607-16\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">super</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">handlers</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59bcc5d2bf70f503398607-17\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcc5d2bf70f503398607-18\"> </div><div class=\"crayon-line\" id=\"crayon-59bcc5d2bf70f503398607-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">NetscapeDraftSpec</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcc5d2bf70f503398607-20\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">String</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59bcc5d2bf70f503398607-21\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcc5d2bf70f503398607-22\">……</div><div class=\"crayon-line\" id=\"crayon-59bcc5d2bf70f503398607-23\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0037 seconds] -->\r\n<p>到这里已经比较清楚了，我们只需要将Cookie中expires的时间转换为正确的格式，然后再送入默认的解析器就可以了。</p>\n<p><strong>解决方法：</strong></p>\n<ol>\n<li>自定义一个CookieSpec类，继承DefaultCookieSpec</li>\n<li>重写parser方法</li>\n<li>将Cookie中的expires转换为正确的时间格式</li>\n<li>调用默认的解析方法</li>\n</ol>\n<p>实现如下（URL就不公开了，已经隐去）</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59bcc5d2bf717091482536\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\npublic class TestHttpClient {\r\n    \r\n    String url = sth;\r\n\r\n    class MyCookieSpec extends DefaultCookieSpec {\r\n        @ Override\r\n        public List parse(Header header, CookieOrigin cookieOrigin) throws MalformedCookieException {\r\n            String value = header.getValue();\r\n            String prefix = \"Expires=\";\r\n            if (value.contains(prefix)) {\r\n                String expires = value.substring(value.indexOf(prefix) + prefix.length());\r\n                expires = expires.substring(0, expires.indexOf(\";\"));\r\n                String date = DateUtils.formatDate(new Date(Long.parseLong(expires) * 1000L),\"EEE, dd-MMM-yy HH:mm:ss z\");\r\n                value = value.replaceAll(prefix + \"\\\\d{10};\", prefix + date + \";\");\r\n            }\r\n            header = new BasicHeader(header.getName(), value);\r\n            return super.parse(header, cookieOrigin);\r\n        }\r\n    }\r\n\r\n    @ Test\r\n    public void getCookie() {\r\n\r\n        CloseableHttpClient httpClient = HttpClients.createDefault();\r\n\r\n        Registry cookieSpecProviderRegistry = RegistryBuilder.create()\r\n                .register(\"myCookieSpec\", context -&gt; new MyCookieSpec()).build();//注册自定义CookieSpec\r\n\r\n        HttpClientContext context = HttpClientContext.create();\r\n        context.setCookieSpecRegistry(cookieSpecProviderRegistry);\r\n\r\n        HttpGet get = new HttpGet(url);\r\n        get.setConfig(RequestConfig.custom().setCookieSpec(\"myCookieSpec\").build());\r\n\r\n        try {\r\n            CloseableHttpResponse response = httpClient.execute(get, context);\r\n            try{\r\n                System.out.println(\"&gt;&gt;&gt;&gt;&gt;&gt;headers:\");\r\n                Arrays.stream(response.getAllHeaders()).forEach(System.out::println);\r\n                System.out.println(\"&gt;&gt;&gt;&gt;&gt;&gt;cookies:\");\r\n                context.getCookieStore().getCookies().forEach(System.out::println);\r\n            }\r\n            finally {\r\n                response.close();\r\n            }\r\n        } catch (IOException e) {\r\n            e.printStackTrace();\r\n        }finally {\r\n            try {\r\n                httpClient.close();\r\n            } catch (IOException e) {\r\n                e.printStackTrace();\r\n            }\r\n        }\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59bcc5d2bf717091482536-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcc5d2bf717091482536-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59bcc5d2bf717091482536-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcc5d2bf717091482536-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59bcc5d2bf717091482536-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcc5d2bf717091482536-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59bcc5d2bf717091482536-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcc5d2bf717091482536-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59bcc5d2bf717091482536-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcc5d2bf717091482536-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59bcc5d2bf717091482536-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcc5d2bf717091482536-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59bcc5d2bf717091482536-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcc5d2bf717091482536-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59bcc5d2bf717091482536-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcc5d2bf717091482536-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59bcc5d2bf717091482536-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcc5d2bf717091482536-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59bcc5d2bf717091482536-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcc5d2bf717091482536-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59bcc5d2bf717091482536-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcc5d2bf717091482536-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59bcc5d2bf717091482536-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcc5d2bf717091482536-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59bcc5d2bf717091482536-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcc5d2bf717091482536-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-59bcc5d2bf717091482536-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcc5d2bf717091482536-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-59bcc5d2bf717091482536-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcc5d2bf717091482536-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-59bcc5d2bf717091482536-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcc5d2bf717091482536-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-59bcc5d2bf717091482536-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcc5d2bf717091482536-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-59bcc5d2bf717091482536-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcc5d2bf717091482536-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-59bcc5d2bf717091482536-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcc5d2bf717091482536-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-59bcc5d2bf717091482536-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcc5d2bf717091482536-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-59bcc5d2bf717091482536-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcc5d2bf717091482536-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-59bcc5d2bf717091482536-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcc5d2bf717091482536-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-59bcc5d2bf717091482536-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcc5d2bf717091482536-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-59bcc5d2bf717091482536-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcc5d2bf717091482536-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-59bcc5d2bf717091482536-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcc5d2bf717091482536-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-59bcc5d2bf717091482536-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcc5d2bf717091482536-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-59bcc5d2bf717091482536-53\">53</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcc5d2bf717091482536-54\">54</div><div class=\"crayon-num\" data-line=\"crayon-59bcc5d2bf717091482536-55\">55</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcc5d2bf717091482536-56\">56</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59bcc5d2bf717091482536-1\"><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">TestHttpClient</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcc5d2bf717091482536-2\"><span class=\"crayon-h\">    </span></div><div class=\"crayon-line\" id=\"crayon-59bcc5d2bf717091482536-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">url</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sth</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcc5d2bf717091482536-4\"> </div><div class=\"crayon-line\" id=\"crayon-59bcc5d2bf717091482536-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">MyCookieSpec</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">extends</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">DefaultCookieSpec</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcc5d2bf717091482536-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">@</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Override</span></div><div class=\"crayon-line\" id=\"crayon-59bcc5d2bf717091482536-7\"><span class=\"crayon-e\">        </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">List </span><span class=\"crayon-e\">parse</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">Header </span><span class=\"crayon-v\">header</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">CookieOrigin </span><span class=\"crayon-v\">cookieOrigin</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">throws</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">MalformedCookieException</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcc5d2bf717091482536-8\"><span class=\"crayon-h\">            </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">value</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">header</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getValue</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59bcc5d2bf717091482536-9\"><span class=\"crayon-h\">            </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">prefix</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Expires=\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcc5d2bf717091482536-10\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">value</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">contains</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">prefix</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59bcc5d2bf717091482536-11\"><span class=\"crayon-h\">                </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">expires</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">value</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">substring</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">value</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">indexOf</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">prefix</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">prefix</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">length</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcc5d2bf717091482536-12\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">expires</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">expires</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">substring</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">expires</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">indexOf</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\";\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59bcc5d2bf717091482536-13\"><span class=\"crayon-h\">                </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">date</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">DateUtils</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">formatDate</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Date</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">Long</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">parseLong</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">expires</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1000L</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">\"EEE, dd-MMM-yy HH:mm:ss z\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcc5d2bf717091482536-14\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">value</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">value</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">replaceAll</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">prefix</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"\\\\d{10};\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">prefix</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">date</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\";\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59bcc5d2bf717091482536-15\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcc5d2bf717091482536-16\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">header</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">BasicHeader</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">header</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getName</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">value</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59bcc5d2bf717091482536-17\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">super</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">parse</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">header</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cookieOrigin</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcc5d2bf717091482536-18\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59bcc5d2bf717091482536-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcc5d2bf717091482536-20\"> </div><div class=\"crayon-line\" id=\"crayon-59bcc5d2bf717091482536-21\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">@</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Test</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcc5d2bf717091482536-22\"><span class=\"crayon-e\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getCookie</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59bcc5d2bf717091482536-23\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcc5d2bf717091482536-24\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">CloseableHttpClient </span><span class=\"crayon-v\">httpClient</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">HttpClients</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">createDefault</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59bcc5d2bf717091482536-25\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcc5d2bf717091482536-26\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">Registry </span><span class=\"crayon-v\">cookieSpecProviderRegistry</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">RegistryBuilder</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">create</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59bcc5d2bf717091482536-27\"><span class=\"crayon-h\">                </span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">register</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"myCookieSpec\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">context</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">MyCookieSpec</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">build</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-c\">//注册自定义CookieSpec</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcc5d2bf717091482536-28\"> </div><div class=\"crayon-line\" id=\"crayon-59bcc5d2bf717091482536-29\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">HttpClientContext </span><span class=\"crayon-v\">context</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">HttpClientContext</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">create</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcc5d2bf717091482536-30\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">context</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setCookieSpecRegistry</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">cookieSpecProviderRegistry</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59bcc5d2bf717091482536-31\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcc5d2bf717091482536-32\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">HttpGet </span><span class=\"crayon-v\">get</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">HttpGet</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">url</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59bcc5d2bf717091482536-33\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">get</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setConfig</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">RequestConfig</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">custom</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setCookieSpec</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"myCookieSpec\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">build</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcc5d2bf717091482536-34\"> </div><div class=\"crayon-line\" id=\"crayon-59bcc5d2bf717091482536-35\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">try</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcc5d2bf717091482536-36\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">CloseableHttpResponse </span><span class=\"crayon-v\">response</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">httpClient</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">execute</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">get</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">context</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59bcc5d2bf717091482536-37\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">try</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcc5d2bf717091482536-38\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">System</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">println</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"&gt;&gt;&gt;&gt;&gt;&gt;headers:\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59bcc5d2bf717091482536-39\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">Arrays</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">stream</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getAllHeaders</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-st\">forEach</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">System</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">out</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">println</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcc5d2bf717091482536-40\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">System</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">println</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"&gt;&gt;&gt;&gt;&gt;&gt;cookies:\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59bcc5d2bf717091482536-41\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">context</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getCookieStore</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getCookies</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-st\">forEach</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">System</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">out</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">println</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcc5d2bf717091482536-42\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59bcc5d2bf717091482536-43\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">finally</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcc5d2bf717091482536-44\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">close</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59bcc5d2bf717091482536-45\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcc5d2bf717091482536-46\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">catch</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">IOException</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">e</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59bcc5d2bf717091482536-47\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">e</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">printStackTrace</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcc5d2bf717091482536-48\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-st\">finally</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59bcc5d2bf717091482536-49\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">try</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcc5d2bf717091482536-50\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">httpClient</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">close</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59bcc5d2bf717091482536-51\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">catch</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">IOException</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">e</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcc5d2bf717091482536-52\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">e</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">printStackTrace</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59bcc5d2bf717091482536-53\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcc5d2bf717091482536-54\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59bcc5d2bf717091482536-55\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcc5d2bf717091482536-56\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0098 seconds] -->\r\n<p>再次运行，顺利地打印出正确的结果，完美！</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59bcc5d2bf71f568834341\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&gt;&gt;&gt;&gt;&gt;&gt;headers:\r\nDate: Tue, 12 Sep 2017 07:24:10 GMT\r\nContent-Type: text/html\r\nConnection: keep-alive\r\nSet-Cookie: yd_cookie=9f521fc5-0248-4ab3ee650ca50b1c7abb1cd2526b830e620f; Expires=1505208250; Path=/; HttpOnly\r\nCache-Control: no-cache, no-store\r\nServer: WAF/2.4-12.1\r\n&gt;&gt;&gt;&gt;&gt;&gt;cookies:\r\n[version: 0][name: yd_cookie][value: 9f521fc5-0248-4ab3ee650ca50b1c7abb1cd2526b830e620f][domain: www.sth.com][path: /][expiry: Tue Sep 12 17:24:10 CST 2017]</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59bcc5d2bf71f568834341-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcc5d2bf71f568834341-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59bcc5d2bf71f568834341-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcc5d2bf71f568834341-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59bcc5d2bf71f568834341-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcc5d2bf71f568834341-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59bcc5d2bf71f568834341-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcc5d2bf71f568834341-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59bcc5d2bf71f568834341-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59bcc5d2bf71f568834341-1\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-v\">headers</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcc5d2bf71f568834341-2\"><span class=\"crayon-v\">Date</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Tue</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">12</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Sep</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2017</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">07</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">24</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">10</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">GMT</span></div><div class=\"crayon-line\" id=\"crayon-59bcc5d2bf71f568834341-3\"><span class=\"crayon-v\">Content</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">Type</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">text</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">html</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcc5d2bf71f568834341-4\"><span class=\"crayon-v\">Connection</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">keep</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">alive</span></div><div class=\"crayon-line\" id=\"crayon-59bcc5d2bf71f568834341-5\"><span class=\"crayon-v\">Set</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">Cookie</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">yd_cookie</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">9f521fc5</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">0248</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">4ab3ee650ca50b1c7abb1cd2526b830e620f</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Expires</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1505208250</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Path</span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">/</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">HttpOnly</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcc5d2bf71f568834341-6\"><span class=\"crayon-v\">Cache</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">Control</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">no</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">cache</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">no</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">store</span></div><div class=\"crayon-line\" id=\"crayon-59bcc5d2bf71f568834341-7\"><span class=\"crayon-v\">Server</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">WAF</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">2.4</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">12.1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcc5d2bf71f568834341-8\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-v\">cookies</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59bcc5d2bf71f568834341-9\"><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">version</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">name</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">yd_cookie</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">value</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">9f521fc5</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">0248</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">4ab3ee650ca50b1c7abb1cd2526b830e620f</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">domain</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">www</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">sth</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">com</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">path</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">expiry</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Tue </span><span class=\"crayon-i\">Sep</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">12</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">17</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">24</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">10</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">CST</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2017</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0029 seconds] -->\r\n<p>本文也发我的个人博客：<a href=\"http://www.fullstackyang.com/archives/416.html\">fullstackyang</a></p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112469\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112469votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112469\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/2653yy\">fullstackyang</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/2653yy\">\r\n\t\t\t<img src=\"http://tp2.sinaimg.cn/2233098320/180/0/1\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            会当凌绝顶，一览众山小——全栈之路        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/2653yy\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/2653yy/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/2653yy/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 3</a> · <a title=\"我的网站\" target=\"_blank\" href=\"http://www.fullstackyang.com\"><i class=\"fa fa-link\"></i></a> <a title=\"微博主页\" target=\"_blank\" href=\"http://weibo.com/2653yy\"><i class=\"fa fa-weibo\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "create_date": "2017-09-14", "title": "HttpClient 获取 Cookie 的一次踩坑实录", "fav_nums": 1, "url": "http://blog.jobbole.com/112469/", "comment_nums": 0, "front_image_path": "full/400ad67cf4361f1937db9bb746d2b7f0b34d3af6.jpg"},{"tags": "IT技术,MySQL,数据库", "url_object_id": "eb3b137648fe2b84ea99ef352615cc1a", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2015/11/e78e36715813f49e9e62fe0c6050075c.png"], "praise_nums": "1", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://draveness.me/sql-index-intro.html\">Draveness</a>   </div><p>在关系型数据库中设计索引其实并不是复杂的事情，很多开发者都觉得设计索引能够提升数据库的性能，相关的知识一定非常复杂。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/09/e53f2b2cf119db0c59de9f83caa31f5e.jpg\" alt=\"Index-and-Performance\"></p>\n<p>然而这种想法是不正确的，索引其实并不是一个多么高深莫测的东西，只要我们掌握一定的方法，理解索引的实现就能在不需要 DBA 的情况下设计出高效的索引。</p>\n<p>本文会介绍 <a href=\"https://www.amazon.cn/%E5%9B%BE%E4%B9%A6/dp/B00ZH27RH0\">数据库索引设计与优化</a> 中设计索引的一些方法，让各位读者能够快速的在现有的工程中设计出合适的索引。</p>\n<h3 id=\"io\">磁盘 IO</h3>\n<p>一个数据库必须保证其中存储的所有数据都是可以随时读写的，同时因为 MySQL 中所有的数据其实都是以文件的形式存储在磁盘上的，而从磁盘上<strong>随机访问</strong>对应的数据非常耗时，所以数据库程序和操作系统提供了缓冲池和内存以提高数据的访问速度。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/09/3eef1adc99076fce083d3b1beea313fd.jpg\" alt=\"Disk-IO\"></p>\n<p>除此之外，我们还需要知道数据库对数据的读取并不是以行为单位进行的，无论是读取一行还是多行，都会将该行或者多行所在的页全部加载进来，然后再读取对应的数据记录；也就是说，读取所耗费的时间与行数无关，只与页数有关。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/09/61d440834e7684466865619054c05717.jpg\" alt=\"Page-DatabaseBufferPool\"></p>\n<p>在 MySQL 中，页的大小一般为 16KB，不过也可能是 8KB、32KB 或者其他值，这跟 MySQL 的存储引擎对数据的存储方式有很大的关系，文中不会展开介绍，不过<strong>索引或行记录是否在缓存池中极大的影响了访问索引或者数据的成本</strong>。</p>\n<h4 id=\"section\">随机读取</h4>\n<p>数据库等待一个页从磁盘读取到缓存池的所需要的成本巨大的，无论我们是想要读取一个页面上的多条数据还是一条数据，都需要消耗<strong>约</strong> 10ms 左右的时间：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/09/0f07e5811a5dc125cc01482284cd2f3f.jpg\" alt=\"Disk-Random-IO\"></p>\n<p>10ms 的时间在计算领域其实是一个非常巨大的成本，假设我们使用脚本向装了 SSD 的磁盘上顺序写入字节，那么在 10ms 内可以写入大概 3MB 左右的内容，但是数据库程序在 10ms 之内只能将一页的数据加载到数据库缓冲池中，从这里可以看出随机读取的代价是巨大的。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/09/bdeb5251f80438e8d19027231912074a.jpg\" alt=\"Disk-IO-Total-Time\"></p>\n<p>这 10ms 的一次随机读取是按照每秒 50 次的读取计算得到的，其中等待时间为 3ms、磁盘的实际繁忙时间约为 6ms，最终数据页从磁盘传输到缓冲池的时间为 1ms 左右，在对查询进行估算时并不需要准确的知道随机读取的时间，只需要知道估算出的 10ms 就可以了。</p>\n<h4 id=\"section-1\">内存读取</h4>\n<p>如果在数据库的<strong>缓存池</strong>中没有找到对应的数据页，那么会去内存中寻找对应的页面：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/09/249d4599ab96b6adc85b9c01c3682e7e.jpg\" alt=\"Read-from-Memory\"></p>\n<p>当对应的页面存在于内存时，数据库程序就会使用内存中的页，这能够将数据的读取时间降低一个数量级，将 10ms 降低到 1ms；MySQL 在执行读操作时，会先从数据库的缓冲区中读取，如果不存在与缓冲区中就会尝试从内存中加载页面，如果前面的两个步骤都失败了，最后就只能执行随机 IO 从磁盘中获取对应的数据页。</p>\n<h4 id=\"section-2\">顺序读取</h4>\n<p>从磁盘读取数据并不是都要付出很大的代价，当数据库管理程序一次性从磁盘中<strong>顺序</strong>读取大量的数据时，读取的速度会异常的快，大概在 40MB/s 左右。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/09/2312998ad76d8fb341969812487f1de4.jpg\" alt=\"Sequential-Reads-from-Disk\"></p>\n<p>如果一个页面的大小为 4KB，那么 1s 的时间就可以读取 10000 个页，读取一个页面所花费的平均时间就是 0.1ms，相比随机读取的 10ms 已经降低了两个数量级，甚至比内存中读取数据还要快。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/09/9ebb7991b42865054e063cefb1a4347b.jpg\" alt=\"Random-to-Sequentia\"></p>\n<p>数据页面的顺序读取有两个非常重要的优势：</p>\n<ol>\n<li>同时读取多个界面意味着总时间的消耗会大幅度减少，磁盘的吞吐量可以达到 40MB/s；</li>\n<li>数据库管理程序会对一些即将使用的界面进行预读，以减少查询请求的等待和响应时间；</li>\n</ol>\n<h4 id=\"section-3\">小结</h4>\n<p>数据库查询操作的时间大都消耗在从磁盘或者内存中读取数据的过程，由于随机 IO 的代价巨大，如何在一次数据库查询中减少随机 IO 的次数往往能够大幅度的降低查询所耗费的时间提高磁盘的吞吐量。</p>\n<h3 id=\"section-4\">查询过程</h3>\n<p>在上一节中，文章从数据页加载的角度介绍了磁盘 IO 对 MySQL 查询的影响，而在这一节中将介绍 MySQL 查询的执行过程中以及数据库中的数据的特征对最终查询性能的影响。</p>\n<h4 id=\"index-slices\">索引片（Index Slices）</h4>\n<p>索引片其实就是 SQL 查询在执行过程中扫描的一个索引片段，在这个范围中的索引将被顺序扫描，根据索引片包含的列数不同，<a href=\"https://www.amazon.cn/%E5%9B%BE%E4%B9%A6/dp/B00ZH27RH0\">数据库索引设计与优化</a> 书中对将索引分为宽索引和窄索引：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/09/305453471fa87c6a090eb4f92003e759.jpg\" alt=\"Thin-Index-and-Fat-Index\"></p>\n<blockquote><p>主键列 <code>id</code> 在所有的 MySQL 索引中都是一定会存在的。</p></blockquote>\n<p>对于查询 <code>SELECT id, username, age FROM users WHERE username=\"draven\"</code> 来说，(id, username) 就是一个窄索引，因为该索引没有包含存在于 SQL 查询中的 age 列，而 (id, username, age) 就是该查询的一个宽索引了，它<strong>包含这个查询中所需要的全部数据列</strong>。</p>\n<p>宽索引能够避免二次的随机 IO，而窄索引就需要在对索引进行顺序读取之后再根据主键 id 从主键索引中查找对应的数据：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/09/d30e5ece6b40f3019e207a701d2c50ad.jpg\" alt=\"Thin-Index-and-Clustered-Index\"></p>\n<p>对于窄索引，每一个在索引中匹配到的记录行最终都需要执行另外的随机读取从聚集索引中获得剩余的数据，如果结果集非常大，那么就会导致随机读取的次数过多进而影响性能。</p>\n<h4 id=\"section-5\">过滤因子</h4>\n<p>从上一小节对索引片的介绍，我们可以看到影响 SQL 查询的除了查询本身还与数据库表中的数据特征有关，如果使用的是窄索引那么对表的随机访问就不可避免，在这时如何让索引片变『薄』就是我们需要做的了。</p>\n<p>一个 SQL 查询扫描的索引片大小其实是由过滤因子决定的，也就是满足查询条件的记录行数所占的比例：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/09/f4149e33e1dccc5702864a629b300bf5.jpg\" alt=\"Filter-Facto\"></p>\n<p>对于 users 表来说，sex=”male” 就不是一个好的过滤因子，它会选择整张表中一半的数据，所以<strong>在一般情况下</strong>我们最好不要使用 sex 列作为整个索引的第一列；而 name=”draven” 的使用就可以得到一个比较好的过滤因子了，它的使用能过滤整个数据表中 99.9% 的数据；当然我们也可以将这三个过滤进行组合，创建一个新的索引 (name, age, sex) 并同时使用这三列作为过滤条件：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/09/f0e821466f63037631b10ca9bce799cb.jpg\" alt=\"Combined-Filter-Facto\"></p>\n<blockquote><p>当三个过滤条件都是等值谓词时，几个索引列的顺序其实是无所谓的，索引列的顺序不会影响同一个 SQL 语句对索引的选择，也就是索引 (name, age, sex) 和 (age, sex, name) 对于上图中的条件来说是完全一样的，这两个索引在执行查询时都有着完全相同的效果。</p></blockquote>\n<p>组合条件的过滤因子就可以达到十万分之 6 了，如果整张表中有 10w 行数据，也只需要在扫描薄索引片后进行 6 次随机读取，这种直接使用乘积来计算组合条件的过滤因子其实有一个比较重要的问题：列与列之间不应该有太强的相关性，如果不同的列之间有相关性，那么得到的结果就会比直接乘积得出的结果大一些，比如：所在的城市和邮政编码就有非常强的相关性，两者的过滤因子直接相乘其实与实际的过滤因子会有很大的偏差，不过这在多数情况下都不是太大的问题。</p>\n<p>对于一张表中的同一个列，不同的值也会有不同的过滤因子，这也就造成了同一列的不同值最终的查询性能也会有很大差别：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/09/3a84a867b9d385867fa3e462cda4f376.jpg\" alt=\"Same-Columns-Filter-Facto\"></p>\n<p>当我们评估一个索引是否合适时，需要考虑极端情况下查询语句的性能，比如 0% 或者 50% 等；最差的输入往往意味着最差的性能，在平均情况下表现良好的 SQL 语句在极端的输入下可能就完全无法正常工作，这也是在设计索引时需要注意的问题。</p>\n<p>总而言之，需要扫描的索引片的大小对查询性能的影响至关重要，而扫描的索引记录的数量，就是总行数与组合条件的过滤因子的乘积，索引片的大小最终也决定了从表中读取数据所需要的时间。</p>\n<h4 id=\"section-6\">匹配列与过滤列</h4>\n<p>假设在 users 表中有 name、age 和 (name, sex, age) 三个辅助索引；当 WHERE 条件中存在类似 age = 21 或者 name = “draven” 这种<strong>等值谓词</strong>时，它们都会成为匹配列（Matching Column）用于选择索引树中的数据行，但是当我们使用以下查询时：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59bc9f22c28ba584606854\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nSELECT * FROM users\r\nWHERE name = \"draven\" AND sex = \"male\" AND age &gt; 20;\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59bc9f22c28ba584606854-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bc9f22c28ba584606854-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59bc9f22c28ba584606854-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59bc9f22c28ba584606854-1\"><span class=\"crayon-e \">SELECT *</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">FROM </span><span class=\"crayon-e\">users</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bc9f22c28ba584606854-2\"><span class=\"crayon-e\">WHERE </span><span class=\"crayon-v\">name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"draven\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">AND</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sex</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"male\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">AND</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">age</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">20</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59bc9f22c28ba584606854-3\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p>虽然我们有 (name, sex, age) 索引包含了上述查询条件中的全部列，但是在这里只有 name 和 sex 两列才是匹配列，MySQL 在执行上述查询时，会选择 name 和 sex 作为匹配列，扫描所有满足条件的数据行，然后将 age 当做过滤列（Filtering Column）：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/09/98f9cda753228126ca4d454edfe18386.jpg\" alt=\"Match-Columns-Filter-Columns\"></p>\n<p>过滤列虽然不能够减少索引片的大小，但是能够减少从表中随机读取数据的次数，所以在索引中也扮演着非常重要的角色。</p>\n<h3 id=\"section-7\">索引的设计</h3>\n<p>作者相信文章前面的内容已经为索引的设计提供了充足的理论基础和知识，从总体来看如何减少随机读取的次数是设计索引时需要重视的最重要的问题，在这一节中，我们将介绍 <a href=\"https://www.amazon.cn/%E5%9B%BE%E4%B9%A6/dp/B00ZH27RH0\">数据库索引设计与优化</a> 一书中归纳出的设计最佳索引的方法。</p>\n<h4 id=\"section-8\">三星索引</h4>\n<p>三星索引是对于一个查询语句可能的最好索引，如果一个查询语句的索引是三星索引，那么它只需要进行<strong>一次磁盘的随机读及一个窄索引片的顺序扫描</strong>就可以得到全部的结果集；因此其查询的响应时间比普通的索引会少几个数量级；根据书中对三星索引的定义，我们可以理解为主键索引对于 <code>WHERE id = 1</code> 就是一个特殊的三星索引，我们只需要对主键索引树进行一次索引访问并且顺序读取一条数据记录查询就结束了。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/09/51b6a983ef0d571b7821f1c88738cf2f.jpg\" alt=\"Three-Star-Index\"></p>\n<p>为了满足三星索引中的三颗星，我们分别需要做以下几件事情：</p>\n<ol>\n<li>第一颗星需要取出所有等值谓词中的列，作为索引开头的最开始的列（任意顺序）；</li>\n<li>第二颗星需要将 ORDER BY 列加入索引中；</li>\n<li>第三颗星需要将查询语句剩余的列全部加入到索引中；</li>\n</ol>\n<blockquote><p>三星索引的概念和星级的给定来源于 <a href=\"https://www.amazon.cn/%E5%9B%BE%E4%B9%A6/dp/B00ZH27RH0\">数据库索引设计与优化</a> 书中第四章三星索引一节。</p></blockquote>\n<p>如果对于一个查询语句我们依照上述的三个条件进行设计，那么就可以得到该查询的三星索引，这三颗星中的最后一颗星往往都是最容易获得的，满足第三颗星的索引也就是上面提到的宽索引，能够避免大量的随机 IO，如果我们遵循这个顺序为一个 SQL 查询设计索引那么我们就可以得到一个完美的索引了；这三颗星的获得其实也没有表面上这么简单，每一颗星都有自己的意义：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/09/8acc115991e8b8f008f9b0a768092dbd.jpg\" alt=\"Behind-Three-Star-Index\"></p>\n<ol>\n<li>第一颗星不只是将等值谓词的列加入索引，它的作用是减少索引片的大小以减少需要扫描的数据行；</li>\n<li>第二颗星用于避免排序，减少磁盘 IO 和内存的使用；</li>\n<li>第三颗星用于避免每一个索引对应的数据行都需要进行一次随机 IO 从聚集索引中读取剩余的数据；</li>\n</ol>\n<p>在实际场景中，问题往往没有这么简单，我们虽然可以总能够通过宽索引避免大量的随机访问，但是在一些复杂的查询中我们无法同时获得第一颗星和第二颗星。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59bc9f22c28ce361835080\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nSELECT id, name, age FROM users\r\nWHERE age BETWEEN 18 AND 21\r\n  AND city = \"Beijing\"\r\nORDER BY name;\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59bc9f22c28ce361835080-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bc9f22c28ce361835080-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59bc9f22c28ce361835080-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bc9f22c28ce361835080-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59bc9f22c28ce361835080-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59bc9f22c28ce361835080-1\"><span class=\"crayon-e\">SELECT </span><span class=\"crayon-v\">id</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">age </span><span class=\"crayon-e\">FROM </span><span class=\"crayon-e\">users</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bc9f22c28ce361835080-2\"><span class=\"crayon-e\">WHERE </span><span class=\"crayon-e\">age </span><span class=\"crayon-i\">BETWEEN</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">18</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">AND</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">21</span></div><div class=\"crayon-line\" id=\"crayon-59bc9f22c28ce361835080-3\"><span class=\"crayon-h\">  </span><span class=\"crayon-st\">AND</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">city</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Beijing\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bc9f22c28ce361835080-4\"><span class=\"crayon-e\">ORDER </span><span class=\"crayon-e\">BY </span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59bc9f22c28ce361835080-5\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p>在上述查询中，我们总可以通过增加索引中的列以获得第三颗星，但是如果我们想要获得第一颗星就需要最小化索引片的大小，这时索引的前缀必须为 (city, age)，在这时再想获得第三颗星就不可能了，哪怕在 age 的后面添加索引列 name，也会因为 name 在范围索引列 age 后面必须进行一次排序操作，最终得到的索引就是 (city, age, name, id)：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/09/0623c023856da52e860cca75c59198a4.jpg\" alt=\"Different-Stars-Index\"></p>\n<p>如果我们需要在内存中避免排序的话，就需要交换 age 和 name 的位置了，在这时就可以得到索引 (city, name, age, id)，当一个 SQL 查询中<strong>同时拥有范围谓词和 ORDER BY 时</strong>，无论如何我们都是没有办法获得一个三星索引的，我们能够做的就是在这两者之间做出选择，是牺牲第一颗星还是第二颗星。</p>\n<p>总而言之，在设计单表的索引时，首先把查询中所有的<strong>等值谓词全部取出</strong>以任意顺序放在索引最前面，在这时，如果索引中同时存在范围索引和 ORDER BY 就需要权衡利弊了，希望最小化扫描的索引片厚度时，应该将<strong>过滤因子最小的范围索引列</strong>加入索引，如果希望避免排序就选择 <strong>ORDER BY 中的全部列</strong>，在这之后就只需要将查询中<strong>剩余的全部列</strong>加入索引了，通过这种固定的方法和逻辑就可以最快地获得一个查询语句的二星或者三星索引了。</p>\n<h3 id=\"section-9\">总结</h3>\n<p>在单表上对索引进行设计其实还是非常容易的，只需要遵循固定的套路就能设计出一个理想的三星索引，在这里强烈推荐 <a href=\"https://www.amazon.cn/%E5%9B%BE%E4%B9%A6/dp/B00ZH27RH0\">数据库索引设计与优化</a> 这本书籍，其中包含了大量与索引设计与优化的相关内容；在之后的文章中读者也会分析介绍书中提供的几种估算方法，来帮助我们通过预估问题设计出更高效的索引。</p>\n<p>如果对文章内容的有疑问，可以在博客下面评论留言（评论系统使用 Disqus，需要翻墙）。</p>\n<blockquote><p>Follow: <a href=\"https://github.com/Draveness\">Draveness · GitHub</a></p></blockquote>\n<h2 id=\"reference\">Reference</h2>\n<ul>\n<li><a href=\"https://www.amazon.cn/%E5%9B%BE%E4%B9%A6/dp/B00ZH27RH0\">数据库索引设计与优化</a></li>\n<li><a href=\"https://dev.mysql.com/doc/refman/5.7/en/innodb-file-space.html\">File Space Management</a></li>\n<li><a href=\"https://www.youtube.com/watch?v=9eMWG3fwiEU\">Inside of Hard Drive – YouTube</a></li>\n<li><a href=\"https://www.youtube.com/watch?v=4iaxOUYalJU\">Hard Disk Working – How does a hard disk work – Hard Drive – YouTube</a></li>\n</ul>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112487\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112487votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112487\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 3 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "create_date": "2017-09-14", "title": "MySQL 索引设计概要", "fav_nums": 3, "url": "http://blog.jobbole.com/112487/", "comment_nums": 0, "front_image_path": "full/35011d6168be00e949624c665041dc724e3ad786.jpg"},{"tags": "IT技术", "url_object_id": "233263be1f318d541c7ac561d840ec1d", "front_image_url": ["http://blog.ippon.tech/content/images/2017/08/Murphys-law.jpg"], "praise_nums": "1", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/snowhere\">孙腾浩</a> 翻译。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"http://blog.ippon.tech/5-laws-every-developer-should-know/\">Raphael Brugier</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p>定律-或称法则，可以指导我们并让我们在同伴的错误中学习。这篇文章中，我将介绍我每次设计或实现软件时出现在我脑海的五大定律。其中有些和开发有关，有些和系统组织有关。它们可以帮助你成为合格的软件工程师。</p>\n<h2>墨菲定律</h2>\n<blockquote><p>“凡事可能出错，就一定出错。”</p></blockquote>\n<p><a href=\"https://en.wikipedia.org/wiki/Murphy%27s_law\">这条定律</a>来源于 Edward Murphy —— 一名航天工程师在 50 年代初对火箭测试失败的回应。这条定律给我们的启示是永远在系统关键地方使用防御性设计，因为系统某些地方总会出错！</p>\n<p>这条定律很容易引入软件工程领域。当你将软件暴露给终端用户，他们会创造性地输入一些出人意料的内容，使系统宕机。所以你需要让你的软件足够健壮，能够检测并警告非预期行为。</p>\n<p>当你在机器上运行软件时，任何地方都有可能发生问题 —— 从硬盘上的系统到数据中心的电力供应。所以你必须确保你设计的架构在每个层级都可以应对故障。</p>\n<p>我曾经有机会领略过几次墨菲定律。 举个例子，我曾经在一个批处理框架中使用字符串“null”来表示空值，我并不认为这有问题，直到有个名字叫“Null”的用户提交了一个交易订单，我们的报表流程中断了几个小时…… 还有一次，在另一个项目中。当所有东西都准备好部署到生产环境了，突然 Azure 基础设施故障导致我们运行自动化脚本的服务器宕机了。</p>\n<p>现实世界中的经验教训提醒着我生活的艰难 —— “凡事可能出错，就一定出错”。 所以，心中牢记墨菲定律，设计健壮的软件。</p>\n<p><img src=\"http://blog.ippon.tech/content/images/2017/08/Murphys-law.jpg\" alt=\"\"></p>\n<h2>Knuth定律</h2>\n<blockquote><p>“在（至少大部分）编程中，过早优化是万恶之源。”</p></blockquote>\n<p><a href=\"https://en.wikiquote.org/wiki/Donald_Knuth#Quotes\">这条定律</a>也是 Donald Knuth 的经典语录之一，它告诫我们不要过早优化应用程序中的代码，直到必须优化时再优化。</p>\n<p>的确，简单易读的源码可以满足 99% 的性能需要，并能提高应用的可维护性。最开始使用简单的解决方案也让后期性能出现问题时更容易迭代和改进。</p>\n<p>垃圾自动回收的编程语言中，字符串的连接常常是过早优化的例子。在 Java 或 C# 中，String 对象是不可变的，我们学会使用其他结构动态创建字符串，比如 <a href=\"https://docs.oracle.com/javase/8/docs/api/java/lang/StringBuilder.html\">StringBuilder</a>。但事实上直到你分析完个应用程序前，你并不知道 String 对象创建了多少次并对性能的产生多大影响。所以首先编写尽可能整洁的代码，之后在必须的时候再优化，往往这样做更有意义。</p>\n<p>然而，这条规则并不应该阻止你去学习编程语言的性能权衡和正确的数据结构。并且，正如所有其他性能问题，你在优化前要测量开销。</p>\n<p><img src=\"http://blog.ippon.tech/content/images/2017/08/performance-timer.jpg\" alt=\"\"></p>\n<h2>North定律</h2>\n<blockquote><p>“每一个决定都是一次权衡”</p></blockquote>\n<p>好吧，我承认这是取自 Dan North 的演讲 <a href=\"https://www.youtube.com/watch?v=EauykEv_2iA\">Decisions,Decisions</a>，它目前还不是公认的定律。 但这条语录影响了我做的每个决定，所以我把它放在这。</p>\n<p>开发者日复一日的生活中，我们每天都做无数个大大小小的决定。从命名变量到自动化（手动）任务，再到定义平台架构。</p>\n<p>这条语录强调无论你做的选择是什么，你总会放弃一个或多个选项</p>\n<p>但这不是最重要的。 最重要的是理智地做出决定，了解其他选项，清楚你为什么不选择它们。你要始终根据当前你掌握的信息来权衡并做出决定。</p>\n<p>但是如果后来你了解到新的信息，并发现之前的决定是错误的，这也没关系。关键是记清楚你为什么做出那个决定，重新评估新的选项之后再做出新的理智的决定。</p>\n<p>重复一遍</p>\n<blockquote><p>“每一个决定都是一次权衡”</p></blockquote>\n<p>所以，做出选择并对所有选项心知肚明。</p>\n<p><img src=\"http://blog.ippon.tech/content/images/2017/08/balance.png\" alt=\"\"></p>\n<h2>Conway定律</h2>\n<blockquote><p>“系统设计的架构受限于生产设计，反映出公司组织的沟通架构”</p></blockquote>\n<p>在 60 年代，一位名叫 Melvin Conway 的工程师注意到公司组织结构影响到他们开发的系统的设计。他用一篇论文描述了这个观点，并命名为“<a href=\"https://en.wikipedia.org/wiki/Conway%27s_law\">Conway定律</a>”。</p>\n<p>这条定律很适用于软件开发领域，甚至体现到代码层面上。交付软件组件的各个团队组织结构直接影响到组件的设计。</p>\n<p>举个例子，一个集中式的开发者团队会开发出各组件耦合的整体应用。另一方面，分布式的团队会开发出单独的（微）服务，每一部分关注点分离清晰。</p>\n<p>这些设计没有好坏之分，但它们都是受到团队沟通方式的影响。在全球有大量独立开发者的开源项目，通常是模块化和可重用库，这就是很有说服力的例子。</p>\n<p>如今，将大的集成应用解耦成微服务已成趋势。这很棒，因为这可以加速交付使用项目。但你也应该牢记 Conway定律，在公司组织构建中投入与技术开发同样多的工作。</p>\n<p><img src=\"http://blog.ippon.tech/content/images/2017/08/PreferFunctionalStaffOrganization.png\" alt=\"\"></p>\n<h2>琐碎定律（帕金森琐碎定律）</h2>\n<blockquote><p>“组织成员投入大量精力到琐碎的事情上。”</p></blockquote>\n<p><a href=\"https://en.wikipedia.org/wiki/Law_of_triviality\">这条定律</a>论点是在会议中花费的时间与事情的价值成反比。的确是这样，人们更愿意把注意力和观点放在他们熟悉的事物上，而不是复杂的问题上。</p>\n<p>帕金森给出一个例子，一场会议中，成员们讨论两件事：为公司建核反应堆和为员工建车棚。建反应堆是一件巨大而复杂的任务，没有人能完全掌控全局。他们完全信赖流程和系统专家，并很快接受了项目。</p>\n<p>另一边，建车棚是一般人都可以做的，每个人都可以对颜色有意见。事实上，每个会议成员都会表达自己的意见，使得建车棚的决议所花费的时间远远超过建反应堆的。</p>\n<p>这条定律在软件行业十分出名，这个故事随后也被称为<a href=\"https://en.wiktionary.org/wiki/bikeshedding\">车棚效应</a></p>\n<p>举个例子，开发者会花费更多时间到讨论正确缩进或函数命名，而不是讨论类的职责或应用架构。这是因为每个人都能认知几个字符的变动，但项目架构的变动则需要巨大的<a href=\"https://en.wikipedia.org/wiki/Cognitive_load\">认知负载</a></p>\n<p>你能注意到的车棚效应的另一个例子是 Scrum 演示。不要误会我，我喜欢演示，我认为这是一个很好的机会来面对用户并获得对应用程序的反馈。但通常 Scrum 演示过程中的讨论会转向琐碎问题，而不是审视全局。这些讨论也很重要，但你应该注意权衡更重要更复杂的问题。</p>\n<p>一旦你了解这种规律，你将在会议和交流中发觉这种行为。 我并不是让你在每次讨论中避免“小”问题，提高你的意识可以帮助你关注真正的问题，并为这些会议做好准备。</p>\n<p><img src=\"http://blog.ippon.tech/content/images/2017/08/pink-bikeshed.jpeg\" alt=\"\"></p>\n<h2>结论</h2>\n<p>这五条定律只是我们行业中总结出的教训中一些例子。随着软件开发经验的增长，我们将会学会更多。 尽管其中某些定律现在看起来是常识，我始终坚信了解这些原则可以帮助你识别这些模式并做出反应。</p>\n\r\n        \r\n            <blockquote class=\"rewards\">\n        <p><strong>打赏支持我翻译更多好文章，谢谢！</strong></p>\n        <a href=\"#rewardbox\" id=\"rewards-button\" class=\"fancybox\"><span class=\"btn-bluet-blue href-style\"><i class=\"fa fa-jpy\"></i> 打赏译者</span></a>\n    </blockquote>\n\n    <div id=\"rewardbox\">\n        <h4>打赏支持我翻译更多好文章，谢谢！</h4>\n                <p>任选一种支付方式</p>\n                <p>\n                        <img src=\"http://jbcdn2.b0.upaiyun.com/2017/01/5085cce1bd4e144b7d148079a34b20c1.jpg\">\n            \n                            <img src=\"http://jbcdn2.b0.upaiyun.com/2017/01/02b09a29fdb3ab5fe03d4bd1afe95664.jpg\">\n                    </p>\n    </div>\n\n    \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112474\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112474votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112474\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/snowhere\">孙腾浩</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/snowhere\">\r\n\t\t\t<img src=\"http://jbcdn2.b0.upaiyun.com/2017/06/47765e50cfb7c4e598e72d893ab4f62f.jpg\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            毕业于郑州大学软件工程专业，身为 Java 程序猿却同样热爱着 JavaScript 。为了兴趣而写代码，做自己喜欢做的事。Keep coding ... Stay Cool ...        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/snowhere\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/snowhere/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/snowhere/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 19</a> · <a title=\"我的网站\" target=\"_blank\" href=\"http://snowhere.me/\"><i class=\"fa fa-link\"></i></a> <a title=\"GitHub主页\" target=\"_blank\" href=\"https://github.com/Snowhere/\"><i class=\"fa fa-github\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "create_date": "2017-09-15", "title": "每个程序员都该知道的五大定理", "fav_nums": 2, "url": "http://blog.jobbole.com/112474/", "comment_nums": 0, "front_image_path": "full/194f7f0606cdb082fda231298934a209f24699c4.jpg"},{"tags": "IT技术,Linux", "url_object_id": "3dd0bd6e615cf2d18c22e1e52fa54c2f", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2016/11/59d49abe8909a122bc2c9aa43b71e3bb.png"], "praise_nums": "1", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://www.networkworld.com/article/3222070/linux/maneuvering-around-run-levels-on-linux.html\">Sandra Henry-stocker</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-8857-1.html\">Linux中国/penghuster</a>   </div><blockquote><p>了解运行级别是如何配置的，如何改变系统运行级别以及修改对应状态下运行的服务。</p></blockquote>\n<p>在 Linux 系统中，运行级别run level是指运维的级别，用于描述一种表明什么服务是可用的系统运行状态。</p>\n<p>运行级别 1 是严格限制的，仅仅用于系统维护；该级别下，网络连接将不可操作，但是管理员可以通过控制台连接登录系统。</p>\n<p>其他运行级别的系统允许任何人登录和使用，但是不同级别中可使用的服务不同。本文将探索如何配置运行级别，如何交互式改变系统运行级别以及修改该状态下可用的服务。</p>\n<p>Linux 系统的默认运行状态是一个在系统开机时使用的运行级别（除非有其他的指示），它通常是在 <code>/etc/inittab</code> 文件中进行配置的，该文件内容通常如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59bc418fc759b970968415\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nid:3:initdefault\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59bc418fc759b970968415-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bc418fc759b970968415-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59bc418fc759b970968415-1\"><span class=\"crayon-v\">id</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">3</span><span class=\"crayon-o\">:</span><span class=\"crayon-i\">initdefault</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bc418fc759b970968415-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>包括 Debian 系统在内的一些系统，默认运行级别为 2，而不是上述文件中的 3，甚至都没有 <code>/etc/inittab</code> 文件。</p>\n<p>运行级别在默认情况下是如何被配置，其配置依赖于你所运行的 Linux 操作系统的具体发行版本。 例如，在某些系统中， 运行级别 2 是多用户模式，运行级别 3 是多用户模式并支持 NFS （网络文件系统）。 在另外一些系统，运行级别 2 – 5 基本相同，运行级别 1 是单用户模式。例如，Debian 系统的所用运行级别如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59bc418fc75a4250960594\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n0 = 停机\r\n1 = 单用户（维护模式）\r\n2 = 多用户模式\r\n3-5 = 同 2 一样\r\n6 = 重启\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59bc418fc75a4250960594-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bc418fc75a4250960594-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59bc418fc75a4250960594-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bc418fc75a4250960594-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59bc418fc75a4250960594-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bc418fc75a4250960594-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59bc418fc75a4250960594-1\"><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span>停机</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bc418fc75a4250960594-2\"><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span>单用户（维护模式）</div><div class=\"crayon-line\" id=\"crayon-59bc418fc75a4250960594-3\"><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span>多用户模式</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bc418fc75a4250960594-4\"><span class=\"crayon-cn\">3</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">5</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span>同<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span>一样</div><div class=\"crayon-line\" id=\"crayon-59bc418fc75a4250960594-5\"><span class=\"crayon-cn\">6</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span>重启</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bc418fc75a4250960594-6\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p>在 Linux 系统上，运行级别 3 用于共享文件系统给其它系统，可以方便地只通过改变系统的运行级别来启动和停止文件系统共享。系统从运行级别 2 改变到 3 系统将允许文件系统共享，反之从运行级别 3 改变到 2 则系统不支持文件系统共享。</p>\n<p>在某个运行级别中，系统运行哪些进程依赖于目录 <code>/etc/rc?.d</code> 目录的内容，其中 <code>?</code> 可以是 2、 3、 4 或 5 （对应于相应的运行级别）。</p>\n<p>在以下示例中（Ubuntu 系统），由于这些目录的配置是相同的，我们将看见上述 4 个级别对应的目录中的内容是一致的。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59bc418fc75a8881071052\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n/etc/rc2.d$ ls\r\nREADME         S20smartmontools      S50saned      S99grub-common\r\nS20kerneloops  S20speech-dispatcher  S70dns-clean  S99ondemand\r\nS20rsync       S20sysstat            S70pppd-dns   S99rc.local\r\n/etc/rc2.d$ cd ../rc3.d\r\n/etc/rc3.d$ ls\r\nREADME         S20smartmontools      S50saned      S99grub-common\r\nS20kerneloops  S20speech-dispatcher  S70dns-clean  S99ondemand\r\nS20rsync       S20sysstat            S70pppd-dns   S99rc.local\r\n/etc/rc3.d$ cd ../rc4.d\r\n/etc/rc4.d$ ls\r\nREADME         S20smartmontools      S50saned      S99grub-common\r\nS20kerneloops  S20speech-dispatcher  S70dns-clean  S99ondemand\r\nS20rsync       S20sysstat            S70pppd-dns   S99rc.local\r\n/etc/rc4.d$ cd ../rc5.d\r\n/etc/rc5.d$ ls\r\nREADME         S20smartmontools      S50saned      S99grub-common\r\nS20kerneloops  S20speech-dispatcher  S70dns-clean  S99ondemand\r\nS20rsync       S20sysstat            S70pppd-dns   S99rc.local\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59bc418fc75a8881071052-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bc418fc75a8881071052-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59bc418fc75a8881071052-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bc418fc75a8881071052-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59bc418fc75a8881071052-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bc418fc75a8881071052-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59bc418fc75a8881071052-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bc418fc75a8881071052-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59bc418fc75a8881071052-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bc418fc75a8881071052-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59bc418fc75a8881071052-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bc418fc75a8881071052-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59bc418fc75a8881071052-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bc418fc75a8881071052-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59bc418fc75a8881071052-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bc418fc75a8881071052-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59bc418fc75a8881071052-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bc418fc75a8881071052-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59bc418fc75a8881071052-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bc418fc75a8881071052-20\">20</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59bc418fc75a8881071052-1\"><span class=\"crayon-o\">/</span><span class=\"crayon-v\">etc</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">rc2</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">d</span><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ls</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bc418fc75a8881071052-2\"><span class=\"crayon-e\">README         </span><span class=\"crayon-e\">S20smartmontools      </span><span class=\"crayon-e\">S50saned      </span><span class=\"crayon-v\">S99grub</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">common</span></div><div class=\"crayon-line\" id=\"crayon-59bc418fc75a8881071052-3\"><span class=\"crayon-e\">S20kerneloops  </span><span class=\"crayon-v\">S20speech</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">dispatcher  </span><span class=\"crayon-v\">S70dns</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">clean  </span><span class=\"crayon-e\">S99ondemand</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bc418fc75a8881071052-4\"><span class=\"crayon-e\">S20rsync       </span><span class=\"crayon-e\">S20sysstat            </span><span class=\"crayon-v\">S70pppd</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">dns   </span><span class=\"crayon-v\">S99rc</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">local</span></div><div class=\"crayon-line\" id=\"crayon-59bc418fc75a8881071052-5\"><span class=\"crayon-o\">/</span><span class=\"crayon-v\">etc</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">rc2</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">d</span><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">cd</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">rc3</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">d</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bc418fc75a8881071052-6\"><span class=\"crayon-o\">/</span><span class=\"crayon-v\">etc</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">rc3</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">d</span><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ls</span></div><div class=\"crayon-line\" id=\"crayon-59bc418fc75a8881071052-7\"><span class=\"crayon-e\">README         </span><span class=\"crayon-e\">S20smartmontools      </span><span class=\"crayon-e\">S50saned      </span><span class=\"crayon-v\">S99grub</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">common</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bc418fc75a8881071052-8\"><span class=\"crayon-e\">S20kerneloops  </span><span class=\"crayon-v\">S20speech</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">dispatcher  </span><span class=\"crayon-v\">S70dns</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">clean  </span><span class=\"crayon-e\">S99ondemand</span></div><div class=\"crayon-line\" id=\"crayon-59bc418fc75a8881071052-9\"><span class=\"crayon-e\">S20rsync       </span><span class=\"crayon-e\">S20sysstat            </span><span class=\"crayon-v\">S70pppd</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">dns   </span><span class=\"crayon-v\">S99rc</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">local</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bc418fc75a8881071052-10\"><span class=\"crayon-o\">/</span><span class=\"crayon-v\">etc</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">rc3</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">d</span><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">cd</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">rc4</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">d</span></div><div class=\"crayon-line\" id=\"crayon-59bc418fc75a8881071052-11\"><span class=\"crayon-o\">/</span><span class=\"crayon-v\">etc</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">rc4</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">d</span><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ls</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bc418fc75a8881071052-12\"><span class=\"crayon-e\">README         </span><span class=\"crayon-e\">S20smartmontools      </span><span class=\"crayon-e\">S50saned      </span><span class=\"crayon-v\">S99grub</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">common</span></div><div class=\"crayon-line\" id=\"crayon-59bc418fc75a8881071052-13\"><span class=\"crayon-e\">S20kerneloops  </span><span class=\"crayon-v\">S20speech</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">dispatcher  </span><span class=\"crayon-v\">S70dns</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">clean  </span><span class=\"crayon-e\">S99ondemand</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bc418fc75a8881071052-14\"><span class=\"crayon-e\">S20rsync       </span><span class=\"crayon-e\">S20sysstat            </span><span class=\"crayon-v\">S70pppd</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">dns   </span><span class=\"crayon-v\">S99rc</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">local</span></div><div class=\"crayon-line\" id=\"crayon-59bc418fc75a8881071052-15\"><span class=\"crayon-o\">/</span><span class=\"crayon-v\">etc</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">rc4</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">d</span><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">cd</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">rc5</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">d</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bc418fc75a8881071052-16\"><span class=\"crayon-o\">/</span><span class=\"crayon-v\">etc</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">rc5</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">d</span><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ls</span></div><div class=\"crayon-line\" id=\"crayon-59bc418fc75a8881071052-17\"><span class=\"crayon-e\">README         </span><span class=\"crayon-e\">S20smartmontools      </span><span class=\"crayon-e\">S50saned      </span><span class=\"crayon-v\">S99grub</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">common</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bc418fc75a8881071052-18\"><span class=\"crayon-e\">S20kerneloops  </span><span class=\"crayon-v\">S20speech</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">dispatcher  </span><span class=\"crayon-v\">S70dns</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">clean  </span><span class=\"crayon-e\">S99ondemand</span></div><div class=\"crayon-line\" id=\"crayon-59bc418fc75a8881071052-19\"><span class=\"crayon-e\">S20rsync       </span><span class=\"crayon-e\">S20sysstat            </span><span class=\"crayon-v\">S70pppd</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">dns   </span><span class=\"crayon-v\">S99rc</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">local</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bc418fc75a8881071052-20\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0037 seconds] -->\r\n<p>这些都是什么文件？它们都是指向 <code>/etc/init.d</code> 目录下用于启动服务的脚本符号连接。 这些文件的文件名是至关重要的， 因为它们决定了这些脚本文件的执行顺序，例如, S20 脚本是在 S50 脚本前面运行的。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59bc418fc75ac845733395\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ ls -l\r\ntotal 4\r\n-rw-r--r-- 1 root root 677 Feb 16  2016 README\r\nlrwxrwxrwx 1 root root  20 Aug 30 14:40 S20kerneloops -&gt; ../init.d/kerneloops\r\nlrwxrwxrwx 1 root root  15 Aug 30 14:40 S20rsync -&gt; ../init.d/rsync\r\nlrwxrwxrwx 1 root root  23 Aug 30 16:10 S20smartmontools -&gt; ../init.d/smartmontools\r\nlrwxrwxrwx 1 root root  27 Aug 30 14:40 S20speech-dispatcher -&gt; ../init.d/speech-dispatcher\r\nlrwxrwxrwx 1 root root  17 Aug 31 14:12 S20sysstat -&gt; ../init.d/sysstat\r\nlrwxrwxrwx 1 root root  15 Aug 30 14:40 S50saned -&gt; ../init.d/saned\r\nlrwxrwxrwx 1 root root  19 Aug 30 14:40 S70dns-clean -&gt; ../init.d/dns-clean\r\nlrwxrwxrwx 1 root root  18 Aug 30 14:40 S70pppd-dns -&gt; ../init.d/pppd-dns\r\nlrwxrwxrwx 1 root root  21 Aug 30 14:40 S99grub-common -&gt; ../init.d/grub-common\r\nlrwxrwxrwx 1 root root  18 Aug 30 14:40 S99ondemand -&gt; ../init.d/ondemand\r\nlrwxrwxrwx 1 root root  18 Aug 30 14:40 S99rc.local -&gt; ../init.d/rc.local\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59bc418fc75ac845733395-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bc418fc75ac845733395-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59bc418fc75ac845733395-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bc418fc75ac845733395-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59bc418fc75ac845733395-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bc418fc75ac845733395-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59bc418fc75ac845733395-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bc418fc75ac845733395-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59bc418fc75ac845733395-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bc418fc75ac845733395-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59bc418fc75ac845733395-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bc418fc75ac845733395-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59bc418fc75ac845733395-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bc418fc75ac845733395-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59bc418fc75ac845733395-15\">15</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59bc418fc75ac845733395-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ls</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">l</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bc418fc75ac845733395-2\"><span class=\"crayon-i\">total</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span></div><div class=\"crayon-line\" id=\"crayon-59bc418fc75ac845733395-3\"><span class=\"crayon-o\">-</span><span class=\"crayon-v\">rw</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">r</span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">r</span><span class=\"crayon-o\">--</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">root </span><span class=\"crayon-i\">root</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">677</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Feb</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">16</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">2016</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">README</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bc418fc75ac845733395-4\"><span class=\"crayon-i\">lrwxrwxrwx</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">root </span><span class=\"crayon-i\">root</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">20</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Aug</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">30</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">14</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">40</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">S20kerneloops</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">init</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">d</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">kerneloops</span></div><div class=\"crayon-line\" id=\"crayon-59bc418fc75ac845733395-5\"><span class=\"crayon-i\">lrwxrwxrwx</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">root </span><span class=\"crayon-i\">root</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">15</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Aug</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">30</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">14</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">40</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">S20rsync</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">init</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">d</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">rsync</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bc418fc75ac845733395-6\"><span class=\"crayon-i\">lrwxrwxrwx</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">root </span><span class=\"crayon-i\">root</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">23</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Aug</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">30</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">16</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">10</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">S20smartmontools</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">init</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">d</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">smartmontools</span></div><div class=\"crayon-line\" id=\"crayon-59bc418fc75ac845733395-7\"><span class=\"crayon-i\">lrwxrwxrwx</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">root </span><span class=\"crayon-i\">root</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">27</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Aug</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">30</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">14</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">40</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">S20speech</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">dispatcher</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">init</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">d</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">speech</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">dispatcher</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bc418fc75ac845733395-8\"><span class=\"crayon-i\">lrwxrwxrwx</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">root </span><span class=\"crayon-i\">root</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">17</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Aug</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">31</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">14</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">12</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">S20sysstat</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">init</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">d</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">sysstat</span></div><div class=\"crayon-line\" id=\"crayon-59bc418fc75ac845733395-9\"><span class=\"crayon-i\">lrwxrwxrwx</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">root </span><span class=\"crayon-i\">root</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">15</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Aug</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">30</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">14</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">40</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">S50saned</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">init</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">d</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">saned</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bc418fc75ac845733395-10\"><span class=\"crayon-i\">lrwxrwxrwx</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">root </span><span class=\"crayon-i\">root</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">19</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Aug</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">30</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">14</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">40</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">S70dns</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">clean</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">init</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">d</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">dns</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">clean</span></div><div class=\"crayon-line\" id=\"crayon-59bc418fc75ac845733395-11\"><span class=\"crayon-i\">lrwxrwxrwx</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">root </span><span class=\"crayon-i\">root</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">18</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Aug</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">30</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">14</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">40</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">S70pppd</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">dns</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">init</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">d</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">pppd</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">dns</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bc418fc75ac845733395-12\"><span class=\"crayon-i\">lrwxrwxrwx</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">root </span><span class=\"crayon-i\">root</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">21</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Aug</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">30</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">14</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">40</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">S99grub</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">common</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">init</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">d</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">grub</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">common</span></div><div class=\"crayon-line\" id=\"crayon-59bc418fc75ac845733395-13\"><span class=\"crayon-i\">lrwxrwxrwx</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">root </span><span class=\"crayon-i\">root</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">18</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Aug</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">30</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">14</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">40</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">S99ondemand</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">init</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">d</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">ondemand</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bc418fc75ac845733395-14\"><span class=\"crayon-i\">lrwxrwxrwx</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">root </span><span class=\"crayon-i\">root</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">18</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Aug</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">30</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">14</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">40</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">S99rc</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">local</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">init</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">d</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">rc</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">local</span></div><div class=\"crayon-line\" id=\"crayon-59bc418fc75ac845733395-15\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0071 seconds] -->\r\n<p>如你所想，目录 <code>/etc/rc1.d</code> 因运行级别 1 的特殊而不同。它包含的符号链接指向非常不同的一套脚本。 同样也要注意到其中一些脚本以 <code>K</code> 开头命名，而另一些与其它运行级别脚本一样以 <code>S</code> 开头命名。这是因为当系统进入单用户模式时， 一些服务需要<strong>停止</strong>。 然而这些 K 开头的符号链接指向了其它级别 S 开头的符号链接的同一文件时， K（kill）表示这个脚本将以指示其停止的参数执行，而不是以启动的参数执行。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59bc418fc75b0779020988\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n/etc/rc1.d$ ls -l\r\ntotal 4\r\nlrwxrwxrwx 1 root root  20 Aug 30 14:40 K20kerneloops -&gt; ../init.d/kerneloops\r\nlrwxrwxrwx 1 root root  15 Aug 30 14:40 K20rsync -&gt; ../init.d/rsync\r\nlrwxrwxrwx 1 root root  15 Aug 30 14:40 K20saned -&gt; ../init.d/saned\r\nlrwxrwxrwx 1 root root  23 Aug 30 16:10 K20smartmontools -&gt; ../init.d/smartmontools\r\nlrwxrwxrwx 1 root root  27 Aug 30 14:40 K20speech-dispatcher -&gt; ../init.d/speech-dispatcher\r\n-rw-r--r-- 1 root root 369 Mar 12  2014 README\r\nlrwxrwxrwx 1 root root  19 Aug 30 14:40 S30killprocs -&gt; ../init.d/killprocs\r\nlrwxrwxrwx 1 root root  19 Aug 30 14:40 S70dns-clean -&gt; ../init.d/dns-clean\r\nlrwxrwxrwx 1 root root  18 Aug 30 14:40 S70pppd-dns -&gt; ../init.d/pppd-dns\r\nlrwxrwxrwx 1 root root  16 Aug 30 14:40 S90single -&gt; ../init.d/single\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59bc418fc75b0779020988-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bc418fc75b0779020988-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59bc418fc75b0779020988-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bc418fc75b0779020988-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59bc418fc75b0779020988-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bc418fc75b0779020988-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59bc418fc75b0779020988-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bc418fc75b0779020988-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59bc418fc75b0779020988-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bc418fc75b0779020988-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59bc418fc75b0779020988-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bc418fc75b0779020988-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59bc418fc75b0779020988-13\">13</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59bc418fc75b0779020988-1\"><span class=\"crayon-o\">/</span><span class=\"crayon-v\">etc</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">rc1</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">d</span><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ls</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">l</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bc418fc75b0779020988-2\"><span class=\"crayon-i\">total</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span></div><div class=\"crayon-line\" id=\"crayon-59bc418fc75b0779020988-3\"><span class=\"crayon-i\">lrwxrwxrwx</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">root </span><span class=\"crayon-i\">root</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">20</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Aug</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">30</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">14</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">40</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">K20kerneloops</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">init</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">d</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">kerneloops</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bc418fc75b0779020988-4\"><span class=\"crayon-i\">lrwxrwxrwx</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">root </span><span class=\"crayon-i\">root</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">15</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Aug</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">30</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">14</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">40</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">K20rsync</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">init</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">d</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">rsync</span></div><div class=\"crayon-line\" id=\"crayon-59bc418fc75b0779020988-5\"><span class=\"crayon-i\">lrwxrwxrwx</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">root </span><span class=\"crayon-i\">root</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">15</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Aug</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">30</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">14</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">40</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">K20saned</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">init</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">d</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">saned</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bc418fc75b0779020988-6\"><span class=\"crayon-i\">lrwxrwxrwx</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">root </span><span class=\"crayon-i\">root</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">23</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Aug</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">30</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">16</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">10</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">K20smartmontools</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">init</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">d</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">smartmontools</span></div><div class=\"crayon-line\" id=\"crayon-59bc418fc75b0779020988-7\"><span class=\"crayon-i\">lrwxrwxrwx</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">root </span><span class=\"crayon-i\">root</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">27</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Aug</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">30</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">14</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">40</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">K20speech</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">dispatcher</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">init</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">d</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">speech</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">dispatcher</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bc418fc75b0779020988-8\"><span class=\"crayon-o\">-</span><span class=\"crayon-v\">rw</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">r</span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">r</span><span class=\"crayon-o\">--</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">root </span><span class=\"crayon-i\">root</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">369</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Mar</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">12</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">2014</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">README</span></div><div class=\"crayon-line\" id=\"crayon-59bc418fc75b0779020988-9\"><span class=\"crayon-i\">lrwxrwxrwx</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">root </span><span class=\"crayon-i\">root</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">19</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Aug</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">30</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">14</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">40</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">S30killprocs</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">init</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">d</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">killprocs</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bc418fc75b0779020988-10\"><span class=\"crayon-i\">lrwxrwxrwx</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">root </span><span class=\"crayon-i\">root</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">19</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Aug</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">30</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">14</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">40</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">S70dns</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">clean</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">init</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">d</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">dns</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">clean</span></div><div class=\"crayon-line\" id=\"crayon-59bc418fc75b0779020988-11\"><span class=\"crayon-i\">lrwxrwxrwx</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">root </span><span class=\"crayon-i\">root</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">18</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Aug</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">30</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">14</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">40</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">S70pppd</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">dns</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">init</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">d</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">pppd</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">dns</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bc418fc75b0779020988-12\"><span class=\"crayon-i\">lrwxrwxrwx</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">root </span><span class=\"crayon-i\">root</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">16</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Aug</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">30</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">14</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">40</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">S90single</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">init</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">d</span><span class=\"crayon-o\">/</span><span class=\"crayon-i\">single</span></div><div class=\"crayon-line\" id=\"crayon-59bc418fc75b0779020988-13\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0060 seconds] -->\r\n<p>你可以改变系统的默认运行级别，尽管这很少被用到。例如，通过修改前文中提到的 <code>/etc/inittab</code> 文件，你能够配置 Debian 系统的默认运行级别为 3 （而不是 2），以下是该文件示例：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59bc418fc75b4655623070\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nid:3:initdefault:\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59bc418fc75b4655623070-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bc418fc75b4655623070-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59bc418fc75b4655623070-1\"><span class=\"crayon-v\">id</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">3</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">initdefault</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bc418fc75b4655623070-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>一旦你修改完成并重启系统， <code>runlevel</code> 命令将显示如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59bc418fc75b7954340548\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ runlevel\r\nN 3\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59bc418fc75b7954340548-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bc418fc75b7954340548-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59bc418fc75b7954340548-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59bc418fc75b7954340548-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">runlevel</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bc418fc75b7954340548-2\"><span class=\"crayon-i\">N</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span></div><div class=\"crayon-line\" id=\"crayon-59bc418fc75b7954340548-3\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>另外一种可选方式，使用 <code>init 3</code> 命令，你也能改变系统运行级别（且无需重启立即生效）， <code>runlevel</code> 命令的输出为：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59bc418fc75ba301651215\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ runlevel\r\n2 3\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59bc418fc75ba301651215-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bc418fc75ba301651215-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59bc418fc75ba301651215-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59bc418fc75ba301651215-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">runlevel</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bc418fc75ba301651215-2\"><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span></div><div class=\"crayon-line\" id=\"crayon-59bc418fc75ba301651215-3\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>当然，除非你修改了系统默认级别的 <code>/etc/rc?.d</code> 目录下的符号链接，使得系统默认运行在一个修改的运行级别之下，否则很少需要通过创建或修改 <code>/etc/inittab</code> 文件改变系统的运行级别。</p>\n<h3 id=\"toc_1\">在 Linux 系统中如何使用运行级别？</h3>\n<p>为了扼要重述在系统中如何使用运行级别，下面有几个关于运行级别的快速问答问题：</p>\n<p><strong>如何查询系统当前的运行级别？</strong></p>\n<p>使用 <code>runlevel</code> 命令。</p>\n<p><strong>如何查看特定运行级别所关联的服务进程？</strong></p>\n<p>查看与该运行级别关联的运行级别开始目录（例如， <code>/etc/rc2.d</code> 对应于运行级别 2）。</p>\n<p><strong>如何查看系统的默认运行级别？</strong></p>\n<p>首先，查看 <code>/etc/inittab</code> 文件是否存在。如果不存在，就执行 <code>runlevel</code> 命令查询，你一般就已经处在该运行级别。</p>\n<p><strong>如何改变系统运行级别？</strong></p>\n<p>用 <code>init</code> 命令（例如 <code>init 3</code>）临时改变运行级别，通过修改或创建 <code>/etc/inittab</code> 文件永久改变其运行级别。</p>\n<p><strong>能改变特定运行级别下运行的服务么？</strong></p>\n<p>当然，通过改变对应的 <code>/etc/rc?.d</code> 目录下的符号连接即可。</p>\n<p><strong>还有一些其他的什么需要考虑？</strong></p>\n<p>当改变系统运行级别时，你应该特别小心，确保不影响到系统上正在运行的服务或者正在使用的用户。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112479\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112479votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112479\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "create_date": "2017-09-14", "title": "漫谈传统的 Linux 初始化系统的运行级别", "fav_nums": 0, "url": "http://blog.jobbole.com/112479/", "comment_nums": 0, "front_image_path": "full/d3d1a5ad957de059084690efae6fdfaa3527e1c3.jpg"},{"tags": "IT技术,数据库", "url_object_id": "e46f82608b69c33c31063358c6a14cf5", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/03/4bae6998d00f180d42c7da716e3d0bb2.jpg"], "praise_nums": "1", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://my.oschina.net/wangxindong/blog/1531596\">新栋BOOK</a>   </div><h3>1、定义</h3>\n<p>何谓数据异构，上周交易部门商品的同事过来做分享，又看到这个词，他的PPT里面是 数据库异构。其实我们以前做的事情，也是可以成为数据异构。比如我们将DB里面的数据持久化到REDIS里面去，就是一种数据异构的方式。如果要下个定义的话：<strong>把数据按需（数据结构、存取方式、存取形式）异地构建存储。</strong></p>\n<h3>2、常见应用场景</h3>\n<p>分库分表中有一个最为常见的场景，为了提升数据库的查询能力，我们都会对数据库做分库分表操作。比如订单库，开始的时候我们是按照订单ID维度去分库分表，那么后来的业务需求想按照商家维度去查询，比如我想查询某一个商家下的所有订单，就非常麻烦。这个时候通过数据异构就能很好的解决此问题，比如下图</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/fa46be3f45850ad48951742bb9ec51df.png\" alt=\"异构维度.png\"></p>\n<p style=\"text-align: center\">异构维度</p>\n<p style=\"text-align: left\"><strong>总结起来大概有以下几种场景</strong></p>\n<ol>\n<li>数据库镜像</li>\n<li>数据库实时备份</li>\n<li>多级索引</li>\n<li>search build（比如分库分表后的多维度数据查询）</li>\n<li>业务cache刷新</li>\n<li>价格、库存变化等重要业务消息</li>\n</ol>\n<h3>3、数据异构方向</h3>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/939f4abdb92c7c0ce9a8ba0918d85180.png\" alt=\"异构的几种方向.png\"></p>\n<p style=\"text-align: center\">几种异构方式</p>\n<p>在日常业务开发中大致可以分为以上几种数据去向，DB-DB这种方式，一般常见于分库分表后，聚合查询的时候，比如我们按照订单ID去分库分表，那么这个时候我们要按照用户ID去查询，查询这个用户下面的订单就非常不方便了，当然可以使用统一加到内存中去，但这样不太好。所以我们就可以用数据库异构的方式，重新按照用户ID的维度来分一个表，像在上面常见应用场景中介绍的那样。把数据异构到redis、elasticserach、slor中去要解决的问题跟按照多维度来查询的需求差不多。这些存储天生都有聚合的功能。当然同时也可以提高查询性能，应对大访问量，比如redis这种抗量银弹。</p>\n<h3>4、数据异构的常用方法</h3>\n<h4>3.1、完整克隆</h4>\n<p>这个很简单就是将数据库A，全部拷贝一份到数据库B，这样的使用场景是离线统计跑任务脚本的时候可以。缺点也很突出，不适用于持续增长的数据。</p>\n<h4>3.2、标记同步</h4>\n<p>这个是业务场景比较简单的时候，理想情况下数据不会发生改变，比如日志数据，这个时候可以去标记，比如时间戳，这样当发生故障的时候还可以回溯到上一次同步点，开始重新同步数据。</p>\n<h4>3.3、BINLOG方式</h4>\n<p>通过实时的订阅mysql的binlog日志，消费到这些日志后，重新构建数据结构插入一个新的数据库或者是其他存储比如es、slor等等。订阅binlog日志可以比较好的能保证数据的一致性。</p>\n<h4>3.4、MQ方式</h4>\n<p>业务数据写入DB的同时，也发送MQ一份，也就是业务里面实现双写。这种方式比较简单，但也很难保证数据一致性，对简单的业务场景可以采用这种方式。</p>\n<h3>5、binlog和mq方式重点介绍</h3>\n<h4>5.1、binlog</h4>\n<h5>5.1.1、订阅binglog日志异构流程图</h5>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/a8369973e6880af9e85c3c0477430595.png\" alt=\"canal异构方式.png\"></p>\n<p style=\"text-align: center\">canal异构方式</p>\n<h5>5.1.2、使用说明</h5>\n<p>binglog是数据的日志记录方式，每次对数据的操作都会有binlog日志。现在开源的订阅binlog日志的组件，比如使用比较广泛的canal，它是阿里开源的基于mysql数据库binlog的增量订阅和消费组件。由于cannal服务器目前读取的binlog事件只保存在内存中，并且只有一个canal客户端可以进行消费。所以如果需要多个消费客户端，可以引入activemq或者kafka。如上图绿色虚线框部分。我们还需要确保全量对比来保证数据的一致性（canal+mq的重试机制基本可以保证写入异构库之后的数据一致性），这个时候可以有一个全量同步WORKER程序来保证，如上图深绿色部分。</p>\n<h5>5.1.3、canal的工作原理</h5>\n<p>先来看下mysql主备（主从）复制原理如下图，在此原理基础之上我们再来理解canal的实现原理就一眼能明白了。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/daadf7db68a30d1e844ebee84d7f854c.jpg\" alt=\"mysql主备复制实现原理.jpg\"></p>\n<p style=\"text-align: center\">mysql主备复制实现原理</p>\n<p style=\"text-align: left\"><strong>mysql主备（主从）复制原理，从上层来看，复制分成三步：</strong></p>\n<ol>\n<li>master将改变记录到二进制日志(binary log)中（这些记录叫做二进制日志事件，binary log events，可以通过show binlog events进行查看）；</li>\n<li>slave将master的binary log events拷贝到它的中继日志(relay log)；</li>\n<li>slave重做中继日志中的事件，将改变反映它自己的数据。<br>\n再来看下canal的原理，如下图：<br>\n<img src=\"http://jbcdn2.b0.upaiyun.com/2017/09/a82380169db0d36662aaefb8c910003a.jpg\" alt=\"canal工作原理.jpg\"><br>\n<strong>cannal实现原理相对比较简单（参照上面的mysql主备复制实现原理）：</strong></li>\n<li>canal模拟mysql slave的交互协议，伪装自己为mysql slave，向mysql master发送dump协议</li>\n<li>mysql master收到dump请求，开始推送binary log给slave(也就是canal)</li>\n<li>canal解析binary log对象(原始为byte流)<br>\n我们在部署canal server的时候要部署多台，来保证高可用。但是canal的原理，是只有一台服务器在跑处理，其它的服务器作为热备。canal server的高可用是通过zookeeper来维护的。<br>\n<strong>有关canal更具体的使用和详细原理请参照：<a href=\"https://github.com/alibaba/canal\" target=\"_blank\" rel=\"nofollow\">https://github.com/alibaba/canal</a></strong></li>\n</ol>\n<h5>5.1.4、注意点</h5>\n<ul>\n<li>1、确认MySQL开启binlog，使用<strong>show variables like ‘log_bin’;</strong> 查看ON为已开启</li>\n<li>2、确认目标库可以产生binlog，<strong>show master status</strong> 注意Binlog_Do_DB，Binlog_Ignore_DB参数</li>\n<li>3、确认binlog格式为ROW，使用<strong>show variables like ‘binlog_format’;</strong> 非ROW模式登录MySQL执行 <strong>set global binlog_format=ROW; flush logs;</strong> 或者通过更改MySQL配置文件并重启MySQL生效。</li>\n<li>4、为保证binlake服务可以获取Binlog，需添加授权，执行 <strong>GRANT SELECT, REPLICATION SLAVE, REPLICATION CLIENT ON <em>.</em> TO ‘admin’@’%’ identified by ‘admin’; FLUSH PRIVILEGES;</strong></li>\n</ul>\n<h4>5.2、mq方式</h4>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/fd773d9eb65abb904785d4dbd31196d3.png\" alt=\"MQ异构方式.png\"></p>\n<p style=\"text-align: center\">MQ异构方式</p>\n<p>mq的方式，就相对简单，实际上是在业务逻辑中写DB的同时去写一次MQ，但是这种方式不能够保证数据一致性，就是不能保证跨资源的事务。<strong>注：调用第三方远程RPC的操作一定不要放到事务中。</strong></p>\n<h3>6、总结</h3>\n<p>本文主要叙述了数据异构的使用场景，方法。这里面涉及到的activemq以及canal并没有深入分析，关于这块的内容可以直接参考相关具体文档，文中已给了链接地址。根据数据异构的定义，将数据异地构建存储，我们可以应用的地方就非常多，文中说的分库分表之后按照其它维度来查询的时候，我们想脱离DB直接用缓存比如redis来抗量的时候。数据异构这种方式都能够很好的帮助我们来解决诸如此类的问题。<br>\n<strong>转载请注明出处，并附上链接 https://my.oschina.net/wangxindong/blog/1531596</strong><br>\n参考资料：<a href=\"https://github.com/alibaba/canal\" target=\"_blank\" rel=\"nofollow\">https://github.com/alibaba/canal</a></p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112466\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112466votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112466\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "create_date": "2017-09-12", "title": "数据异构的武器-BINLOG+MQ", "fav_nums": 0, "url": "http://blog.jobbole.com/112466/", "comment_nums": 0, "front_image_path": "full/117976068e2e847f1067d25ea3fa90a3b5a60f3f.jpg"},{"tags": "IT技术,Yelp,图片压缩", "url_object_id": "fc531aa1eebe55fcb9eee070c03a6911", "front_image_url": ["http://wx1.sinaimg.cn/mw690/7cc829d3gy1fjgtf2uq3bj218s0rdwot.jpg"], "praise_nums": "3", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/fengzhuang19940106\">iScream</a> 翻译，<a href=\"http://www.jobbole.com/members/hanxiaomax\">艾凌风</a> 校稿。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"https://engineeringblog.yelp.com/2017/06/making-photos-smaller.html\">Yelp</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p>Yelp 拥有超过 1 亿张由用户生成的照片，这些照片从晚餐、理发，到我们最新的功能之一：yelfies。这些图像占据了用户 APP 和网站的大部分带宽，这意味着存储和传输的巨大成本。为了向用户提供最好的体验，我们努力优化这些图片并将其平均大小缩小了 30%。这样节省了用户的时间和带宽，并降低了为这些图像提供服务的成本。哦，我们这样做都没有降低图像的质量呢！</p>\n<p><img class=\"alignnone\" src=\"http://wx1.sinaimg.cn/mw690/7cc829d3gy1fjgtf2uq3bj218s0rdwot.jpg\" width=\"690\" height=\"422\"></p>\n<h3>背景</h3>\n<p>Yelp 已经帮用户存储上传的照片超过 12 年了。我们那些将无损格式的图片（PNG，GIF）保存成 PNG 格式，而所有其他的格式的图片则保存成 JPEG 格式。我们保存图片用的是 Python 和 Pillow，并使用如下代码片段，开启了我们照片上传的故事：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59bcc98db4e73945797173\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# do a typical thumbnail, preserving aspect ratio\r\nnew_photo = photo.copy()\r\nnew_photo.thumbnail(\r\n    (width, height),\r\n    resample=PIL.Image.ANTIALIAS,\r\n)\r\nthumbfile = cStringIO.StringIO()\r\nsave_args = {'format': format}\r\nif format == 'JPEG':\r\n    save_args['quality'] = 85\r\nnew_photo.save(thumbfile, **save_args)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59bcc98db4e73945797173-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcc98db4e73945797173-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59bcc98db4e73945797173-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcc98db4e73945797173-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59bcc98db4e73945797173-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcc98db4e73945797173-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59bcc98db4e73945797173-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcc98db4e73945797173-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59bcc98db4e73945797173-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcc98db4e73945797173-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59bcc98db4e73945797173-11\">11</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59bcc98db4e73945797173-1\"><span class=\"crayon-p\"># do a typical thumbnail, preserving aspect ratio</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcc98db4e73945797173-2\"><span class=\"crayon-v\">new_photo</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">photo</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">copy</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59bcc98db4e73945797173-3\"><span class=\"crayon-v\">new_photo</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">thumbnail</span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcc98db4e73945797173-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">width</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">height</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59bcc98db4e73945797173-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">resample</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">PIL</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Image</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">ANTIALIAS</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcc98db4e73945797173-6\"><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59bcc98db4e73945797173-7\"><span class=\"crayon-v\">thumbfile</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cStringIO</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">StringIO</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcc98db4e73945797173-8\"><span class=\"crayon-v\">save_args</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'format'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">format</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59bcc98db4e73945797173-9\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">format</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'JPEG'</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcc98db4e73945797173-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">save_args</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'quality'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">85</span></div><div class=\"crayon-line\" id=\"crayon-59bcc98db4e73945797173-11\"><span class=\"crayon-v\">new_photo</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">save</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">thumbfile</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">save_args</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0019 seconds] -->\r\n<p>以此作为起点，我们开始研究潜在的文件大小优化方法，可以让我们在不损失质量的前提下使用。</p>\n<h3 id=\"optimizations\">优化</h3>\n<p>首先，我们不得不决定是自己来处理这个问题，还是让 CDN 提供商用他们的魔力来神奇地改变我们的照片。在优先保证高质量的内容前提下，去评估众多选项并使得潜在的尺寸与质量相互抵消是有意义的。我们先行调查了当前照片文件大小缩小的现状 – 可以做出什么改变，以及与每个改变相关联的大小/质量下降。随着这项调查的完成，我们决定从三大类方法来着手。这篇文章剩下的部分解释了我们做了什么，并在每项优化中获得了多少收益。</p>\n<p><strong>1.Pillow中的改变</strong></p>\n<ul>\n<li>优化标志</li>\n<li>渐进的JPEG</li>\n</ul>\n<p><strong>2.应用照片逻辑的更改</strong></p>\n<ul>\n<li>大型 PNG 格式图的检测</li>\n<li>动态 JPEG 质量</li>\n</ul>\n<p><strong>3.JPEG编码器更改</strong></p>\n<ul>\n<li>Mozjpeg（网格量化，自定义量化矩阵）</li>\n</ul>\n<h3 id=\"changes-in-pillow\">Pillow 中的改变</h3>\n<h3 id=\"optimize-flag\">标志位优化</h3>\n<p>这是我们最简单的更改之一：启用 Pillow 中的设置，以 CPU 耗时为代价（optimize = True）来节约更多的文件大小。 由于该权衡的本质，这样做并不会影响图像质量。</p>\n<p>对于 JPEG 格式的图片，该标志位会指示编码器，通过扫描每张图片做一次附加的遍历，来找到最佳霍夫曼编码。对每张图片的第一遍扫描，我们不是写入文件，而是计算每个值的出现统计，这是计算理想编码所需要信息。PNG 内部使用 zlib，因此在这种情况下，标志位优化能有效地指示编码器使用 gzip -9，而不是 gzip -6。</p>\n<p>这是一项简单的改进，但事实证明它并非灵丹妙药，只减少百分之几的文件大小。</p>\n<h3 id=\"progressive-jpeg\">渐进式 JPEG</h3>\n<p>将图像保存为 JPEG 格式时，你可以选择几种不同的类型：</p>\n<ul>\n<li>从上到下加载的 JPEG 标准图像。</li>\n<li>渐进式 JPEG 图像，从较模糊加载到较不模糊。Pillow（progressive = True）可以轻松地启用渐进式选项。 因而，人类肉眼可感知到性能有了提升（也就是说，当图像部分缺失时，更容易注意到它不是完全锐利的）。</li>\n</ul>\n<p>此外，渐进式文件打包方式通常会使得文件尺寸减少。如维基百科文章中所详尽解释的那样，JPEG 格式在 8×8 像素块上使用 Z 字形模式进行熵编码。当这些像素块的值被解包并按顺序排列时，我们通常首先得到的是非零数字，然后是 0 的序列，用该模式对于图像中的每个 8×8 块进行重复和交织。在使用渐进编码时，解开的像素块的顺序发生了改变。每个块值较高的数字会首先出现文件中（它给出了渐进式图像最早扫描到的不同阻塞），并且那些能增加出色细节的小数字（包括更多的 0），它们的跨度将更长，并一直持续到末位。图像数据的这种重新排序不会改变图像本身，而是增加了在一行中的可能存在的 0 的数量（这样可以更容易地压缩）。</p>\n<p>与由用户贡献的美味甜甜圈图像做比较（点击查看大图）：</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/06/7f058d53944b33506d3375138eca77b4.gif\"><img class=\"alignnone wp-image-65555\" src=\"http://jbcdn2.b0.upaiyun.com/2017/06/7f058d53944b33506d3375138eca77b4.gif\" alt=\"baseline-tiny\" width=\"299\" height=\"220\"></a></p>\n<p>（1）标准 JPEG 格式图渲染的模拟</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/06/2f553920cd4b568166bdbbfb5c0a3b40.gif\"><img class=\"alignnone wp-image-65554\" src=\"http://jbcdn2.b0.upaiyun.com/2017/06/2f553920cd4b568166bdbbfb5c0a3b40.gif\" alt=\"progressive-tiny\" width=\"299\" height=\"220\"></a></p>\n<p>（2）渐进式 JPEG 格式图渲染的模拟。</p>\n<h3 id=\"changes-to-application-photo-logic\">应用照片逻辑的改变</h3>\n<h3 id=\"large-png-detection\">大型 PNG 格式图片的检测</h3>\n<p>Yelp 为用户生成的内容提供了两种图像格式 –  JPEG 和 PNG。JPEG 是一种很好的照片格式，但通常会与高对比度设计内容（如 logo）相结合。相比之下，PNG 是完全无损的，非常适合图形，但对于那些小失真不可见的照片来说占用的空间太大了。在用户上传实际照片是 PNG 格式的情况下，我们识别这些文件并将其另存为 JPEG 格式，可节省下大量的存储空间。Yelp 上一些常见的 PNG 照片来源于移动设备由和应用程序拍摄的截图，这些照片是通过添加特效或边框修饰了的。</p>\n<p><img src=\"https://engineeringblog.yelp.com/images/posts/2017-05-31-making-images-smaller/example-pngs.png\"></p>\n<p>（左）一个典型的具有 logo 和边框的复合 PNG 格式的上传图。 （右）一个典型的来自于屏幕截图的 PNG 格式的上传图。</p>\n<p>我们想减少这些不必要的 PNG 格式的图片数量，但重要的是要避免矫枉过正或降低了 logo 和图形等的质量。我们应该如何区分出一张图片中属于照片的部分呢？从像素层面可以做到吗？</p>\n<p>使用了 2500 张图片作为实验样本后，我们发现文件大小和独特像素的结合可以很好地区分照片。我们用我们最大的分辨率生成候选缩略图，看看输出PNG文件是否大于 300 KiB。如果是，我们还将检查图像内容，查看是否有超过 2^16 种独特颜色（Yelp 将 RGBA 格式的上传图片转成 RGB 格式，但如果没这样做的话，我们也会检查）。</p>\n<p>在实验数据集中，那些手动调整阈值来定义成“ bigness ”占了有可能缩小的文件大小的 88％（即如果我们要转换所有图像，我们预期的文件大小的缩小），这是在不会导致转换后图形的任何假阳性的前提下进行的。</p>\n<p id=\"dynamic-jpeg-quality\"><strong>动态的 JPEG 质量</strong></p>\n<p>缩小 JPEG 文件大小的第一个也是最为人所知的一种方式是称为质量的设置。许多能保存 JPEG 格式图片的应用程序会将质量指定为一个数字。</p>\n<p>质量这个词有点抽象。事实上，一幅 JPEG 格式的图像的每个颜色通道都有单独的质量。质量等级从 0 到 100 映射到颜色通道的不同量化表，取决于丢失了多少数据（通常是高频成分）。信号域中的量化是 JPEG 编码过程中丢失信息的步骤之一。</p>\n<p>减小文件大小的最简单的方法是降低图像的质量，这会引入更多的噪声。不是每张图片在一个给定的相同质量水平上都会丢失相同的信息量。</p>\n<p>我们可以为每张图片动态地选择一种质量优化设置，找到质量和存储大小之间的理想平衡。有两种方法可以做到这一点：</p>\n<ul>\n<li>自下而上：这些是通过处理 8 x 8 像素块级别的图像生成调谐量化表的算法。它们计算出丢失了多少理论上的质量，以及丢失的数据如何放大或消除，对人眼可见失真的多或少。</li>\n<li>自上而下的：这些算法是将整张图片与其原始无失真版本进行比较，检测丢失了多少信息。通过迭代生成具有不同质量设置的候选图像，我们可以选择其中一张图片，作为满足某种评估算法的最低评估水平的图像。</li>\n</ul>\n<p style=\"text-align: left;\">我们评估了一种自下而上的算法，在实验中，在我们希望使用的质量范围的上限内没有产生合适的结果（尽管它似乎仍然具有中档图像质量的潜力， 这时编码器可以开始更冒险地去丢弃它的字节）。关于这一策略的众多学术论文在90年代初就有发表，该方法对计算能力要求很高，并且走了选项 B 地址这类的捷径，例如不评估块之间的交互。</p>\n<p>所以我们采取了第二种方法：使用对分的算法生成不同质量水平的候选图像，并通过使用 pyssim 函数来计算其结构相似性度量（SSIM），来评估每个候选图像的质量下降，直到该值处于可配置但阈值也还处于静态。这允许我们选择性地降低文件的平均大小（和平均质量），仅仅针对那些已经开始产生肉眼可识别的质量下降的图像。</p>\n<p>在下图中，我们绘制了用3种不同质量方法生成的 2500 张图像的SSIM值的表。</p>\n<p>1、用一种质量为 85 的初始方法作出原始图像，使用蓝线来绘制。</p>\n<p><span style=\"font-weight: normal; text-align: center;\">2、一种能降低文件大小，质量改为 80 的替代方法，用红线来绘制。</span></p>\n<p><span style=\"font-weight: normal; text-align: center;\">3、</span><span style=\"font-weight: normal; text-align: center;\">我们在最后选用了一种方法，使用橙色绘制动态质量的 SSIM 为 80 – 85 的图，即选择质量为 80 到 85（含）的图像，这是基于一种满足或超过的 SSIM 比率：该比率是预先计算的、使转换发生在图像范围中间的某个静态值。这样我们可以降低文件的平均大小，而不会降低那些质量最差的图片的质量。</span><strong style=\"text-align: center;\"><img src=\"https://engineeringblog.yelp.com/images/posts/2017-05-31-making-images-smaller/ssims-strategies.png\"></strong></p>\n<p style=\"text-align: center;\">3 种不同质量策略下 2500 张图片的 SSIM 值图</p>\n<h5 id=\"ssim\">SSIM？</h5>\n<p>有不少图像质量算法试图模仿人类视觉系统。我们已经评估过其中的许多算法，并认为 SSIM 虽然较为古老，但基于以下几个特征是最适合于迭代优化的：</p>\n<p>1、对 JPEG 量化误差敏感<br>\n2、快速，简单的算法<br>\n3、可以直接对 PIL 原生图像对象进行计算，而不是将图像转换为 PNG 格式并将其传递给 CLI 应用程序（参见＃2）</p>\n<p>动态质量的代码示例：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59bcc98db4e8b269811588\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nimport cStringIO\r\nimport PIL.Image\r\nfrom ssim import compute_ssim\r\n \r\n \r\ndef get_ssim_at_quality(photo, quality):\r\n    \"\"\"Return the ssim for this JPEG image saved at the specified quality\"\"\"\r\n    ssim_photo = cStringIO.StringIO()\r\n    # optimize is omitted here as it doesn't affect\r\n    # quality but requires additional memory and cpu\r\n    photo.save(ssim_photo, format=\"JPEG\", quality=quality, progressive=True)\r\n    ssim_photo.seek(0)\r\n    ssim_score = compute_ssim(photo, PIL.Image.open(ssim_photo))\r\n    return ssim_score\r\n \r\n \r\ndef _ssim_iteration_count(lo, hi):\r\n    \"\"\"Return the depth of the binary search tree for this range\"\"\"\r\n    if lo &gt;= hi:\r\n        return 0\r\n    else:\r\n        return int(log(hi - lo, 2)) + 1\r\n \r\n \r\ndef jpeg_dynamic_quality(original_photo):\r\n    \"\"\"Return an integer representing the quality that this JPEG image should be\r\n    saved at to attain the quality threshold specified for this photo class.\r\n \r\n    Args:\r\n        original_photo - a prepared PIL JPEG image (only JPEG is supported)\r\n    \"\"\"\r\n    ssim_goal = 0.95\r\n    hi = 85\r\n    lo = 80\r\n \r\n    # working on a smaller size image doesn't give worse results but is faster\r\n    # changing this value requires updating the calculated thresholds\r\n    photo = original_photo.resize((400, 400))\r\n \r\n    if not _should_use_dynamic_quality():\r\n        default_ssim = get_ssim_at_quality(photo, hi)\r\n        return hi, default_ssim\r\n \r\n    # 95 is the highest useful value for JPEG. Higher values cause different behavior\r\n    # Used to establish the image's intrinsic ssim without encoder artifacts\r\n    normalized_ssim = get_ssim_at_quality(photo, 95)\r\n    selected_quality = selected_ssim = None\r\n \r\n    # loop bisection. ssim function increases monotonically so this will converge\r\n    for i in xrange(_ssim_iteration_count(lo, hi)):\r\n        curr_quality = (lo + hi) // 2\r\n        curr_ssim = get_ssim_at_quality(photo, curr_quality)\r\n        ssim_ratio = curr_ssim / normalized_ssim\r\n \r\n        if ssim_ratio &gt;= ssim_goal:\r\n            # continue to check whether a lower quality level also exceeds the goal\r\n            selected_quality = curr_quality\r\n            selected_ssim = curr_ssim\r\n            hi = curr_quality\r\n        else:\r\n            lo = curr_quality\r\n \r\n    if selected_quality:\r\n        return selected_quality, selected_ssim\r\n    else:\r\n        default_ssim = get_ssim_at_quality(photo, hi)\r\n        return hi, default_ssim</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59bcc98db4e8b269811588-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcc98db4e8b269811588-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59bcc98db4e8b269811588-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcc98db4e8b269811588-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59bcc98db4e8b269811588-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcc98db4e8b269811588-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59bcc98db4e8b269811588-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcc98db4e8b269811588-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59bcc98db4e8b269811588-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcc98db4e8b269811588-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59bcc98db4e8b269811588-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcc98db4e8b269811588-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59bcc98db4e8b269811588-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcc98db4e8b269811588-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59bcc98db4e8b269811588-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcc98db4e8b269811588-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59bcc98db4e8b269811588-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcc98db4e8b269811588-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59bcc98db4e8b269811588-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcc98db4e8b269811588-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59bcc98db4e8b269811588-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcc98db4e8b269811588-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59bcc98db4e8b269811588-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcc98db4e8b269811588-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59bcc98db4e8b269811588-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcc98db4e8b269811588-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-59bcc98db4e8b269811588-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcc98db4e8b269811588-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-59bcc98db4e8b269811588-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcc98db4e8b269811588-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-59bcc98db4e8b269811588-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcc98db4e8b269811588-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-59bcc98db4e8b269811588-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcc98db4e8b269811588-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-59bcc98db4e8b269811588-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcc98db4e8b269811588-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-59bcc98db4e8b269811588-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcc98db4e8b269811588-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-59bcc98db4e8b269811588-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcc98db4e8b269811588-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-59bcc98db4e8b269811588-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcc98db4e8b269811588-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-59bcc98db4e8b269811588-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcc98db4e8b269811588-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-59bcc98db4e8b269811588-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcc98db4e8b269811588-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-59bcc98db4e8b269811588-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcc98db4e8b269811588-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-59bcc98db4e8b269811588-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcc98db4e8b269811588-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-59bcc98db4e8b269811588-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcc98db4e8b269811588-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-59bcc98db4e8b269811588-53\">53</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcc98db4e8b269811588-54\">54</div><div class=\"crayon-num\" data-line=\"crayon-59bcc98db4e8b269811588-55\">55</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcc98db4e8b269811588-56\">56</div><div class=\"crayon-num\" data-line=\"crayon-59bcc98db4e8b269811588-57\">57</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcc98db4e8b269811588-58\">58</div><div class=\"crayon-num\" data-line=\"crayon-59bcc98db4e8b269811588-59\">59</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcc98db4e8b269811588-60\">60</div><div class=\"crayon-num\" data-line=\"crayon-59bcc98db4e8b269811588-61\">61</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcc98db4e8b269811588-62\">62</div><div class=\"crayon-num\" data-line=\"crayon-59bcc98db4e8b269811588-63\">63</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcc98db4e8b269811588-64\">64</div><div class=\"crayon-num\" data-line=\"crayon-59bcc98db4e8b269811588-65\">65</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcc98db4e8b269811588-66\">66</div><div class=\"crayon-num\" data-line=\"crayon-59bcc98db4e8b269811588-67\">67</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59bcc98db4e8b269811588-1\"><span class=\"crayon-e\">import </span><span class=\"crayon-e\">cStringIO</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcc98db4e8b269811588-2\"><span class=\"crayon-e\">import </span><span class=\"crayon-v\">PIL</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Image</span></div><div class=\"crayon-line\" id=\"crayon-59bcc98db4e8b269811588-3\"><span class=\"crayon-e\">from </span><span class=\"crayon-e\">ssim </span><span class=\"crayon-e\">import </span><span class=\"crayon-e\">compute_ssim</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcc98db4e8b269811588-4\"><span class=\"crayon-e\"> </span></div><div class=\"crayon-line\" id=\"crayon-59bcc98db4e8b269811588-5\"><span class=\"crayon-e\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcc98db4e8b269811588-6\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">get_ssim_at_quality</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">photo</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">quality</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59bcc98db4e8b269811588-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"\"</span><span class=\"crayon-s\">\"Return the ssim for this JPEG image saved at the specified quality\"</span><span class=\"crayon-s\">\"\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcc98db4e8b269811588-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">ssim_photo</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cStringIO</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">StringIO</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59bcc98db4e8b269811588-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># optimize is omitted here as it doesn't affect</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcc98db4e8b269811588-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># quality but requires additional memory and cpu</span></div><div class=\"crayon-line\" id=\"crayon-59bcc98db4e8b269811588-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">photo</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">save</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">ssim_photo</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">format</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"JPEG\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">quality</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">quality</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">progressive</span><span class=\"crayon-o\">=</span><span class=\"crayon-t\">True</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcc98db4e8b269811588-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">ssim_photo</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">seek</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59bcc98db4e8b269811588-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">ssim_score</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">compute_ssim</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">photo</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">PIL</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Image</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">open</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">ssim_photo</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcc98db4e8b269811588-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ssim_score</span></div><div class=\"crayon-line\" id=\"crayon-59bcc98db4e8b269811588-15\"><span class=\"crayon-e\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcc98db4e8b269811588-16\"><span class=\"crayon-e\"> </span></div><div class=\"crayon-line\" id=\"crayon-59bcc98db4e8b269811588-17\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">_ssim_iteration_count</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">lo</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">hi</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcc98db4e8b269811588-18\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"\"</span><span class=\"crayon-s\">\"Return the depth of the binary search tree for this range\"</span><span class=\"crayon-s\">\"\"</span></div><div class=\"crayon-line\" id=\"crayon-59bcc98db4e8b269811588-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">lo</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">hi</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcc98db4e8b269811588-20\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line\" id=\"crayon-59bcc98db4e8b269811588-21\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">else</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcc98db4e8b269811588-22\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">log</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">hi</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">lo</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line\" id=\"crayon-59bcc98db4e8b269811588-23\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcc98db4e8b269811588-24\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59bcc98db4e8b269811588-25\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">jpeg_dynamic_quality</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">original_photo</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcc98db4e8b269811588-26\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"\"</span><span class=\"crayon-s\">\"Return an integer representing the quality that this JPEG image should be</span></div><div class=\"crayon-line\" id=\"crayon-59bcc98db4e8b269811588-27\"><span class=\"crayon-s\">    saved at to attain the quality threshold specified for this photo class.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcc98db4e8b269811588-28\"><span class=\"crayon-s\"> </span></div><div class=\"crayon-line\" id=\"crayon-59bcc98db4e8b269811588-29\"><span class=\"crayon-s\">    Args:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcc98db4e8b269811588-30\"><span class=\"crayon-s\">        original_photo - a prepared PIL JPEG image (only JPEG is supported)</span></div><div class=\"crayon-line\" id=\"crayon-59bcc98db4e8b269811588-31\"><span class=\"crayon-s\">    \"</span><span class=\"crayon-s\">\"\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcc98db4e8b269811588-32\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">ssim_goal</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.95</span></div><div class=\"crayon-line\" id=\"crayon-59bcc98db4e8b269811588-33\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">hi</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">85</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcc98db4e8b269811588-34\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">lo</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">80</span></div><div class=\"crayon-line\" id=\"crayon-59bcc98db4e8b269811588-35\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcc98db4e8b269811588-36\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># working on a smaller size image doesn't give worse results but is faster</span></div><div class=\"crayon-line\" id=\"crayon-59bcc98db4e8b269811588-37\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># changing this value requires updating the calculated thresholds</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcc98db4e8b269811588-38\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">photo</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">original_photo</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">resize</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59bcc98db4e8b269811588-39\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcc98db4e8b269811588-40\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">_should_use_dynamic_quality</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59bcc98db4e8b269811588-41\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">default_ssim</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">get_ssim_at_quality</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">photo</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">hi</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcc98db4e8b269811588-42\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">hi</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">default_ssim</span></div><div class=\"crayon-line\" id=\"crayon-59bcc98db4e8b269811588-43\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcc98db4e8b269811588-44\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># 95 is the highest useful value for JPEG. Higher values cause different behavior</span></div><div class=\"crayon-line\" id=\"crayon-59bcc98db4e8b269811588-45\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># Used to establish the image's intrinsic ssim without encoder artifacts</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcc98db4e8b269811588-46\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">normalized_ssim</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">get_ssim_at_quality</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">photo</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">95</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59bcc98db4e8b269811588-47\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">selected_quality</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">selected_ssim</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">None</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcc98db4e8b269811588-48\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59bcc98db4e8b269811588-49\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># loop bisection. ssim function increases monotonically so this will converge</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcc98db4e8b269811588-50\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">xrange</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">_ssim_iteration_count</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">lo</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">hi</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59bcc98db4e8b269811588-51\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">curr_quality</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">lo</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">hi</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// 2</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcc98db4e8b269811588-52\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">curr_ssim</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">get_ssim_at_quality</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">photo</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">curr_quality</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59bcc98db4e8b269811588-53\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">ssim_ratio</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">curr_ssim</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">normalized_ssim</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcc98db4e8b269811588-54\"><span class=\"crayon-e\"> </span></div><div class=\"crayon-line\" id=\"crayon-59bcc98db4e8b269811588-55\"><span class=\"crayon-e\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ssim_ratio</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ssim_goal</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcc98db4e8b269811588-56\"><span class=\"crayon-h\">            </span><span class=\"crayon-p\"># continue to check whether a lower quality level also exceeds the goal</span></div><div class=\"crayon-line\" id=\"crayon-59bcc98db4e8b269811588-57\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">selected_quality</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">curr_quality</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcc98db4e8b269811588-58\"><span class=\"crayon-e\">            </span><span class=\"crayon-v\">selected_ssim</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">curr_ssim</span></div><div class=\"crayon-line\" id=\"crayon-59bcc98db4e8b269811588-59\"><span class=\"crayon-e\">            </span><span class=\"crayon-v\">hi</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">curr_quality</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcc98db4e8b269811588-60\"><span class=\"crayon-e\">        </span><span class=\"crayon-st\">else</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59bcc98db4e8b269811588-61\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">lo</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">curr_quality</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcc98db4e8b269811588-62\"><span class=\"crayon-e\"> </span></div><div class=\"crayon-line\" id=\"crayon-59bcc98db4e8b269811588-63\"><span class=\"crayon-e\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">selected_quality</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcc98db4e8b269811588-64\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">selected_quality</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">selected_ssim</span></div><div class=\"crayon-line\" id=\"crayon-59bcc98db4e8b269811588-65\"><span class=\"crayon-e\">    </span><span class=\"crayon-st\">else</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcc98db4e8b269811588-66\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">default_ssim</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">get_ssim_at_quality</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">photo</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">hi</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59bcc98db4e8b269811588-67\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">hi</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">default_ssim</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0078 seconds] -->\r\n<p>还有一些关于这种技术的其他博客文章，这里是柯尔特·麦卡尼斯（Colt Mcanlis）的一篇博文。当我们发布这篇博客的时候，Etsy 已经发表了一篇了！击掌吧，更快的网络！</p>\n<h3 id=\"changes-to-jpeg-encoder\">JPEG 编码器的更改</h3>\n<p id=\"mozjpeg\">Mozjpeg 是 libjpeg-turbo 的一个开源分支，它采取以时间换空间的方法，通过更长时间的运算换取更加优化的文件尺寸。这种方法很好地与离线批处理方法结合以重新生成图像。一些更昂贵的算法用了比 libjpeg-turbo 多出 3 – 5 倍的时间，使得图像更小了一些！</p>\n<p>mozjpeg 的区别之一是使用一种替代量化表。如上所述，质量是用于每个颜色通道的量化表的抽象。所有符号都指向默认的 JPEG 量化表，因而它很容易被击败。用这个词来说，</p>\n<p><a href=\"https://www.w3.org/Graphics/JPEG/itu-t81.pdf\">JPEG spec</a>:</p>\n<blockquote><p>这些表仅作为示例，并不一定适用于任何特定应用。</p></blockquote>\n<p>那么自然地，不要惊讶于你知道这些表是大多数编码器使用的默认值…</p>\n<p>Mozjpeg 经历了为我们的替代表做基准测试的麻烦时期，并在之后成为了它所创建的图像中，能用到的性能最好的通用替代品。</p>\n<h3 id=\"mozjpeg--pillow\">Mozjpeg + Pillow</h3>\n<p>大多数的 Linux 发行版都默认安装了 libjpeg。所以在 Pillow 下使用 mozjpeg 在默认情况下不起作用，但配置起来也不是很困难。当您构建 mozjpeg 时，请使用–with-jpeg8 标志位，并确保可以通过 Pillow 链接到它。如果您使用Docker，您可能会有一个 Dockerfile，如：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59bcc98db4e9a764436834\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nFROM ubuntu:xenial\r\n \r\nRUN apt-get update \r\n\t&amp;&amp; DEBIAN_FRONTEND=noninteractive apt-get -y --no-install-recommends install \r\n\t# build tools\r\n\tnasm \r\n\tbuild-essential \r\n\tautoconf \r\n\tautomake \r\n\tlibtool \r\n\tpkg-config \r\n\t# python tools\r\n\tpython \r\n\tpython-dev \r\n\tpython-pip \r\n\tpython-setuptools \r\n\t# cleanup\r\n\t&amp;&amp; apt-get clean \r\n\t&amp;&amp; rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/*\r\n \r\n# Download and compile mozjpeg\r\nADD https://github.com/mozilla/mozjpeg/archive/v3.2-pre.tar.gz /mozjpeg-src/v3.2-pre.tar.gz\r\nRUN tar -xzf /mozjpeg-src/v3.2-pre.tar.gz -C /mozjpeg-src/\r\nWORKDIR /mozjpeg-src/mozjpeg-3.2-pre\r\nRUN autoreconf -fiv \r\n\t&amp;&amp; ./configure --with-jpeg8 \r\n\t&amp;&amp; make install prefix=/usr libdir=/usr/lib64\r\nRUN echo \"/usr/lib64n\" &gt; /etc/ld.so.conf.d/mozjpeg.conf\r\nRUN ldconfig\r\n \r\n# Build Pillow\r\nRUN pip install virtualenv \r\n\t&amp;&amp; virtualenv /virtualenv_run \r\n\t&amp;&amp; /virtualenv_run/bin/pip install --upgrade pip \r\n\t&amp;&amp; /virtualenv_run/bin/pip install --no-binary=:all: Pillow==4.0.0</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59bcc98db4e9a764436834-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcc98db4e9a764436834-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59bcc98db4e9a764436834-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcc98db4e9a764436834-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59bcc98db4e9a764436834-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcc98db4e9a764436834-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59bcc98db4e9a764436834-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcc98db4e9a764436834-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59bcc98db4e9a764436834-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcc98db4e9a764436834-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59bcc98db4e9a764436834-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcc98db4e9a764436834-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59bcc98db4e9a764436834-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcc98db4e9a764436834-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59bcc98db4e9a764436834-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcc98db4e9a764436834-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59bcc98db4e9a764436834-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcc98db4e9a764436834-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59bcc98db4e9a764436834-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcc98db4e9a764436834-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59bcc98db4e9a764436834-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcc98db4e9a764436834-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59bcc98db4e9a764436834-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcc98db4e9a764436834-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59bcc98db4e9a764436834-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcc98db4e9a764436834-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-59bcc98db4e9a764436834-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcc98db4e9a764436834-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-59bcc98db4e9a764436834-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcc98db4e9a764436834-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-59bcc98db4e9a764436834-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcc98db4e9a764436834-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-59bcc98db4e9a764436834-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcc98db4e9a764436834-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-59bcc98db4e9a764436834-35\">35</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59bcc98db4e9a764436834-1\"><span class=\"crayon-e\">FROM </span><span class=\"crayon-v\">ubuntu</span><span class=\"crayon-o\">:</span><span class=\"crayon-e\">xenial</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcc98db4e9a764436834-2\"><span class=\"crayon-e\"> </span></div><div class=\"crayon-line\" id=\"crayon-59bcc98db4e9a764436834-3\"><span class=\"crayon-e\">RUN </span><span class=\"crayon-v\">apt</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">get </span><span class=\"crayon-v\">update</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcc98db4e9a764436834-4\"><span class=\"crayon-h\">\t</span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">DEBIAN_FRONTEND</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">noninteractive </span><span class=\"crayon-v\">apt</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">get</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">y</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">no</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">install</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">recommends </span><span class=\"crayon-v\">install</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59bcc98db4e9a764436834-5\"><span class=\"crayon-h\">\t</span><span class=\"crayon-p\"># build tools</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcc98db4e9a764436834-6\"><span class=\"crayon-h\">\t</span><span class=\"crayon-e\">nasm </span></div><div class=\"crayon-line\" id=\"crayon-59bcc98db4e9a764436834-7\"><span class=\"crayon-e\">\t</span><span class=\"crayon-v\">build</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">essential </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcc98db4e9a764436834-8\"><span class=\"crayon-e\">\t</span><span class=\"crayon-e\">autoconf </span></div><div class=\"crayon-line\" id=\"crayon-59bcc98db4e9a764436834-9\"><span class=\"crayon-e\">\t</span><span class=\"crayon-e\">automake </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcc98db4e9a764436834-10\"><span class=\"crayon-e\">\t</span><span class=\"crayon-e\">libtool </span></div><div class=\"crayon-line\" id=\"crayon-59bcc98db4e9a764436834-11\"><span class=\"crayon-e\">\t</span><span class=\"crayon-v\">pkg</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">config</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcc98db4e9a764436834-12\"><span class=\"crayon-h\">\t</span><span class=\"crayon-p\"># python tools</span></div><div class=\"crayon-line\" id=\"crayon-59bcc98db4e9a764436834-13\"><span class=\"crayon-h\">\t</span><span class=\"crayon-e\">python </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcc98db4e9a764436834-14\"><span class=\"crayon-e\">\t</span><span class=\"crayon-v\">python</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">dev </span></div><div class=\"crayon-line\" id=\"crayon-59bcc98db4e9a764436834-15\"><span class=\"crayon-e\">\t</span><span class=\"crayon-v\">python</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">pip </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcc98db4e9a764436834-16\"><span class=\"crayon-e\">\t</span><span class=\"crayon-v\">python</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">setuptools</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59bcc98db4e9a764436834-17\"><span class=\"crayon-h\">\t</span><span class=\"crayon-p\"># cleanup</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcc98db4e9a764436834-18\"><span class=\"crayon-h\">\t</span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">apt</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">get </span><span class=\"crayon-v\">clean</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59bcc98db4e9a764436834-19\"><span class=\"crayon-h\">\t</span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">rm</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">rf</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-t\">var</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">lib</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">apt</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">lists</span><span class=\"crayon-o\">/</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">tmp</span><span class=\"crayon-o\">/</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-t\">var</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">tmp</span><span class=\"crayon-o\">/</span><span class=\"crayon-o\">*</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcc98db4e9a764436834-20\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59bcc98db4e9a764436834-21\"><span class=\"crayon-p\"># Download and compile mozjpeg</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcc98db4e9a764436834-22\"><span class=\"crayon-e\">ADD </span><span class=\"crayon-v\">https</span><span class=\"crayon-o\">:</span><span class=\"crayon-c\">//github.com/mozilla/mozjpeg/archive/v3.2-pre.tar.gz /mozjpeg-src/v3.2-pre.tar.gz</span></div><div class=\"crayon-line\" id=\"crayon-59bcc98db4e9a764436834-23\"><span class=\"crayon-e\">RUN </span><span class=\"crayon-v\">tar</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">xzf</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">mozjpeg</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">src</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">v3</span><span class=\"crayon-sy\">.</span><span class=\"crayon-cn\">2</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">pre</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">tar</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">gz</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">C</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">mozjpeg</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">src</span><span class=\"crayon-o\">/</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcc98db4e9a764436834-24\"><span class=\"crayon-v\">WORKDIR</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">mozjpeg</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">src</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">mozjpeg</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">3.2</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">pre</span></div><div class=\"crayon-line\" id=\"crayon-59bcc98db4e9a764436834-25\"><span class=\"crayon-e\">RUN </span><span class=\"crayon-v\">autoreconf</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">fiv</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcc98db4e9a764436834-26\"><span class=\"crayon-h\">\t</span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">configure</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">with</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">jpeg8</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59bcc98db4e9a764436834-27\"><span class=\"crayon-h\">\t</span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">make </span><span class=\"crayon-e\">install </span><span class=\"crayon-v\">prefix</span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">usr </span><span class=\"crayon-v\">libdir</span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">usr</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">lib64</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcc98db4e9a764436834-28\"><span class=\"crayon-e\">RUN </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"/usr/lib64n\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">etc</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">ld</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">so</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">conf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">d</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">mozjpeg</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">conf</span></div><div class=\"crayon-line\" id=\"crayon-59bcc98db4e9a764436834-29\"><span class=\"crayon-e\">RUN </span><span class=\"crayon-v\">ldconfig</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcc98db4e9a764436834-30\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59bcc98db4e9a764436834-31\"><span class=\"crayon-p\"># Build Pillow</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcc98db4e9a764436834-32\"><span class=\"crayon-e\">RUN </span><span class=\"crayon-e\">pip </span><span class=\"crayon-e\">install </span><span class=\"crayon-v\">virtualenv</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59bcc98db4e9a764436834-33\"><span class=\"crayon-h\">\t</span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">virtualenv</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">virtualenv_run</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcc98db4e9a764436834-34\"><span class=\"crayon-h\">\t</span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">virtualenv_run</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">bin</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">pip </span><span class=\"crayon-v\">install</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-e\">upgrade </span><span class=\"crayon-v\">pip</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59bcc98db4e9a764436834-35\"><span class=\"crayon-h\">\t</span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">virtualenv_run</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">bin</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">pip </span><span class=\"crayon-v\">install</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">no</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">binary</span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">all</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Pillow</span><span class=\"crayon-o\">==</span><span class=\"crayon-cn\">4.0.0</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0054 seconds] -->\r\n<p>以上！使用它，您将可以在正常图片工作流程中，使用由 mozjpeg 支持的 Pillow。</p>\n<h3 id=\"impact\">影响</h3>\n<p>这些改进中的每一项对我们的提升分别是多少呢？我们随机抽取 2,500 张 Yelp 上的商业照片开始了此项研究，测试照片大小在经过我们的处理流程后有怎样的变化。</p>\n<p>1、通过改变 Pillow 的设置，可以将图片大小减小 4.5%<br>\n2、大型 PNG 格式图片检测可以将图片大小减小 6.2%<br>\n3、动态质量可以将图片大小减小 4.5%<br>\n4、切换到 mozjpeg 编码器可以将图片大小减小 13.8%</p>\n<p>这些改进使得图像文件的平均大小减少了约 30％，并被我们应用到我们最大和最常见的图像分辨率上，使网站能为用户提供更快速的服务，并且每天在数据传输上节省了 TB 级别的容量。按照 CDN 来衡量：</p>\n<p><img src=\"https://engineeringblog.yelp.com/images/posts/2017-05-31-making-images-smaller/Filesize-over-time.png\"></p>\n<p style=\"text-align: center;\">从 CDN（结合非图像静态内容）测量的平均文件大小。</p>\n<h3 id=\"what-we-didnt-do\">我们还没做的</h3>\n<p>本节旨在向您介绍可能能够做出的一些常见改进，有的是因为它们和 Yelp 使用的工具并无关系，有些是因为我们权衡后决定不做。</p>\n<h3 id=\"subsampling\">子采样</h3>\n<p>子采样是决定网页图像的质量和文件大小的主要因素。对于子抽样的更详尽的描述可以在网上找到，但在这个博客文章我们只要说以 4：1：1（这是 Pillow 的默认值，没有指定任何其他内容）进行子采样就够了，所以我们无法了解能进一步缩小多少。</p>\n<h3 id=\"lossy-png-encoding\">有损的 PNG 编码</h3>\n<p>在了解我们对 PNG 格式图片做了什么之后，用例如 pngmini 这样的有损编码器，选择将这些图片中一部分保留为 PNG 格式，可能是有意义的，但是我们选择将其重新保存成 JPEG 格式。这是一个结果看来合理的替代选项，根据作者的说法，未修改的 PNG 格式图片的文件大小缩小了 72-85 ％。</p>\n<h3 id=\"dynamic-content-types\">动态内容类型</h3>\n<p>为更多的现代化内容类型提供支持，如 WebP 或 JPEG2k 肯定是我们的未来要做的。而一旦这个假设的项目实行了，就会有大量的用户要求为现有已优化的 JPEG / PNG 图像做这些，这将继续使该项工作非常值得做。</p>\n<h3 id=\"svg\">SVG</h3>\n<p>我们在网站上的许多地方使用 SVG，就像我们设计师创建的静态资产，这已成为我们的指导风格。虽然这种格式和优化工具（如 svgo）有助于减少网站页面的开销，但它与我们在这里所做的工作无关。</p>\n<h3 id=\"vendor-magic\">供应商的魔术</h3>\n<p>能提供图像传送/调整大小/裁剪/转码服务的供应商太多，包括开源的 thumbor。也许这是支持响应式图像，动态内容类型的最简单方法，并且在将来仍然能让我们保持在技术前沿。而现在我们的解决方案仍然是独立的。</p>\n<h3 id=\"further-reading\">拓展阅读</h3>\n<p>这里列出的两本书在这个领域历史上是绝对能站稳脚跟的，强烈建议您进一步阅读这些书籍。</p>\n<ul>\n<li><a href=\"https://content.akamai.com/pg6293-high-performance-images-ebook.html\">High Performance Images</a></li>\n<li><a href=\"http://designingforperformance.com/\">Designing for Performance</a></li>\n</ul>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112321\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112321votetotal\">3</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112321\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 4 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/fengzhuang19940106\">iScream</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/fengzhuang19940106\">\r\n\t\t\t<img src=\"http://q.qlogo.cn/qqapp/208656/91B5C8EB0B449C2B9F52CCED48C6B4CD/100\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            一个大的学生        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/fengzhuang19940106\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/fengzhuang19940106/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/fengzhuang19940106/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 16</a> · <a title=\"QQ：295039571\" target=\"_blank\" href=\"#\"><i class=\"fa fa-qq\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "create_date": "2017-09-12", "title": "为提高用户体验，Yelp 是如何无损压缩图片的", "fav_nums": 4, "url": "http://blog.jobbole.com/112321/", "comment_nums": 0, "front_image_path": "full/b0c88078f0ce26552ba79f72b93aa170e681bc91.jpg"},{"tags": "IT技术,Redis,数据库", "url_object_id": "cfaf090cb48b0f211a6912344d6ea9b9", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2016/04/49961db8952e63d98b519b76a2daa5e2.png"], "praise_nums": "1", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://my.oschina.net/giegie/blog/1525931\">冷冷gg</a>   </div><p>限流的目的是通过对并发访问/请求进行限速或者一个时间窗口内的的请求进行限速来保护系统，一旦达到限制速率则可以拒绝服务。</p>\n<p>前几天在DD的公众号，看了一篇关于使用 瓜娃 实现单应用限流的方案，参考《redis in action》 实现了一个jedis版本的，都属于业务层次限制。 实际场景中常用的限流策略：</p>\n<ul>\n<li>Nginx接入层限流<br>\n按照一定的规则如帐号、IP、系统调用逻辑等在Nginx层面做限流</li>\n<li>业务应用系统限流<br>\n通过业务代码控制流量这个流量可以被称为信号量，可以理解成是一种锁，它可以限制一项资源最多能同时被多少进程访问。</li>\n</ul>\n<h3>代码实现</h3>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59bcbb2d5c615864140498\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nimport redis.clients.jedis.Jedis;\r\nimport redis.clients.jedis.Transaction;\r\nimport redis.clients.jedis.ZParams;\r\n\r\nimport java.util.List;\r\nimport java.util.UUID;\r\n\r\n/**\r\n * email wangiegie@gmail.com\r\n * @data 2017-08\r\n */\r\npublic class RedisRateLimiter {\r\n    private static final String BUCKET = \"BUCKET\";\r\n    private static final String BUCKET_COUNT = \"BUCKET_COUNT\";\r\n    private static final String BUCKET_MONITOR = \"BUCKET_MONITOR\";\r\n\r\n    static String acquireTokenFromBucket(\r\n            Jedis jedis, int limit, long timeout) {\r\n        String identifier = UUID.randomUUID().toString();\r\n        long now = System.currentTimeMillis();\r\n        Transaction transaction = jedis.multi();\r\n\r\n        //删除信号量\r\n        transaction.zremrangeByScore(BUCKET_MONITOR.getBytes(), \"-inf\".getBytes(), String.valueOf(now - timeout).getBytes());\r\n        ZParams params = new ZParams();\r\n        params.weightsByDouble(1.0,0.0);\r\n        transaction.zinterstore(BUCKET, params, BUCKET, BUCKET_MONITOR);\r\n\r\n        //计数器自增\r\n        transaction.incr(BUCKET_COUNT);\r\n        List&lt;Object&gt; results = transaction.exec();\r\n        long counter = (Long) results.get(results.size() - 1);\r\n\r\n        transaction = jedis.multi();\r\n        transaction.zadd(BUCKET_MONITOR, now, identifier);\r\n        transaction.zadd(BUCKET, counter, identifier);\r\n        transaction.zrank(BUCKET, identifier);\r\n        results = transaction.exec();\r\n        //获取排名，判断请求是否取得了信号量\r\n        long rank = (Long) results.get(results.size() - 1);\r\n        if (rank &lt; limit) {\r\n            return identifier;\r\n        } else {//没有获取到信号量，清理之前放入redis 中垃圾数据\r\n            transaction = jedis.multi();\r\n            transaction.zrem(BUCKET_MONITOR, identifier);\r\n            transaction.zrem(BUCKET, identifier);\r\n            transaction.exec();\r\n        }\r\n        return null;\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59bcbb2d5c615864140498-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcbb2d5c615864140498-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59bcbb2d5c615864140498-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcbb2d5c615864140498-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59bcbb2d5c615864140498-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcbb2d5c615864140498-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59bcbb2d5c615864140498-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcbb2d5c615864140498-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59bcbb2d5c615864140498-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcbb2d5c615864140498-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59bcbb2d5c615864140498-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcbb2d5c615864140498-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59bcbb2d5c615864140498-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcbb2d5c615864140498-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59bcbb2d5c615864140498-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcbb2d5c615864140498-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59bcbb2d5c615864140498-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcbb2d5c615864140498-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59bcbb2d5c615864140498-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcbb2d5c615864140498-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59bcbb2d5c615864140498-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcbb2d5c615864140498-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59bcbb2d5c615864140498-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcbb2d5c615864140498-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59bcbb2d5c615864140498-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcbb2d5c615864140498-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-59bcbb2d5c615864140498-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcbb2d5c615864140498-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-59bcbb2d5c615864140498-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcbb2d5c615864140498-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-59bcbb2d5c615864140498-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcbb2d5c615864140498-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-59bcbb2d5c615864140498-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcbb2d5c615864140498-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-59bcbb2d5c615864140498-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcbb2d5c615864140498-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-59bcbb2d5c615864140498-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcbb2d5c615864140498-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-59bcbb2d5c615864140498-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcbb2d5c615864140498-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-59bcbb2d5c615864140498-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcbb2d5c615864140498-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-59bcbb2d5c615864140498-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcbb2d5c615864140498-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-59bcbb2d5c615864140498-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcbb2d5c615864140498-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-59bcbb2d5c615864140498-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcbb2d5c615864140498-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-59bcbb2d5c615864140498-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcbb2d5c615864140498-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-59bcbb2d5c615864140498-51\">51</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59bcbb2d5c615864140498-1\"><span class=\"crayon-e\">import </span><span class=\"crayon-v\">redis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">clients</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">jedis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Jedis</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcbb2d5c615864140498-2\"><span class=\"crayon-e\">import </span><span class=\"crayon-v\">redis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">clients</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">jedis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Transaction</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59bcbb2d5c615864140498-3\"><span class=\"crayon-e\">import </span><span class=\"crayon-v\">redis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">clients</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">jedis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">ZParams</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcbb2d5c615864140498-4\"> </div><div class=\"crayon-line\" id=\"crayon-59bcbb2d5c615864140498-5\"><span class=\"crayon-e\">import </span><span class=\"crayon-v\">java</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">util</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">List</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcbb2d5c615864140498-6\"><span class=\"crayon-e\">import </span><span class=\"crayon-v\">java</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">util</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">UUID</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59bcbb2d5c615864140498-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcbb2d5c615864140498-8\"><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line\" id=\"crayon-59bcbb2d5c615864140498-9\"><span class=\"crayon-c\"> * email wangiegie@gmail.com</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcbb2d5c615864140498-10\"><span class=\"crayon-c\"> * @data 2017-08</span></div><div class=\"crayon-line\" id=\"crayon-59bcbb2d5c615864140498-11\"><span class=\"crayon-c\"> */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcbb2d5c615864140498-12\"><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">RedisRateLimiter</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59bcbb2d5c615864140498-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">final</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">BUCKET</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"BUCKET\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcbb2d5c615864140498-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">final</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">BUCKET_COUNT</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"BUCKET_COUNT\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59bcbb2d5c615864140498-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">final</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">BUCKET_MONITOR</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"BUCKET_MONITOR\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcbb2d5c615864140498-16\"> </div><div class=\"crayon-line\" id=\"crayon-59bcbb2d5c615864140498-17\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">acquireTokenFromBucket</span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcbb2d5c615864140498-18\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">Jedis </span><span class=\"crayon-v\">jedis</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">limit</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">timeout</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59bcbb2d5c615864140498-19\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">identifier</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">UUID</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">randomUUID</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">toString</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcbb2d5c615864140498-20\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">now</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">System</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">currentTimeMillis</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59bcbb2d5c615864140498-21\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">Transaction </span><span class=\"crayon-v\">transaction</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jedis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">multi</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcbb2d5c615864140498-22\"> </div><div class=\"crayon-line\" id=\"crayon-59bcbb2d5c615864140498-23\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//删除信号量</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcbb2d5c615864140498-24\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">transaction</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">zremrangeByScore</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">BUCKET_MONITOR</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getBytes</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"-inf\"</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getBytes</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">String</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">valueOf</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">now</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">timeout</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getBytes</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59bcbb2d5c615864140498-25\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">ZParams </span><span class=\"crayon-v\">params</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ZParams</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcbb2d5c615864140498-26\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">params</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">weightsByDouble</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1.0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">0.0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59bcbb2d5c615864140498-27\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">transaction</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">zinterstore</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">BUCKET</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">params</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">BUCKET</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">BUCKET_MONITOR</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcbb2d5c615864140498-28\"> </div><div class=\"crayon-line\" id=\"crayon-59bcbb2d5c615864140498-29\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//计数器自增</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcbb2d5c615864140498-30\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">transaction</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">incr</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">BUCKET_COUNT</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59bcbb2d5c615864140498-31\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">List</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-t\">Object</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">results</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">transaction</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">exec</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcbb2d5c615864140498-32\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">counter</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">Long</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">results</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">results</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">size</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59bcbb2d5c615864140498-33\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcbb2d5c615864140498-34\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">transaction</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jedis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">multi</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59bcbb2d5c615864140498-35\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">transaction</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">zadd</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">BUCKET_MONITOR</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">now</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">identifier</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcbb2d5c615864140498-36\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">transaction</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">zadd</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">BUCKET</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">counter</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">identifier</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59bcbb2d5c615864140498-37\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">transaction</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">zrank</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">BUCKET</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">identifier</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcbb2d5c615864140498-38\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">results</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">transaction</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">exec</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59bcbb2d5c615864140498-39\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//获取排名，判断请求是否取得了信号量</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcbb2d5c615864140498-40\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">rank</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">Long</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">results</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">results</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">size</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59bcbb2d5c615864140498-41\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">rank</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">limit</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcbb2d5c615864140498-42\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">identifier</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59bcbb2d5c615864140498-43\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-c\">//没有获取到信号量，清理之前放入redis 中垃圾数据</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcbb2d5c615864140498-44\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">transaction</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jedis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">multi</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59bcbb2d5c615864140498-45\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">transaction</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">zrem</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">BUCKET_MONITOR</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">identifier</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcbb2d5c615864140498-46\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">transaction</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">zrem</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">BUCKET</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">identifier</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59bcbb2d5c615864140498-47\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">transaction</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">exec</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcbb2d5c615864140498-48\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59bcbb2d5c615864140498-49\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcbb2d5c615864140498-50\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59bcbb2d5c615864140498-51\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0087 seconds] -->\r\n<p></p>\n<h3>调用</h3>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59bcbb2d5c622096445618\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n测试接口调用\r\n@GetMapping(\"/\")\r\npublic void index(HttpServletResponse response) throws IOException {\r\n    Jedis jedis = jedisPool.getResource();\r\n    String token = RedisRateLimiter.acquireTokenFromBucket(jedis, LIMIT, TIMEOUT);\r\n    if (token == null) {\r\n        response.sendError(500);\r\n    }else{\r\n        //TODO 你的业务逻辑\r\n    }\r\n    jedisPool.returnResource(jedis);\r\n}\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59bcbb2d5c622096445618-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcbb2d5c622096445618-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59bcbb2d5c622096445618-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcbb2d5c622096445618-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59bcbb2d5c622096445618-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcbb2d5c622096445618-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59bcbb2d5c622096445618-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcbb2d5c622096445618-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59bcbb2d5c622096445618-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcbb2d5c622096445618-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59bcbb2d5c622096445618-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcbb2d5c622096445618-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59bcbb2d5c622096445618-13\">13</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59bcbb2d5c622096445618-1\">测试接口调用</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcbb2d5c622096445618-2\"><span class=\"crayon-sy\">@</span><span class=\"crayon-e\">GetMapping</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"/\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59bcbb2d5c622096445618-3\"><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">index</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">HttpServletResponse </span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">throws</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">IOException</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcbb2d5c622096445618-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">Jedis </span><span class=\"crayon-v\">jedis</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jedisPool</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getResource</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59bcbb2d5c622096445618-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">token</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">RedisRateLimiter</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">acquireTokenFromBucket</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">jedis</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">LIMIT</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">TIMEOUT</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcbb2d5c622096445618-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">token</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59bcbb2d5c622096445618-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">sendError</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">500</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcbb2d5c622096445618-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span><span class=\"crayon-st\">else</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59bcbb2d5c622096445618-9\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//TODO 你的业务逻辑</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcbb2d5c622096445618-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59bcbb2d5c622096445618-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">jedisPool</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">returnResource</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">jedis</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcbb2d5c622096445618-12\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59bcbb2d5c622096445618-13\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0022 seconds] -->\r\n<p></p>\n<h2>优化</h2>\n<p>使用拦截器 + 注解优化代码</p>\n<h3>拦截器</h3>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59bcbb2d5c626751747585\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n@Configuration\r\nstatic class WebMvcConfigurer extends WebMvcConfigurerAdapter {\r\n    private Logger logger = LoggerFactory.getLogger(WebMvcConfigurer.class);\r\n    @Autowired\r\n    private JedisPool jedisPool;\r\n\r\n    public void addInterceptors(InterceptorRegistry registry) {\r\n        registry.addInterceptor(new HandlerInterceptorAdapter() {\r\n            public boolean preHandle(HttpServletRequest request, HttpServletResponse response,\r\n                                     Object handler) throws Exception {\r\n                HandlerMethod handlerMethod = (HandlerMethod) handler;\r\n                Method method = handlerMethod.getMethod();\r\n                RateLimiter rateLimiter = method.getAnnotation(RateLimiter.class);\r\n\r\n                if (rateLimiter != null){\r\n                    int limit = rateLimiter.limit();\r\n                    int timeout = rateLimiter.timeout();\r\n                    Jedis jedis = jedisPool.getResource();\r\n                    String token = RedisRateLimiter.acquireTokenFromBucket(jedis, limit, timeout);\r\n                    if (token == null) {\r\n                        response.sendError(500);\r\n                        return false;\r\n                    }\r\n                    logger.debug(\"token -&gt; {}\",token);\r\n                    jedis.close();\r\n                }\r\n                return true;\r\n            }\r\n        }).addPathPatterns(\"/*\");\r\n    }\r\n}\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59bcbb2d5c626751747585-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcbb2d5c626751747585-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59bcbb2d5c626751747585-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcbb2d5c626751747585-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59bcbb2d5c626751747585-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcbb2d5c626751747585-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59bcbb2d5c626751747585-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcbb2d5c626751747585-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59bcbb2d5c626751747585-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcbb2d5c626751747585-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59bcbb2d5c626751747585-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcbb2d5c626751747585-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59bcbb2d5c626751747585-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcbb2d5c626751747585-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59bcbb2d5c626751747585-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcbb2d5c626751747585-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59bcbb2d5c626751747585-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcbb2d5c626751747585-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59bcbb2d5c626751747585-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcbb2d5c626751747585-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59bcbb2d5c626751747585-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcbb2d5c626751747585-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59bcbb2d5c626751747585-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcbb2d5c626751747585-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59bcbb2d5c626751747585-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcbb2d5c626751747585-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-59bcbb2d5c626751747585-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcbb2d5c626751747585-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-59bcbb2d5c626751747585-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcbb2d5c626751747585-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-59bcbb2d5c626751747585-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcbb2d5c626751747585-32\">32</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59bcbb2d5c626751747585-1\"><span class=\"crayon-sy\">@</span><span class=\"crayon-e\">Configuration</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcbb2d5c626751747585-2\"><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">WebMvcConfigurer</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">extends</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">WebMvcConfigurerAdapter</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59bcbb2d5c626751747585-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Logger </span><span class=\"crayon-v\">logger</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">LoggerFactory</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getLogger</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">WebMvcConfigurer</span><span class=\"crayon-sy\">.</span><span class=\"crayon-t\">class</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcbb2d5c626751747585-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">@</span><span class=\"crayon-e\">Autowired</span></div><div class=\"crayon-line\" id=\"crayon-59bcbb2d5c626751747585-5\"><span class=\"crayon-e\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">JedisPool </span><span class=\"crayon-v\">jedisPool</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcbb2d5c626751747585-6\"> </div><div class=\"crayon-line\" id=\"crayon-59bcbb2d5c626751747585-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">addInterceptors</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">InterceptorRegistry </span><span class=\"crayon-v\">registry</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcbb2d5c626751747585-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">registry</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">addInterceptor</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">HandlerInterceptorAdapter</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59bcbb2d5c626751747585-9\"><span class=\"crayon-h\">            </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">boolean</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">preHandle</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">HttpServletRequest </span><span class=\"crayon-v\">request</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">HttpServletResponse </span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcbb2d5c626751747585-10\"><span class=\"crayon-h\">                                     </span><span class=\"crayon-t\">Object</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">handler</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">throws</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Exception</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59bcbb2d5c626751747585-11\"><span class=\"crayon-h\">                </span><span class=\"crayon-e\">HandlerMethod </span><span class=\"crayon-v\">handlerMethod</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">HandlerMethod</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">handler</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcbb2d5c626751747585-12\"><span class=\"crayon-h\">                </span><span class=\"crayon-e\">Method </span><span class=\"crayon-v\">method</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">handlerMethod</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getMethod</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59bcbb2d5c626751747585-13\"><span class=\"crayon-h\">                </span><span class=\"crayon-e\">RateLimiter </span><span class=\"crayon-v\">rateLimiter</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">method</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getAnnotation</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">RateLimiter</span><span class=\"crayon-sy\">.</span><span class=\"crayon-t\">class</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcbb2d5c626751747585-14\"> </div><div class=\"crayon-line\" id=\"crayon-59bcbb2d5c626751747585-15\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">rateLimiter</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcbb2d5c626751747585-16\"><span class=\"crayon-h\">                    </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">limit</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">rateLimiter</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">limit</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59bcbb2d5c626751747585-17\"><span class=\"crayon-h\">                    </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">timeout</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">rateLimiter</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">timeout</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcbb2d5c626751747585-18\"><span class=\"crayon-h\">                    </span><span class=\"crayon-e\">Jedis </span><span class=\"crayon-v\">jedis</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jedisPool</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getResource</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59bcbb2d5c626751747585-19\"><span class=\"crayon-h\">                    </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">token</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">RedisRateLimiter</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">acquireTokenFromBucket</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">jedis</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">limit</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">timeout</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcbb2d5c626751747585-20\"><span class=\"crayon-h\">                    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">token</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59bcbb2d5c626751747585-21\"><span class=\"crayon-h\">                        </span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">sendError</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">500</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcbb2d5c626751747585-22\"><span class=\"crayon-h\">                        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">false</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59bcbb2d5c626751747585-23\"><span class=\"crayon-h\">                    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcbb2d5c626751747585-24\"><span class=\"crayon-h\">                    </span><span class=\"crayon-v\">logger</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">debug</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"token -&gt; {}\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">token</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59bcbb2d5c626751747585-25\"><span class=\"crayon-h\">                    </span><span class=\"crayon-v\">jedis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">close</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcbb2d5c626751747585-26\"><span class=\"crayon-h\">                </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59bcbb2d5c626751747585-27\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcbb2d5c626751747585-28\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59bcbb2d5c626751747585-29\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">addPathPatterns</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"/*\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcbb2d5c626751747585-30\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59bcbb2d5c626751747585-31\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcbb2d5c626751747585-32\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0064 seconds] -->\r\n<p></p>\n<h3>定义注解</h3>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59bcbb2d5c62a455027927\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n/**\r\n * email wangiegie@gmail.com\r\n * @data 2017-08\r\n * 限流注解\r\n */\r\n\r\n@Target(ElementType.METHOD)\r\n@Retention(RetentionPolicy.RUNTIME)\r\n@Documented\r\npublic @interface RateLimiter {\r\n    int limit() default 5;\r\n    int timeout() default 1000;\r\n}\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59bcbb2d5c62a455027927-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcbb2d5c62a455027927-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59bcbb2d5c62a455027927-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcbb2d5c62a455027927-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59bcbb2d5c62a455027927-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcbb2d5c62a455027927-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59bcbb2d5c62a455027927-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcbb2d5c62a455027927-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59bcbb2d5c62a455027927-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcbb2d5c62a455027927-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59bcbb2d5c62a455027927-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcbb2d5c62a455027927-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59bcbb2d5c62a455027927-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcbb2d5c62a455027927-14\">14</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59bcbb2d5c62a455027927-1\"><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcbb2d5c62a455027927-2\"><span class=\"crayon-c\"> * email wangiegie@gmail.com</span></div><div class=\"crayon-line\" id=\"crayon-59bcbb2d5c62a455027927-3\"><span class=\"crayon-c\"> * @data 2017-08</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcbb2d5c62a455027927-4\"><span class=\"crayon-c\"> * 限流注解</span></div><div class=\"crayon-line\" id=\"crayon-59bcbb2d5c62a455027927-5\"><span class=\"crayon-c\"> */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcbb2d5c62a455027927-6\"> </div><div class=\"crayon-line\" id=\"crayon-59bcbb2d5c62a455027927-7\"><span class=\"crayon-sy\">@</span><span class=\"crayon-e\">Target</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">ElementType</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">METHOD</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcbb2d5c62a455027927-8\"><span class=\"crayon-sy\">@</span><span class=\"crayon-e\">Retention</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">RetentionPolicy</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">RUNTIME</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59bcbb2d5c62a455027927-9\"><span class=\"crayon-sy\">@</span><span class=\"crayon-e\">Documented</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcbb2d5c62a455027927-10\"><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-t\">interface</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">RateLimiter</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59bcbb2d5c62a455027927-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">limit</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">default</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcbb2d5c62a455027927-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">timeout</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">default</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1000</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59bcbb2d5c62a455027927-13\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcbb2d5c62a455027927-14\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0013 seconds] -->\r\n<p></p>\n<h3>使用</h3>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59bcbb2d5c62e038285080\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n@RateLimiter(limit = 2, timeout = 5000)\r\n@GetMapping(\"/test\")\r\npublic void test() {\r\n}\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59bcbb2d5c62e038285080-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcbb2d5c62e038285080-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59bcbb2d5c62e038285080-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bcbb2d5c62e038285080-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59bcbb2d5c62e038285080-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59bcbb2d5c62e038285080-1\"><span class=\"crayon-sy\">@</span><span class=\"crayon-e\">RateLimiter</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">limit</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">timeout</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5000</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcbb2d5c62e038285080-2\"><span class=\"crayon-sy\">@</span><span class=\"crayon-e\">GetMapping</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"/test\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59bcbb2d5c62e038285080-3\"><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">test</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bcbb2d5c62e038285080-4\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59bcbb2d5c62e038285080-5\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n<p></p>\n<h2>并发测试</h2>\n<p>工具：apache-jmeter-3.2<br>\n说明： 没有获取到信号量的接口返回500，status是红色，获取到信号量的接口返回200，status是绿色。<br>\n当限制请求信号量为2，并发5个线程： <img src=\"http://jbcdn2.b0.upaiyun.com/2017/09/88fe4ce72def9cd9bcb4ddcc1185200e.png\" alt=\"image\"><br>\n当限制请求信号量为5，并发10个线程：<br>\n<img src=\"http://jbcdn2.b0.upaiyun.com/2017/09/d92c4624c99f43a7093aa4fe92b7a112.png\" alt=\"image\"></p>\n<h2>资料</h2>\n<p><a href=\"https://github.com/tangaiyun/RedisRateLimiter\">基于reids + lua的实现</a></p>\n<h2>总结</h2>\n<ol>\n<li>对于信号量的操作，使用事务操作。</li>\n<li>不要使用时间戳作为信号量的排序分数，因为在分布式环境中，各个节点的时间差的原因，会出现不公平信号量的现象。</li>\n<li>可以使用把这块代码抽成@rateLimiter注解，然后再方法上使用就会很方便啦</li>\n<li>不同接口的流控，可以参考源码的里面RedisRateLimiterPlus,无非是每个接口生成一个监控参数</li>\n<li>源码<a href=\"http://git.oschina.net/boding1/pig-cloud\">http://git.oschina.net/boding1/pig-cloud</a></li>\n</ol>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112381\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112381votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112381\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "create_date": "2017-09-07", "title": "基于 Redis 实现分布式应用限流", "fav_nums": 2, "url": "http://blog.jobbole.com/112381/", "comment_nums": 0, "front_image_path": "full/c766feed221138f7946130756cddfc7e86e388b4.jpg"},{"tags": "IT技术,Linux", "url_object_id": "f51b3da1c08181a6b90377ff717b844a", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2016/11/59d49abe8909a122bc2c9aa43b71e3bb.png"], "praise_nums": "1", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://www.linux.com/learn/cleaning-your-linux-startup-process\">David Both</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-8835-1.html\">Linux中国/penghuster</a>   </div><p>一般情况下，常规用途的 Linux 发行版在开机启动时拉起各种相关服务进程，包括许多你可能无需使用的服务，例如蓝牙bluetooth、Avahi、 调制解调管理器ModemManager、ppp-dns（LCTT 译注：此处作者笔误 ppp-dns 应该为 pppd-dns) 等服务进程，这些都是什么东西？用于哪里，有何功能？</p>\n<p>Systemd 提供了许多很好的工具用于查看系统启动情况，也可以控制在系统启动时运行什么。在这篇文章中，我将说明在 Systemd 类发行版中如何关闭一些令人讨厌的进程。</p>\n<h3 id=\"toc_1\">查看开机启动项</h3>\n<p>在过去，你能很容易通过查看 <code>/etc/init.d</code> 了解到哪些服务进程会在引导时启动。Systemd 以不同的方式展现，你可以使用如下命令罗列允许开机启动的服务进程。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59bccfd7f05c5549965769\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ systemctl list-unit-files --type=service | grep enabled\r\naccounts-daemon.service                    enabled\r\nanacron-resume.service                     enabled\r\nanacron.service                            enabled\r\nbluetooth.service                          enabled\r\nbrltty.service                             enabled\r\n[...]\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59bccfd7f05c5549965769-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bccfd7f05c5549965769-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59bccfd7f05c5549965769-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bccfd7f05c5549965769-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59bccfd7f05c5549965769-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bccfd7f05c5549965769-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59bccfd7f05c5549965769-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bccfd7f05c5549965769-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59bccfd7f05c5549965769-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">systemctl </span><span class=\"crayon-v\">list</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">unit</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">files</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">type</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">service</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">grep </span><span class=\"crayon-e\">enabled</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bccfd7f05c5549965769-2\"><span class=\"crayon-v\">accounts</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">daemon</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">service                    </span><span class=\"crayon-e\">enabled</span></div><div class=\"crayon-line\" id=\"crayon-59bccfd7f05c5549965769-3\"><span class=\"crayon-v\">anacron</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">resume</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">service                     </span><span class=\"crayon-e\">enabled</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bccfd7f05c5549965769-4\"><span class=\"crayon-v\">anacron</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">service                            </span><span class=\"crayon-e\">enabled</span></div><div class=\"crayon-line\" id=\"crayon-59bccfd7f05c5549965769-5\"><span class=\"crayon-v\">bluetooth</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">service                          </span><span class=\"crayon-e\">enabled</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bccfd7f05c5549965769-6\"><span class=\"crayon-v\">brltty</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">service                             </span><span class=\"crayon-i\">enabled</span></div><div class=\"crayon-line\" id=\"crayon-59bccfd7f05c5549965769-7\"><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bccfd7f05c5549965769-8\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0013 seconds] -->\r\n<p>在此列表顶部，对我来说，蓝牙服务是冗余项，因为在该电脑上我不需要使用蓝牙功能，故无需运行此服务。下面的命令将停止该服务进程，并且使其开机不启动。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59bccfd7f05d1171359005\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ sudo systemctl stop bluetooth.service\r\n$ sudo systemctl disable bluetooth.service\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59bccfd7f05d1171359005-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bccfd7f05d1171359005-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59bccfd7f05d1171359005-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59bccfd7f05d1171359005-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sudo </span><span class=\"crayon-e\">systemctl </span><span class=\"crayon-e\">stop </span><span class=\"crayon-v\">bluetooth</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">service</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bccfd7f05d1171359005-2\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sudo </span><span class=\"crayon-e\">systemctl </span><span class=\"crayon-e\">disable </span><span class=\"crayon-v\">bluetooth</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">service</span></div><div class=\"crayon-line\" id=\"crayon-59bccfd7f05d1171359005-3\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>你可以通过下面命令确定是否操作成功。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59bccfd7f05d5514771008\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ systemctl status bluetooth.service\r\n bluetooth.service - Bluetooth service\r\n  Loaded: loaded (/lib/systemd/system/bluetooth.service; disabled; vendor preset: enabled)\r\n  Active: inactive (dead)\r\n    Docs: man:bluetoothd(8)\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59bccfd7f05d5514771008-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bccfd7f05d5514771008-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59bccfd7f05d5514771008-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bccfd7f05d5514771008-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59bccfd7f05d5514771008-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bccfd7f05d5514771008-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59bccfd7f05d5514771008-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">systemctl </span><span class=\"crayon-e\">status </span><span class=\"crayon-v\">bluetooth</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">service</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bccfd7f05d5514771008-2\"><span class=\"crayon-e\"> </span><span class=\"crayon-v\">bluetooth</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">service</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Bluetooth </span><span class=\"crayon-e\">service</span></div><div class=\"crayon-line\" id=\"crayon-59bccfd7f05d5514771008-3\"><span class=\"crayon-e\">  </span><span class=\"crayon-v\">Loaded</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">loaded</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">lib</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">systemd</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">system</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">bluetooth</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">service</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">disabled</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">vendor </span><span class=\"crayon-v\">preset</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">enabled</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bccfd7f05d5514771008-4\"><span class=\"crayon-h\">  </span><span class=\"crayon-v\">Active</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">inactive</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">dead</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59bccfd7f05d5514771008-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">Docs</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">man</span><span class=\"crayon-o\">:</span><span class=\"crayon-e\">bluetoothd</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">8</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bccfd7f05d5514771008-6\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0015 seconds] -->\r\n<p>停用的服务进程仍然能够被另外一个服务进程启动。如果你真的想在任何情况下系统启动时都不启动该进程，无需卸载该它，只需要把它掩盖起来就可以阻止该进程在任何情况下开机启动。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59bccfd7f05d8494004961\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ sudo systemctl mask bluetooth.service\r\n Created symlink from /etc/systemd/system/bluetooth.service to /dev/null.\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59bccfd7f05d8494004961-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bccfd7f05d8494004961-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59bccfd7f05d8494004961-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59bccfd7f05d8494004961-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sudo </span><span class=\"crayon-e\">systemctl </span><span class=\"crayon-e\">mask </span><span class=\"crayon-v\">bluetooth</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">service</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bccfd7f05d8494004961-2\"><span class=\"crayon-e\"> </span><span class=\"crayon-e\">Created </span><span class=\"crayon-e\">symlink </span><span class=\"crayon-v\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">etc</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">systemd</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">system</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">bluetooth</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">service </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">dev</span><span class=\"crayon-o\">/</span><span class=\"crayon-t\">null</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-59bccfd7f05d8494004961-3\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n<p>一旦你对禁用该进程启动而没有出现负面作用感到满意，你也可以选择卸载该程序。</p>\n<p>通过执行命令可以获得如下服务列表：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59bccfd7f05dc681592839\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ systemctl list-unit-files --type=service                       \r\nUNIT FILE                                  STATE   \r\naccounts-daemon.service                    enabled\r\nacpid.service                              disabled\r\nalsa-restore.service                       static    \r\nalsa-utils.service                         masked\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59bccfd7f05dc681592839-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bccfd7f05dc681592839-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59bccfd7f05dc681592839-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bccfd7f05dc681592839-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59bccfd7f05dc681592839-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bccfd7f05dc681592839-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59bccfd7f05dc681592839-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59bccfd7f05dc681592839-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">systemctl </span><span class=\"crayon-v\">list</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">unit</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">files</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">type</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">service                       </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bccfd7f05dc681592839-2\"><span class=\"crayon-e\">UNIT </span><span class=\"crayon-e\">FILE                                  </span><span class=\"crayon-e\">STATE   </span></div><div class=\"crayon-line\" id=\"crayon-59bccfd7f05dc681592839-3\"><span class=\"crayon-v\">accounts</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">daemon</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">service                    </span><span class=\"crayon-e\">enabled</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bccfd7f05dc681592839-4\"><span class=\"crayon-v\">acpid</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">service                              </span><span class=\"crayon-e\">disabled</span></div><div class=\"crayon-line\" id=\"crayon-59bccfd7f05dc681592839-5\"><span class=\"crayon-v\">alsa</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">restore</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">service                       </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\">    </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bccfd7f05dc681592839-6\"><span class=\"crayon-v\">alsa</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">utils</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">service                         </span><span class=\"crayon-i\">masked</span></div><div class=\"crayon-line\" id=\"crayon-59bccfd7f05dc681592839-7\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0012 seconds] -->\r\n<p>你不能启用或禁用静态服务，因为静态服务被其他的进程所依赖，并不意味着它们自己运行。</p>\n<h3 id=\"toc_2\">哪些服务能够禁止？</h3>\n<p>如何知道你需要哪些服务，而哪些又是可以安全地禁用的呢？它总是依赖于你的个性化需求。</p>\n<p>这里举例了几个服务进程的作用。许多服务进程都是发行版特定的，所以你应该看看你的发行版文档（比如通过 google 或 StackOverflow）。</p>\n<ul>\n<li><strong>accounts-daemon.service</strong> 是一个潜在的安全风险。它是 AccountsService 的一部分，AccountsService 允许程序获得或操作用户账户信息。我不认为有好的理由能使我允许这样的后台操作，所以我选择掩盖mask该服务进程。</li>\n<li><strong>avahi-daemon.service</strong> 用于零配置网络发现，使电脑超容易发现网络中打印机或其他的主机，我总是禁用它，别漏掉它。</li>\n<li><strong>brltty.service</strong> 提供布莱叶盲文设备支持，例如布莱叶盲文显示器。</li>\n<li><strong>debug-shell.service</strong> 开放了一个巨大的安全漏洞（该服务提供了一个无密码的 root shell ，用于帮助 调试 systemd 问题），除非你正在使用该服务，否则永远不要启动服务。</li>\n<li><strong>ModemManager.service</strong> 该服务是一个被 dbus 激活的守护进程，用于提供移动宽频broadband（2G/3G/4G）接口，如果你没有该接口，无论是内置接口，还是通过如蓝牙配对的电话，以及 USB 适配器，那么你也无需该服务。</li>\n<li><strong>pppd-dns.service</strong> 是一个计算机发展的遗物，如果你使用拨号接入互联网的话，保留它，否则你不需要它。</li>\n<li><strong>rtkit-daemon.service</strong> 听起来很可怕，听起来像是 rootkit。 但是你需要该服务，因为它是一个实时内核调度器real-time kernel scheduler。</li>\n<li><strong>whoopsie.service</strong> 是 Ubuntu 错误报告服务。它用于收集 Ubuntu 系统崩溃报告，并发送报告到 <a href=\"https://daisy.ubuntu.com\">https://daisy.ubuntu.com</a> 。 你可以放心地禁止其启动，或者永久的卸载它。</li>\n<li><strong>wpa_supplicant.service</strong> 仅在你使用 Wi-Fi 连接时需要。</li>\n</ul>\n<h3 id=\"toc_3\">系统启动时发生了什么？</h3>\n<p>Systemd 提供了一些命令帮助调试系统开机启动问题。该命令会重演你的系统启动的所有消息。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59bccfd7f05e0961052322\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ journalctl -b\r\n\r\n-- Logs begin at Mon 2016-05-09 06:18:11 PDT,\r\nend at Mon 2016-05-09 10:17:01 PDT. --\r\nMay 16 06:18:11 studio systemd-journal[289]:\r\nRuntime journal (/run/log/journal/) is currently using 8.0M.\r\nMaximum allowed usage is set to 157.2M.\r\nLeaving at least 235.9M free (of currently available 1.5G of space).\r\nEnforced usage limit is thus 157.2M.\r\n[...]\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59bccfd7f05e0961052322-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bccfd7f05e0961052322-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59bccfd7f05e0961052322-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bccfd7f05e0961052322-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59bccfd7f05e0961052322-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bccfd7f05e0961052322-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59bccfd7f05e0961052322-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bccfd7f05e0961052322-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59bccfd7f05e0961052322-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bccfd7f05e0961052322-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59bccfd7f05e0961052322-11\">11</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59bccfd7f05e0961052322-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">journalctl</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">b</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bccfd7f05e0961052322-2\"> </div><div class=\"crayon-line\" id=\"crayon-59bccfd7f05e0961052322-3\"><span class=\"crayon-o\">--</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Logs </span><span class=\"crayon-e\">begin </span><span class=\"crayon-e\">at </span><span class=\"crayon-i\">Mon</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2016</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">05</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">09</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">06</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">18</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">11</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">PDT</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bccfd7f05e0961052322-4\"><span class=\"crayon-st\">end</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">at </span><span class=\"crayon-i\">Mon</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2016</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">05</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">09</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">17</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">01</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">PDT</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span></div><div class=\"crayon-line\" id=\"crayon-59bccfd7f05e0961052322-5\"><span class=\"crayon-i\">May</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">16</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">06</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">18</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">11</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">studio </span><span class=\"crayon-v\">systemd</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">journal</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">289</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bccfd7f05e0961052322-6\"><span class=\"crayon-e\">Runtime </span><span class=\"crayon-e\">journal</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">run</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">log</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">journal</span><span class=\"crayon-o\">/</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">currently </span><span class=\"crayon-i\">using</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8.0M.</span></div><div class=\"crayon-line\" id=\"crayon-59bccfd7f05e0961052322-7\"><span class=\"crayon-e\">Maximum </span><span class=\"crayon-e\">allowed </span><span class=\"crayon-e\">usage </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">set </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">157.2M.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bccfd7f05e0961052322-8\"><span class=\"crayon-e\">Leaving </span><span class=\"crayon-e\">at </span><span class=\"crayon-i\">least</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">235.9M</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">free</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">of </span><span class=\"crayon-e\">currently </span><span class=\"crayon-i\">available</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1.5G</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">of </span><span class=\"crayon-v\">space</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-59bccfd7f05e0961052322-9\"><span class=\"crayon-e\">Enforced </span><span class=\"crayon-e\">usage </span><span class=\"crayon-e\">limit </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">thus</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">157.2M.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bccfd7f05e0961052322-10\"><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59bccfd7f05e0961052322-11\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0027 seconds] -->\r\n<p>通过命令 <code>journalctl -b -1</code> 可以复审前一次启动，<code>journalctl -b -2</code> 可以复审倒数第 2 次启动，以此类推。</p>\n<p>该命令会打印出大量的信息，你可能并不关注所有信息，只是关注其中问题相关部分。为此，系统提供了几个过滤器，用于帮助你锁定目标。让我们以进程号为 1 的进程为例，该进程是所有其它进程的父进程。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59bccfd7f05e4690879513\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ journalctl _PID=1\r\n\r\nMay 08 06:18:17 studio systemd[1]: Starting LSB: Raise network interfaces....\r\nMay 08 06:18:17 studio systemd[1]: Started LSB: Raise network interfaces..\r\nMay 08 06:18:17 studio systemd[1]: Reached target System Initialization.\r\nMay 08 06:18:17 studio systemd[1]: Started CUPS Scheduler.\r\nMay 08 06:18:17 studio systemd[1]: Listening on D-Bus System Message Bus Socket\r\nMay 08 06:18:17 studio systemd[1]: Listening on CUPS Scheduler.\r\n[...]\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59bccfd7f05e4690879513-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bccfd7f05e4690879513-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59bccfd7f05e4690879513-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bccfd7f05e4690879513-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59bccfd7f05e4690879513-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bccfd7f05e4690879513-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59bccfd7f05e4690879513-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bccfd7f05e4690879513-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59bccfd7f05e4690879513-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bccfd7f05e4690879513-10\">10</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59bccfd7f05e4690879513-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">journalctl </span><span class=\"crayon-v\">_PID</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bccfd7f05e4690879513-2\"> </div><div class=\"crayon-line\" id=\"crayon-59bccfd7f05e4690879513-3\"><span class=\"crayon-i\">May</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">08</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">06</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">18</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">17</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">studio </span><span class=\"crayon-v\">systemd</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Starting </span><span class=\"crayon-v\">LSB</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Raise </span><span class=\"crayon-e\">network </span><span class=\"crayon-v\">interfaces</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bccfd7f05e4690879513-4\"><span class=\"crayon-i\">May</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">08</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">06</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">18</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">17</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">studio </span><span class=\"crayon-v\">systemd</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Started </span><span class=\"crayon-v\">LSB</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Raise </span><span class=\"crayon-e\">network </span><span class=\"crayon-v\">interfaces</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-59bccfd7f05e4690879513-5\"><span class=\"crayon-i\">May</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">08</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">06</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">18</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">17</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">studio </span><span class=\"crayon-v\">systemd</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Reached </span><span class=\"crayon-e\">target </span><span class=\"crayon-e\">System </span><span class=\"crayon-v\">Initialization</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bccfd7f05e4690879513-6\"><span class=\"crayon-i\">May</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">08</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">06</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">18</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">17</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">studio </span><span class=\"crayon-v\">systemd</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Started </span><span class=\"crayon-e\">CUPS </span><span class=\"crayon-v\">Scheduler</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-59bccfd7f05e4690879513-7\"><span class=\"crayon-i\">May</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">08</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">06</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">18</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">17</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">studio </span><span class=\"crayon-v\">systemd</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Listening </span><span class=\"crayon-i\">on</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">D</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">Bus </span><span class=\"crayon-e\">System </span><span class=\"crayon-e\">Message </span><span class=\"crayon-e\">Bus </span><span class=\"crayon-e\">Socket</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bccfd7f05e4690879513-8\"><span class=\"crayon-i\">May</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">08</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">06</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">18</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">17</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">studio </span><span class=\"crayon-v\">systemd</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Listening </span><span class=\"crayon-e\">on </span><span class=\"crayon-e\">CUPS </span><span class=\"crayon-v\">Scheduler</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-59bccfd7f05e4690879513-9\"><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bccfd7f05e4690879513-10\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0031 seconds] -->\r\n<p>这些打印消息显示了什么被启动，或者是正在尝试启动。</p>\n<p>一个最有用的命令工具之一 <code>systemd-analyze blame</code>，用于帮助查看哪个服务进程启动耗时最长。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59bccfd7f05e8858851846\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ systemd-analyze blame\r\n         8.708s gpu-manager.service\r\n         8.002s NetworkManager-wait-online.service\r\n         5.791s mysql.service\r\n         2.975s dev-sda3.device\r\n         1.810s alsa-restore.service\r\n         1.806s systemd-logind.service\r\n         1.803s irqbalance.service\r\n         1.800s lm-sensors.service\r\n         1.800s grub-common.service\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59bccfd7f05e8858851846-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bccfd7f05e8858851846-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59bccfd7f05e8858851846-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bccfd7f05e8858851846-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59bccfd7f05e8858851846-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bccfd7f05e8858851846-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59bccfd7f05e8858851846-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bccfd7f05e8858851846-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59bccfd7f05e8858851846-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59bccfd7f05e8858851846-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59bccfd7f05e8858851846-11\">11</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59bccfd7f05e8858851846-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">systemd</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">analyze </span><span class=\"crayon-i\">blame</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bccfd7f05e8858851846-2\"><span class=\"crayon-h\">         </span><span class=\"crayon-cn\">8.708s</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">gpu</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">manager</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">service</span></div><div class=\"crayon-line\" id=\"crayon-59bccfd7f05e8858851846-3\"><span class=\"crayon-h\">         </span><span class=\"crayon-cn\">8.002s</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">NetworkManager</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">wait</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">online</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">service</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bccfd7f05e8858851846-4\"><span class=\"crayon-h\">         </span><span class=\"crayon-cn\">5.791s</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">mysql</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">service</span></div><div class=\"crayon-line\" id=\"crayon-59bccfd7f05e8858851846-5\"><span class=\"crayon-h\">         </span><span class=\"crayon-cn\">2.975s</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">dev</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">sda3</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">device</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bccfd7f05e8858851846-6\"><span class=\"crayon-h\">         </span><span class=\"crayon-cn\">1.810s</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">alsa</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">restore</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">service</span></div><div class=\"crayon-line\" id=\"crayon-59bccfd7f05e8858851846-7\"><span class=\"crayon-h\">         </span><span class=\"crayon-cn\">1.806s</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">systemd</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">logind</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">service</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bccfd7f05e8858851846-8\"><span class=\"crayon-h\">         </span><span class=\"crayon-cn\">1.803s</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">irqbalance</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">service</span></div><div class=\"crayon-line\" id=\"crayon-59bccfd7f05e8858851846-9\"><span class=\"crayon-h\">         </span><span class=\"crayon-cn\">1.800s</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">lm</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">sensors</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">service</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59bccfd7f05e8858851846-10\"><span class=\"crayon-h\">         </span><span class=\"crayon-cn\">1.800s</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">grub</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">common</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">service</span></div><div class=\"crayon-line\" id=\"crayon-59bccfd7f05e8858851846-11\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0019 seconds] -->\r\n<p>这个特定的例子没有出现任何异常，但是如果存在系统启动瓶颈，则该命令将能发现它。</p>\n<p>你也能通过如下资源了解 Systemd 如何工作：</p>\n<ul>\n<li><a href=\"https://www.linux.com/learn/understanding-and-using-systemd\">理解和使用 Systemd</a></li>\n<li><a href=\"https://www.linux.com/learn/intro-systemd-runlevels-and-service-management-commands\">介绍 Systemd 运行级别和服务管理命令</a></li>\n<li><a href=\"https://www.linux.com/learn/here-we-go-again-another-linux-init-intro-systemd\">再次前行，另一个 Linux 初始化系统：Systemd 介绍</a></li>\n</ul>\n<p> </p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112384\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112384votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112384\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 3 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "create_date": "2017-09-07", "title": "Linux 系统开机启动项清理", "fav_nums": 3, "url": "http://blog.jobbole.com/112384/", "comment_nums": 0, "front_image_path": "full/d3d1a5ad957de059084690efae6fdfaa3527e1c3.jpg"}